
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Kent's Blog</title>
  <meta name="author" content="Kent">

  
  <meta name="description" content="執行Liquibase指令的方式 maven goals: 同步到xml到db 建立user table
加入額外的欄位
insert data
版控說明
完整的 db.changelog-master.xml 從資料庫產生changelog.xml 只產生data
同時產生schema + &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.kent-chiu.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Kent's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39152849-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Kent's Blog</a></h1>
  
    <h2>Kent的學習筆記</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.kent-chiu.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/30/liquibase-101/">Liquibase 筆記</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-30T12:44:00+08:00" pubdate data-updated="true">Aug 30<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/08/30/liquibase-101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><!-- MarkdownTOC depth=0 -->


<ul>
<li>執行Liquibase指令的方式

<ul>
<li>maven goals:</li>
</ul>
</li>
<li>同步到xml到db

<ul>
<li>建立user table</li>
<li>加入額外的欄位</li>
<li>insert data</li>
<li>版控說明</li>
<li>完整的 db.changelog-master.xml</li>
</ul>
</li>
<li>從資料庫產生changelog.xml

<ul>
<li>只產生data</li>
<li>同時產生schema + data</li>
</ul>
</li>
<li>完整的pom.xml</li>
<li>個人心得</li>
<li>resource</li>
</ul>


<!-- /MarkdownTOC -->


<p><a href="http://www.liquibase.org/">Liquibase</a>是資料庫版本管理工具，設定的概念是把資料庫schema的異動(table的建立，column的異動，index的異動…)及資料內容的異動(insert，update，delete)用Liquibase定義的語法寫成xml格式change log，然後在資料庫裡多建立一個名為databasechangelog的table(如下)，用來記錄db更新了那些change log，當xml新增了更多的change log後，跟db裡的版號一比對，就可得知未同步的change log有那些，下次同步時，就會同步這些未同步過的change log。概念上跟 git 滿像的。</p>

<p>liquibase會在管理的database中加入databasechangelog table，用來記錄與xml同步的狀態</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">mydb</span><span class="o">=#</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">databasechangelog</span><span class="p">;</span>
</span><span class='line'><span class="o">-</span><span class="p">[</span> <span class="n">RECORD</span> <span class="mi">1</span> <span class="p">]</span><span class="o">-+</span><span class="c1">--------------------------------------------------------------------------------------------------</span>
</span><span class='line'><span class="n">id</span>            <span class="o">|</span> <span class="mi">1</span>
</span><span class='line'><span class="n">author</span>        <span class="o">|</span> <span class="n">bob</span>
</span><span class='line'><span class="n">filename</span>      <span class="o">|</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">kent</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">liquibase</span><span class="o">-</span><span class="n">exercise</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">db</span><span class="p">.</span><span class="n">changelog</span><span class="o">-</span><span class="n">master</span><span class="p">.</span><span class="n">xml</span>
</span><span class='line'><span class="n">dateexecuted</span>  <span class="o">|</span> <span class="mi">2014</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">30</span> <span class="mi">10</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">35</span><span class="p">.</span><span class="mi">235724</span>
</span><span class='line'><span class="n">orderexecuted</span> <span class="o">|</span> <span class="mi">1</span>
</span><span class='line'><span class="n">exectype</span>      <span class="o">|</span> <span class="n">EXECUTED</span>
</span><span class='line'><span class="n">md5sum</span>        <span class="o">|</span> <span class="mi">7</span><span class="p">:</span><span class="mi">17</span><span class="n">a94fcdd73aa8852c1f53e4d06ee651</span>
</span><span class='line'><span class="n">description</span>   <span class="o">|</span> <span class="n">createTable</span>
</span><span class='line'><span class="n">comments</span>      <span class="o">|</span>
</span><span class='line'><span class="n">tag</span>           <span class="o">|</span>
</span><span class='line'><span class="n">liquibase</span>     <span class="o">|</span> <span class="mi">3</span><span class="p">.</span><span class="mi">2</span><span class="p">.</span><span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>需特別注意，change log設定檔，一旦同步過後，如果設定檔中的id，檔案路徑等tag有改到，就會被當成新的change log，再次被同步到db中</p></blockquote>

<h4>執行Liquibase指令的方式</h4>

<p>要執行Liquibase指令，可透過command line，ant，maven，或API呼叫，本文採用maven的方式。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>        <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>            <span class="nt">&lt;groupId&gt;</span>org.liquibase<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;artifactId&gt;</span>liquibase-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;version&gt;</span>3.2.2<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>            <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>                <span class="nt">&lt;changeLogFile&gt;</span>${basedir}/src/main/resources/db.changelog-master.xml<span class="nt">&lt;/changeLogFile&gt;</span>
</span><span class='line'>                <span class="nt">&lt;outputChangeLogFile&gt;</span>${basedir}/src/main/resources/output.xml<span class="nt">&lt;/outputChangeLogFile&gt;</span>
</span><span class='line'>                <span class="nt">&lt;driver&gt;</span>org.postgresql.Driver<span class="nt">&lt;/driver&gt;</span>
</span><span class='line'>                <span class="nt">&lt;url&gt;</span>jdbc:postgresql://localhost:5432/mydb<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>                <span class="nt">&lt;username&gt;</span>postgres<span class="nt">&lt;/username&gt;</span>
</span><span class='line'>                <span class="nt">&lt;password&gt;</span>postgres<span class="nt">&lt;/password&gt;</span>
</span><span class='line'>                <span class="nt">&lt;promptOnNonLocalDatabase&gt;</span>false<span class="nt">&lt;/promptOnNonLocalDatabase&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/plugin&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>changeLogFile : 記錄要套用到db的xml檔(xml -> db)，執行update指令時，會依changeLogFile的內容異動資料庫schema</li>
<li>outputChangeLogFile: 從資料庫匯出xml時，會匯出到outputChangeLogFile (db -> xml)</li>
</ul>


<h4>maven goals:</h4>

<ul>
<li>changelogSync : 將changelog中未套用至db的change logs標示成已同步</li>
<li>changelogSyncSQL : 同<code>changelogSync</code>，但只產生sql，而不執行同步到db</li>
<li>generateChangeLog : 將目前資料庫的shcema(預設不含資料內容)匯出成 xml</li>
<li>dbDoc : 產生像java doc的文件</li>
<li>diff : 比對兩個資料庫間的差異</li>
<li>status : 顯示目前change set有那些change log會被套用到db</li>
<li>tag : 在liquibase產生在db的管理用table打上tag，之後可以當作rollback用</li>
<li>update : 更新未套用過的change set至db(xml -> db)</li>
<li>updateSQL : 同update，但產生更新的sql語法，不會真正同步db</li>
</ul>


<p>以下的指令沒用過，不太清楚實際的動作情形:</p>

<ul>
<li>clearCheckSums :Clears all checksums in the current changelog, so they will be recalculatednext update.</li>
<li>dropAll :
Drops all database objects owned by the user. Note that functions, procedures
and packages are not dropped.</li>
<li>futureRollbackSQL :
Generates the SQL that is required to rollback the database to current state
after the next update.</li>
<li>listLocks :
Lists all Liquibase updater locks on the current database.</li>
<li>releaseLocks :
Removes any Liquibase updater locks from the current database.</li>
<li>rollback :
Invokes Liquibase rollbacks on a database.</li>
<li>rollbackSQL :
Generates the SQL that is required to rollback the database to the specified
pointing attributes &#8216;rollbackCount&#8217;, &#8216;rollbackTag&#8217;</li>
<li>updateTestingRollback :
Applies the DatabaseChangeLogs to the database, testing rollback. This is done
by updating the database, rolling it back then updating it again.</li>
</ul>


<p>像 changelogSync，changelogSyncSQL，或 update，updateSQL，做的事情是差不多的，而有<em>SQL</em>後綴的版本，是會把要執行的SQL語法輸出到stdout，而不進行db的更新。</p>

<p>在使用上，新的database，一開始就用changelog的xml管理，所有的異動都透過xml管理，然後使用<code>mvn liquibase:update</code>，就會將plugin中的<code>changeLogFile</code>指定的
change log檔更新到db，如果是legcy的專案原本就有db的，可以用<code>mvn liquibase:generateChangeLog</code>把db匯成change log檔案至<code>outputChangeLogFile</code>指定的檔案中，之後再以產生出來的change log為基礎，做資料庫版本的管理。</p>

<h2>同步到xml到db</h2>

<h4>建立user table</h4>

<p>src/main/resources/db.changelog-master.xml</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;databaseChangeLog</span>
</span><span class='line'>  <span class="na">xmlns=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span>
</span><span class='line'>  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog</span>
</span><span class='line'><span class="s">         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!-- 建立 uesr table --&gt;</span>
</span><span class='line'>    <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&quot;create-user-table&quot;</span> <span class="na">author=</span><span class="s">&quot;kent&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;createTable</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">type=</span><span class="s">&quot;varchar(50)&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;constraints</span> <span class="na">nullable=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/column&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">type=</span><span class="s">&quot;varchar(50)&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/column&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/createTable&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/changeSet&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/databaseChangeLog&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>第一次執行<code>mvn liquibase:update</code>執行後，原本完全沒有table的db多了三個table，</p>

<ul>
<li>databasechangelog是記錄同步用的，</li>
<li>databasechangeloglock是做locking的</li>
</ul>


<p>上面兩個都是直接由liquibase管理，不用去管它。</p>

<ul>
<li>user 則是上面的change log中的<code>&lt;createTable&gt;</code>建立的</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>             List of relations
</span><span class='line'> Schema |         Name          | Type  |  Owner
</span><span class='line'>--------+-----------------------+-------+----------
</span><span class='line'> public | databasechangelog     | table | postgres
</span><span class='line'> public | databasechangeloglock | table | postgres
</span><span class='line'> public | user                  | table | postgres
</span></code></pre></td></tr></table></div></figure>


<p>user跟change log中定義的結構是一致的</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>          Table &quot;public.user&quot;
</span><span class='line'>   Column   |         Type          | Modifiers
</span><span class='line'>------------+-----------------------+-----------
</span><span class='line'> first_name | character varying(50) | not null
</span><span class='line'> last_name  | character varying(50) |
</span></code></pre></td></tr></table></div></figure>


<h4>加入額外的欄位</h4>

<p>src/main/resources/db.changelog-master.xml</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;databaseChangeLog</span>
</span><span class='line'>  <span class="na">xmlns=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span>
</span><span class='line'>  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog</span>
</span><span class='line'><span class="s">         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>   ...(略)
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!-- 在user table加入 address column --&gt;</span>
</span><span class='line'>    <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&quot;addColumn-example&quot;</span> <span class="na">author=</span><span class="s">&quot;kent&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;addColumn</span> <span class="na">catalogName=</span><span class="s">&quot;mydb&quot;</span> <span class="na">schemaName=</span><span class="s">&quot;public&quot;</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;address&quot;</span> <span class="na">type=</span><span class="s">&quot;varchar(255)&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/addColumn&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/changeSet&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/databaseChangeLog&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>改完changelog的xml檔，再次執行<code>mvn liquibase:update</code>後，user table就會多出address column，這次執行，因為databasechangelog中已有記錄<code>&lt;changeSet id="create-user-table" author="kent"&gt;</code>已經被執行過了，所以不會再次被執行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>           Table &quot;public.user&quot;
</span><span class='line'>   Column   |          Type          | Modifiers
</span><span class='line'>------------+------------------------+-----------
</span><span class='line'> first_name | character varying(50)  | not null
</span><span class='line'> last_name  | character varying(50)  |
</span><span class='line'> address    | character varying(255) |
</span></code></pre></td></tr></table></div></figure>


<h4>insert data</h4>

<p>src/main/resources/db.changelog-master.xml</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;databaseChangeLog</span>
</span><span class='line'>  <span class="na">xmlns=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span>
</span><span class='line'>  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog</span>
</span><span class='line'><span class="s">         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>   ...(略)
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!-- insert兩筆測試資料 --&gt;</span>
</span><span class='line'>    <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&quot;insert-example&quot;</span> <span class="na">author=</span><span class="s">&quot;kent&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;insert</span> <span class="na">catalogName=</span><span class="s">&quot;mydb&quot;</span> <span class="na">schemaName=</span><span class="s">&quot;public&quot;</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">value=</span><span class="s">&quot;kent&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">value=</span><span class="s">&quot;chiu&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/insert&gt;</span>
</span><span class='line'>        <span class="nt">&lt;insert</span> <span class="na">catalogName=</span><span class="s">&quot;mydb&quot;</span> <span class="na">schemaName=</span><span class="s">&quot;public&quot;</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">value=</span><span class="s">&quot;cindy&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">value=</span><span class="s">&quot;chiu&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/insert&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/changeSet&gt;</span>
</span><span class='line'><span class="nt">&lt;/databaseChangeLog&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>改完changelog的xml檔，執行<code>mvn liquibase:update</code>執行後，user table就會多出兩筆資料</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'> first_name | last_name | address
</span><span class='line'>------------+-----------+---------
</span><span class='line'> kent       | chiu      |
</span><span class='line'> cindy      | chiu      |
</span></code></pre></td></tr></table></div></figure>


<h4>版控說明</h4>

<p>在實務上，只要是db的schema有要做異動，就一律從change log的設定檔改，如果是資料內容的異動，則視需求看要不要從change log異動。必要的預設資料可以在change log裡，透過insert tag來建立，可以省去每次重建table都還要另外建立預設資料的步驟。</p>

<p>搭配其他指令，還可以讓資料庫回到特一個特定的版本(change set)，這樣在開發時，就不用怕弄亂資料庫了。</p>

<h4>完整的 db.changelog-master.xml</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;databaseChangeLog</span>
</span><span class='line'>  <span class="na">xmlns=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span>
</span><span class='line'>  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog</span>
</span><span class='line'><span class="s">         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!-- 建立 uesr table --&gt;</span>
</span><span class='line'>    <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&quot;create-user-table&quot;</span> <span class="na">author=</span><span class="s">&quot;kent&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;createTable</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">type=</span><span class="s">&quot;varchar(50)&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;constraints</span> <span class="na">nullable=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/column&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">type=</span><span class="s">&quot;varchar(50)&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/column&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/createTable&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/changeSet&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!-- 在user table加入 address column --&gt;</span>
</span><span class='line'>    <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&quot;addColumn-example&quot;</span> <span class="na">author=</span><span class="s">&quot;kent&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;addColumn</span> <span class="na">catalogName=</span><span class="s">&quot;mydb&quot;</span> <span class="na">schemaName=</span><span class="s">&quot;public&quot;</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;address&quot;</span> <span class="na">type=</span><span class="s">&quot;varchar(255)&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/addColumn&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/changeSet&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!-- insert兩筆測試資料 --&gt;</span>
</span><span class='line'>    <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&quot;insert-example&quot;</span> <span class="na">author=</span><span class="s">&quot;kent&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;insert</span> <span class="na">catalogName=</span><span class="s">&quot;mydb&quot;</span> <span class="na">schemaName=</span><span class="s">&quot;public&quot;</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">value=</span><span class="s">&quot;kent&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">value=</span><span class="s">&quot;chiu&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/insert&gt;</span>
</span><span class='line'>        <span class="nt">&lt;insert</span> <span class="na">catalogName=</span><span class="s">&quot;mydb&quot;</span> <span class="na">schemaName=</span><span class="s">&quot;public&quot;</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">value=</span><span class="s">&quot;cindy&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">value=</span><span class="s">&quot;chiu&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/insert&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/changeSet&gt;</span>
</span><span class='line'><span class="nt">&lt;/databaseChangeLog&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>從資料庫產生changelog.xml</h2>

<p>對於即有的database，可以透過<code>generateChangeLog</code>從資料庫產生change log，再以這個change log檔為基礎，之後的異動，再透過liquibase管理(xml -> db)</p>

<p>使用<code>generateChangeLog</code>進行匯出時，預設是只有schema(tables, views, columns, indexs,foreignkeys, primarykeys, uniqueconstraints)，如果要產
生資料，要在<code>diffTypes</code>中加入<strong>data</strong>這個type。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kent@Kents-MacBook-Pro:~/dev/liquibase-exercise<span class="nv">$ </span>mvn liquibase:generateChangeLog
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Scanning <span class="k">for </span>projects...
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Using the builder org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder with a thread count of 1
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Building liquibase-exercise 1.1.0-SNAPSHOT
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> --- liquibase-maven-plugin:3.2.2:generateChangeLog <span class="o">(</span>default-cli<span class="o">)</span> @ liquibase-exercise ---
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Executing on Database: jdbc:postgresql://localhost:5432/mydb
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Generating Change Log from database postgres @ jdbc:postgresql://localhost:5432/mydb <span class="o">(</span>Default Schema: public<span class="o">)</span>
</span><span class='line'>INFO 8/30/14 12:30 PM: liquibase: /Users/kent/dev/liquibase-exercise/src/main/resources/output.xml does not exist, creating
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Output written to Change Log file, /Users/kent/dev/liquibase-exercise/src/main/resources/output.xml
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> BUILD SUCCESS
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Total <span class="nb">time</span>: 2.087 s
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Finished at: 2014-08-30T12:31:00+08:00
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Final Memory: 8M/61M
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
</span></code></pre></td></tr></table></div></figure>


<p>執行完<code>generateChangeLog</code>可以看到change log產生到我們plugin的設定中指定的位置<code>src/main/resources/output.xml</code></p>

<p>如果沒有特別指定<code>diffTypes</code>參數，那只會產生&#8217;tables, views, columns, indexs,foreignkeys, primarykeys, uniqueconstraints&#8217;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;databaseChangeLog</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span> <span class="na">xmlns:ext=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog-ext&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;changeSet</span> <span class="na">author=</span><span class="s">&quot;kent (generated)&quot;</span> <span class="na">id=</span><span class="s">&quot;1409373059484-1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;insert</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">value=</span><span class="s">&quot;kent&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">value=</span><span class="s">&quot;chiu&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;address&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/insert&gt;</span>
</span><span class='line'>        <span class="nt">&lt;insert</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">value=</span><span class="s">&quot;cindy&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">value=</span><span class="s">&quot;chiu&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;address&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/insert&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/changeSet&gt;</span>
</span><span class='line'>    <span class="nt">&lt;changeSet</span> <span class="na">author=</span><span class="s">&quot;kent (generated)&quot;</span> <span class="na">id=</span><span class="s">&quot;1409373299327-1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;createTable</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">type=</span><span class="s">&quot;VARCHAR(50)&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;constraints</span> <span class="na">nullable=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/column&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">type=</span><span class="s">&quot;VARCHAR(50)&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;address&quot;</span> <span class="na">type=</span><span class="s">&quot;VARCHAR(255)&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/createTable&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/changeSet&gt;</span>
</span><span class='line'><span class="nt">&lt;/databaseChangeLog&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>只產生data</h4>

<p>指定<code>diffTypes=data</code>，就會只產生資料，不會有schema的資訊，如果有需要，也可以直接將資料匯出成csv檔</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mvn liquibase:generateChangeLog -Dliquibase.diffTypes<span class="o">=</span>data
</span></code></pre></td></tr></table></div></figure>


<p>產生的xml如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;databaseChangeLog</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span> <span class="na">xmlns:ext=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog-ext&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;changeSet</span> <span class="na">author=</span><span class="s">&quot;kent (generated)&quot;</span> <span class="na">id=</span><span class="s">&quot;1409373576402-1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;insert</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">value=</span><span class="s">&quot;kent&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">value=</span><span class="s">&quot;chiu&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;address&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/insert&gt;</span>
</span><span class='line'>        <span class="nt">&lt;insert</span> <span class="na">tableName=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;first_name&quot;</span> <span class="na">value=</span><span class="s">&quot;cindy&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;last_name&quot;</span> <span class="na">value=</span><span class="s">&quot;chiu&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">&quot;address&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/insert&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/changeSet&gt;</span>
</span><span class='line'><span class="nt">&lt;/databaseChangeLog&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>同時產生schema + data</h4>

<p>如果要產生的xml如下，那<code>diffTypes</code>就要設定為<code>tables,views,columns,indexs,foreignkeys,primarykeys,uniqueconstraints,data</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mvn liquibase:generateChangeLog -Dliquibase.diffTypes<span class="o">=</span>tables,views,columns,indexs,foreignkeys,primarykeys,uniqueconstraints,data
</span></code></pre></td></tr></table></div></figure>


<p>產生的xml如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span> <span class="nv">standalone</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>?&gt;
</span><span class='line'>&lt;databaseChangeLog <span class="nv">xmlns</span><span class="o">=</span><span class="s2">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span> xmlns:ext<span class="o">=</span><span class="s2">&quot;http://www.liquibase.org/xml/ns/dbchangelog-ext&quot;</span> xmlns:xsi<span class="o">=</span><span class="s2">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xsi:schemaLocation<span class="o">=</span><span class="s2">&quot;http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd&quot;</span>&gt;
</span><span class='line'>    &lt;changeSet <span class="nv">author</span><span class="o">=</span><span class="s2">&quot;kent (generated)&quot;</span> <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;1409373576402-1&quot;</span>&gt;
</span><span class='line'>        &lt;insert <span class="nv">tableName</span><span class="o">=</span><span class="s2">&quot;user&quot;</span>&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;first_name&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;kent&quot;</span>/&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;last_name&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;chiu&quot;</span>/&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;address&quot;</span>/&gt;
</span><span class='line'>        &lt;/insert&gt;
</span><span class='line'>        &lt;insert <span class="nv">tableName</span><span class="o">=</span><span class="s2">&quot;user&quot;</span>&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;first_name&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;cindy&quot;</span>/&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;last_name&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;chiu&quot;</span>/&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;address&quot;</span>/&gt;
</span><span class='line'>        &lt;/insert&gt;
</span><span class='line'>    &lt;/changeSet&gt;
</span><span class='line'>    &lt;changeSet <span class="nv">author</span><span class="o">=</span><span class="s2">&quot;kent (generated)&quot;</span> <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;1409373769747-1&quot;</span>&gt;
</span><span class='line'>        &lt;createTable <span class="nv">tableName</span><span class="o">=</span><span class="s2">&quot;user&quot;</span>&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;first_name&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;VARCHAR(50)&quot;</span>&gt;
</span><span class='line'>                &lt;constraints <span class="nv">nullable</span><span class="o">=</span><span class="s2">&quot;false&quot;</span>/&gt;
</span><span class='line'>            &lt;/column&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;last_name&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;VARCHAR(50)&quot;</span>/&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;address&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;VARCHAR(255)&quot;</span>/&gt;
</span><span class='line'>        &lt;/createTable&gt;
</span><span class='line'>    &lt;/changeSet&gt;
</span><span class='line'>    &lt;changeSet <span class="nv">author</span><span class="o">=</span><span class="s2">&quot;kent (generated)&quot;</span> <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;1409373769747-2&quot;</span>&gt;
</span><span class='line'>        &lt;insert <span class="nv">tableName</span><span class="o">=</span><span class="s2">&quot;user&quot;</span>&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;first_name&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;kent&quot;</span>/&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;last_name&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;chiu&quot;</span>/&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;address&quot;</span>/&gt;
</span><span class='line'>        &lt;/insert&gt;
</span><span class='line'>        &lt;insert <span class="nv">tableName</span><span class="o">=</span><span class="s2">&quot;user&quot;</span>&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;first_name&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;cindy&quot;</span>/&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;last_name&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;chiu&quot;</span>/&gt;
</span><span class='line'>            &lt;column <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;address&quot;</span>/&gt;
</span><span class='line'>        &lt;/insert&gt;
</span><span class='line'>    &lt;/changeSet&gt;
</span><span class='line'>&lt;/databaseChangeLog&gt;
</span></code></pre></td></tr></table></div></figure>


<h2>完整的pom.xml</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;project</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
</span><span class='line'>         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>com.kent<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>liquibase-exercise<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>1.1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;dependencies&gt;</span>
</span><span class='line'>        <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>            <span class="nt">&lt;groupId&gt;</span>org.postgresql<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;version&gt;</span>9.3-1101-jdbc41<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependencies&gt;</span>
</span><span class='line'>    <span class="nt">&lt;build&gt;</span>
</span><span class='line'>        <span class="nt">&lt;plugins&gt;</span>
</span><span class='line'>            <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>                <span class="nt">&lt;groupId&gt;</span>org.liquibase<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>                <span class="nt">&lt;artifactId&gt;</span>liquibase-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>                <span class="nt">&lt;version&gt;</span>3.2.2<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>                <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;changeLogFile&gt;</span>${basedir}/src/main/resources/db.changelog-master.xml<span class="nt">&lt;/changeLogFile&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;outputChangeLogFile&gt;</span>${basedir}/src/main/resources/output.xml<span class="nt">&lt;/outputChangeLogFile&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;driver&gt;</span>org.postgresql.Driver<span class="nt">&lt;/driver&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;url&gt;</span>jdbc:postgresql://localhost:5432/mydb<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;username&gt;</span>postgres<span class="nt">&lt;/username&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;password&gt;</span>postgres<span class="nt">&lt;/password&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;promptOnNonLocalDatabase&gt;</span>false<span class="nt">&lt;/promptOnNonLocalDatabase&gt;</span>
</span><span class='line'>                    <span class="c">&lt;!-- 同時產生資料跟schema --&gt;</span>
</span><span class='line'>                    <span class="c">&lt;!--</span>
</span><span class='line'><span class="c">                    &lt;diffTypes&gt;tables, views, columns, indexs,foreignkeys, primarykeys, uniqueconstraints, data&lt;/diffTypes&gt;</span>
</span><span class='line'><span class="c">                    --&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/plugins&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/build&gt;</span>
</span><span class='line'><span class="nt">&lt;/project&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>個人心得</h2>

<p>會接觸liquibase，主要是因為維護的專案，是屬於產品類型的，一但delivery給客戶後，要昇級程式，常不可避免的會動到db的結構或資料。
新增table跟column通常都不太會有問題，但是如果是要做delete或rename，甚至是對即有資料內容做一些格式的調整或轉換，一些簡單的sql指令(ddl或dml)就有點使不上力了，可能就要寫一些sql的funciton來處理，如果邏輯更複雜時就需要用程式處理，</p>

<p>在當時並沒有比較適合的solution，於是採用了類似Ruby On Rails管資料庫版本的方式做了一套，大部份的異動，都還是希望透過
sql script就能處理，但有些最基本的判斷，像column存不存在，不存在就建立，或column的rename，這些透過sql也不是很好處理，通常都要透過自製的sql function來處理，如果比較複雜的，就寫一個小程式來取代原來的sql script，使用上並不方便，而且
維護成本也不小，光每次測試sql patch，所以這次斷然決定換成用liquibase來管理，看看會不會有顯著的改善，目前看來使用經
驗算是不錯。</p>

<h2>resource</h2>

<ul>
<li><a href="http://www.liquibase.org/documentation/maven/index.html">http://www.liquibase.org/documentation/maven/index.html</a> - liquibase maven plugin</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/30/spring-boot-101/">Spring Boot筆記</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-30T12:44:00+08:00" pubdate data-updated="true">May 30<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/05/30/spring-boot-101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>pom.xml</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>com.example<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>myproject<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;parent&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>1.1.0.M2<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/parent&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!-- Additional lines to be added here... --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/project&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>maven設定檔是透過<code>&lt;parent&gt;</code> tag繼承 spring-boot預先定義好的 parent pom，在parent的pom檔中，有許多預設的dependencies，所以，引用到 parent pom裡已預先定義好的 dependency 時，就不需再定義該 <code>&lt;dependency&gt;</code> tag下的 <code>&lt;version&gt;</code> tag。在本文章中的 <code>&lt;dependency&gt;</code>  只要是沒加 <code>&lt;version&gt;</code> tag的，都是因為 parent pom 已有預先定義好的 dependencies.</p>

<p>建議可以調 parent 的 pom.xml 出來看看，會比較清楚 spring boot 的 building 機制，eclipse 跟 intelliJ 都支援 link 到 parent pom 的功能。</p>

<p>Spring Boot Hello World:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Controller</span>
</span><span class='line'><span class="nd">@EnableAutoConfiguration</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="nd">@ResponseBody</span>
</span><span class='line'>    <span class="n">String</span> <span class="nf">home</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">ApplicationContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Let&#39;s inspect the beans provided by Spring Boot:&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">String</span><span class="o">[]</span> <span class="n">beanNames</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getBeanDefinitionNames</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">beanNames</span><span class="o">);</span>
</span><span class='line'>        <span class="c1">// 表列出引用到的 beans</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">beanName</span> <span class="o">:</span> <span class="n">beanNames</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">beanName</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>比起傳統的 Spring RESTful 程式，spring boot簡單許多。</p>

<p>spring-boot-maven-plugin主要的功能是 build 出 war 檔或可執行的 jar 檔</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;build&gt;</span>
</span><span class='line'>    <span class="nt">&lt;plugins&gt;</span>
</span><span class='line'>        <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/plugins&gt;</span>
</span><span class='line'><span class="nt">&lt;/build&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>執行 <code>mvn spring-boot:run</code> ， 加入 <code>--debug</code> 參數可以dump auto config 的細節， 方便除錯 <code>mvn spring-boot:run --debug</code>，如果是在IDE執行成 Application，那把<code>--debug</code>加到program argument即可，或者是直接寫到<code>SpringApplicationBuilder</code></p>

<p><code>new SpringApplicationBuilder(MyConfig.class).run(new String[]{"--debug"});</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">=========================</span>
</span><span class='line'>AUTO-CONFIGURATION <span class="nv">REPORT</span>
</span><span class='line'><span class="o">=========================</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Positive matches:
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>   AuditAutoConfiguration.AuditEventRepositoryConfiguration
</span><span class='line'>      - @ConditionalOnMissingBean <span class="o">(</span>types: org.springframework.boot.actuate.audit.AuditEventRepository; SearchStrategy: all<span class="o">)</span> found no beans <span class="o">(</span>OnBeanCondition<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>   EndpointAutoConfiguration#autoConfigurationAuditEndpoint
</span><span class='line'>      - @ConditionalOnBean <span class="o">(</span>types: org.springframework.boot.autoconfigure.condition.ConditionEvaluationReport; SearchStrategy: all<span class="o">)</span> found the following <span class="o">[</span>autoConfigurationReport<span class="o">]</span> @ConditionalOnMissingBean <span class="o">(</span>types: org.springframework.boot.actuate.endpoint.AutoConfigurationReportEndpoint; SearchStrategy: current<span class="o">)</span> found no beans <span class="o">(</span>OnBeanCondition<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>   EndpointAutoConfiguration#beansEndpoint
</span><span class='line'>      - @ConditionalOnMissingBean <span class="o">(</span>types: org.springframework.boot.actuate.endpoint.BeansEndpoint; SearchStrategy: all<span class="o">)</span> found no beans <span class="o">(</span>OnBeanCondition<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果想要抓到Application傳進來的參數，可以implement <code>CommandLineRunner</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.boot.*</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.stereotype.*</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Component</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBean</span> <span class="kd">implements</span> <span class="n">CommandLineRunner</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Do something...</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Properties</h2>

<p>屬性檔預設預案是在 classpath下的 application.properties或 application-{profile}.properties</p>

<p>屬性中可以用亂數產生器,因為使用了<code>RandomValuePropertySource</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='properties'><span class='line'><span class="na">my.secret</span><span class="o">=</span><span class="s">${random.value}</span>
</span><span class='line'><span class="na">my.number</span><span class="o">=</span><span class="s">${random.int}</span>
</span><span class='line'><span class="na">my.bignumber</span><span class="o">=</span><span class="s">${random.long}</span>
</span><span class='line'><span class="na">my.number.less.than.ten</span><span class="o">=</span><span class="s">${random.int(10)}</span>
</span><span class='line'><span class="na">my.number.in.range</span><span class="o">=</span><span class="s">${random.int[1024,65536]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>在屬性檔的屬性可以透過<code>@Value</code>及<code>@ConfigurationProperties</code> binding 到程式， 也可以jsr-303的 bean validation 進行驗證。</p>

<h2>JPA</h2>

<p>要在 spring boot 中啟用 JPA也相當簡單， 只要加入 <code>spring-boot-starter-data-jpa</code> 跟 database driver即可，其他的設定像 hibernate.dialect 等 spring boot 會依照使用的資料庫選擇適合的設定。</p>

<p>使用 hsqldb 當 database</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.hsqldb<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>hsqldb<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用 mysql 當 database</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果用 in-memory database，像hsqldb，h2，derby … 當db，jpa會自動建立 entity 對應的table，如果是其他 database，則需自行建立，或者也可以透過 application.properties 設定檔來改寫預設的行為。</p>

<h2>Testing</h2>

<h4>Unit Test</h4>

<p>spring一向強調測試的重要性，在spring寫測試比起在其它 framework 下會愉快許多。spring boot 在測試上，在基於 spring 本身的基礎上，又加了一些方便的配置。</p>

<p>在繼承 parent pom之後，unit test常用的三板斧，就會被配置在 test scope了(不會被 deploy 成product)，這三板斧是:</p>

<ol>
<li>Junit - 單元測試lib</li>
<li>Hamcrest - 斷言工具 (assertion)，搭配 <code>assertThat</code> 用的(不要再 <code>assertEquals</code>，請一律<code>assertThat</code>吧)</li>
<li>Mockito - 目前java最流行的 mock framework</li>
</ol>


<h4>Database Test</h4>

<p>如果要做的測試跟db有關，建議採用in-memory database，不要mock，但如果沒有採用像 jpa 這種會自動依 dialect 轉換 sql 語法的 framework時，可能就要對測試方式做調整。在資料庫的測試，我通常是採用 hsqldb + dbunit，而production的database，即依專案需求而決定，使用jpa時，單元測試時在 hsqldb，真正執行時在其他db ex: mysql， postgresql，…，都沒遇過太大的問題。</p>

<p>但是如果沒辦法使用jpa時(通常會換成 JdbcTemplate)，而且又使用到許多特定資料庫特有的功能時，就會採用 dbunit + rollback base的測試，這一類的測試，在測試程式的撰寫上，通常需要花比較多的心力。</p>

<h4>Web Test</h4>

<p>web test，spring 本來就有提供 MockMvc 的 mock object，4.x 版後以的 spring mvc test 都改用 fluent api 來寫測試了。</p>

<h4>Spring Boot Application Test</h4>

<h4>unsorted</h4>

<ul>
<li><del>在專案中所有的 classes 都會被 <code>@ComponentScan</code> 掃描</del> ﹣》 只有base package</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/14/java-8-lambda/">Java 8 Lambda</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-14T12:47:00+08:00" pubdate data-updated="true">Mar 14<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/03/14/java-8-lambda/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>基本語法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="o">(</span><span class="n">parameters</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">expression</span>
</span><span class='line'><span class="n">or</span>
</span><span class='line'>    <span class="o">(</span><span class="n">parameters</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">statements</span><span class="o">;</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span><span class="n">parameters</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">expression</span>
</span><span class='line'><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">;</span>    <span class="c1">// 計算 x + y 的結果</span>
</span><span class='line'><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hi! &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span><span class="n">parameters</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">statements</span><span class="o">;</span> <span class="o">}</span>
</span><span class='line'><span class="n">x</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="o">;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="o">;</span> <span class="k">return</span> <span class="n">x</span><span class="o">;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>參數的型別如果沒有指定的，會進行類型推斷(type infer)</p>

<h4>functional interface</h4>

<p>只有定義一個抽象方法的interface叫&#8221;functional interface&#8221;，functional interface主要的用途是做 lambda expression.</p>

<p>在對lambda的使用還不熟悉時，可以先用anonymous class來一步一步轉換成lambda</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// Stream裡filter method的宣告，filter method需要傳入一個Predicate的interface</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">BaseStream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Predicate</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">predicate</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Predicate主要是透過test這個method來解決結果是true，或false </span>
</span><span class='line'><span class="nd">@FunctionalInterface</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Evaluates this predicate on the given argument.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @param t the input argument</span>
</span><span class='line'><span class="cm">     * @return {@code true} if the input argument matches the predicate,</span>
</span><span class='line'><span class="cm">     * otherwise {@code false}</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kt">boolean</span> <span class="nf">test</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>sample:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
</span><span class='line'>    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
</span><span class='line'>    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
</span><span class='line'>    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 先用anonymous實作，這邊就可以看出來，如果Predicate有超過一個的abstract method，</span>
</span><span class='line'>    <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">predicate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">test</span><span class="o">(</span><span class="n">Integer</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 執行後，results會只包含list中大於3的數，所以為4,5這兩個數字    </span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">predicate</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 傳成lambda時，因為Predicate是function interface，只有一個abstract method，</span>
</span><span class='line'>    <span class="c1">// 所以，我們可以很清楚的知道，我們要實作的method是`public boolean test(Integer i)`</span>
</span><span class='line'>    <span class="c1">// 傳入的參數為Integer, 而實作的logic為判斷參數是否大於3</span>
</span><span class='line'>    <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">predicate</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">i</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span><span class="k">return</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">;};</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// java8的compier類型推斷(type infer)能力變強了，可以compiler可以由程式的上下文(context)猜出正確的型別，</span>
</span><span class='line'>    <span class="c1">// lambda expression可以再簡化如下</span>
</span><span class='line'>    <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">predicate</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span><span class="k">return</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">;};</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 再把冗餘的括號點去掉，lambda expression預設會return最後一行的值，所以，return也可以去掉    </span>
</span><span class='line'>    <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">predicate</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 在filter中套上predicate</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">predicate</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 對predicate執行 inline variable的refactory</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<p>在Predicate中，還有幾個default method，主要是用來輔助Predicate的使用，例如我們想取出上面相反的結果(不是大於3的值)，
直覺的方式，就是判斷的邏輯 <code>i&gt;3</code> 改寫成 <code>!(i &gt; 3)</code>，而Predicate.negate()這個default method就是在做這件事</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">predicate</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">;</span>  <span class="c1">// 先把lambda express從filter method中extract出來</span>
</span><span class='line'>    <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">negate</span> <span class="o">=</span> <span class="n">predicate</span><span class="o">.</span><span class="na">negate</span><span class="o">();</span> <span class="c1">// 取反向的值 </span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">negate</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span> <span class="c1">// 得到的results為 1, 2, 3</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到，我們用<code>predicate.negate()</code>就不用直接改寫原來的邏輯，只要直接對predicate做negate的運算即可。</p>

<p>Predicate還有幾個default methods都是在做Predicate運算時常會用到的，功用跟<a href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/base/Predicates.html">guava lib中的Predicats</a>類型，
Predicate function interface 的完整程式如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@FunctionalInterface</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>        <span class="kt">boolean</span> <span class="nf">test</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">default</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">and</span><span class="o">(</span><span class="n">Predicate</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">other</span><span class="o">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">test</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">other</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">default</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">negate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">test</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">default</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">or</span><span class="o">(</span><span class="n">Predicate</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">other</span><span class="o">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">test</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">||</span> <span class="n">other</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">isEqual</span><span class="o">(</span><span class="n">Object</span> <span class="n">targetRef</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">targetRef</span><span class="o">)</span>
</span><span class='line'>                    <span class="o">?</span> <span class="nl">Objects:</span><span class="o">:</span><span class="n">isNull</span>
</span><span class='line'>                    <span class="o">:</span> <span class="n">object</span> <span class="o">-&gt;</span> <span class="n">targetRef</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>lambda expression</h4>

<p>A lambda expression is an instance of a functional interface</p>

<h4>lambda expression常見的參數為</h4>

<ul>
<li>Predicate：接受一個參數，對參數做評估後返回一個boolean的值
ex: 過濾條件時，傳入過濾條件的參數，如果成立(true) 就進行過濾</li>
<li>Function：接受一個參數並產出結果
ex: 輸入字串，返回數字</li>
<li>Supplier：不接受参數，並返回結果
ex: 對stream中的元素計算後產生資料</li>
<li>Consumer：接受一個參數，但不返回結果(返回void)
ex: 經function運算後，影響輸入的結果(副作用)</li>
</ul>


<p>上面的class都是零元或一元運算子，還有二元運算子，功能類似，差異之處是在都是接受兩個參數</p>

<ul>
<li>BiConsumer</li>
<li>BiFunction</li>
<li>BiPredicate</li>
</ul>


<h1>RESOURCE</h1>

<ul>
<li><a href="http://www.techempower.com/blog/2013/03/26/everything-about-java-8/">http://www.techempower.com/blog/2013/03/26/everything-about-java-8/</a></li>
<li><a href="http://winterbe.com/posts/2014/03/16/java-8-tutorial/">http://winterbe.com/posts/2014/03/16/java-8-tutorial/</a></li>
<li><a href="http://docs.oracle.com/javase/tutorial/collections/streams/reduction.html">http://docs.oracle.com/javase/tutorial/collections/streams/reduction.html</a> - reduce</li>
<li><a href="http://www.ibm.com/developerworks/cn/java/j-lo-java8streamapi/index.html">http://www.ibm.com/developerworks/cn/java/j-lo-java8streamapi/index.html</a> - Java 8 中的 Streams API 详解</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/14/java-8-utility-object/">Java 8 好用工具箱</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-14T12:43:00+08:00" pubdate data-updated="true">Mar 14<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/03/14/java-8-utility-object/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>java 8 多了不少好用的工具類class，例如: 字串處理，null處理…之前透常是透過<a href="https://code.google.com/p/guava-libraries/">google guava</a>，或<a href="http://commons.apache.org/proper/commons-lang/">apache common lang</a>來處理，現在java 8 就有內建了。</p>

<ul>
<li><a href="http://download.java.net/jdk8/docs/api/java/util/Optional.html">Optional</a> 更安全、方便處理NULL的物件</li>
<li>Objects</li>
<li>StringJoin</li>
</ul>


<h4>Objects</h4>

<ul>
<li>requireNonNull(T obj) 如果傳入的obj為空，會丟出<code>NullPointerException</code>異常</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/14/java-8-date-and-time-api/">Java 8 時間、日期 API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-14T12:35:00+08:00" pubdate data-updated="true">Mar 14<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/03/14/java-8-date-and-time-api/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在做java 8 time轉換傳統的 java.util.Date時，要記住一個大原則，就是java 8的 LocalXXX是沒時區的，所以，要想辦法補上時區之後，之後再轉成Instant，就很容易轉換到Date(雖然整個過程實在說不上<strong>容易</strong>)</p>

<ul>
<li>Date -> LocalDate</li>
<li>Date -> LocalTime</li>
<li>Date -> LocalDateTime</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// 先轉成 Instant</span>
</span><span class='line'><span class="n">Instant</span> <span class="n">instant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">toInstant</span><span class="o">();</span>
</span><span class='line'><span class="c1">// LocalDateTime 有提供 ofInstant 的factory method</span>
</span><span class='line'><span class="n">LocalDateTime</span> <span class="n">localDateTime</span> <span class="o">=</span> <span class="n">LocalDateTime</span><span class="o">.</span><span class="na">ofInstant</span><span class="o">(</span><span class="n">instant</span><span class="o">,</span> <span class="n">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>  <span class="c1">//2014-06-06T00:41:19.550 </span>
</span><span class='line'><span class="c1">// LocalDate,LocalTime 沒有提供 ofInstant，需先轉成 LocalDateTime 後再 toLocalDate() 或 toLocalTime()</span>
</span><span class='line'><span class="n">LocalDate</span> <span class="n">localDate</span>  <span class="o">=</span> <span class="n">localDateTime</span><span class="o">.</span><span class="na">toLocalDate</span><span class="o">();</span> <span class="c1">//00:41:19.550</span>
</span><span class='line'><span class="n">LocalTime</span> <span class="n">localTime</span> <span class="o">=</span> <span class="n">localDateTime</span><span class="o">.</span><span class="na">toLocalTime</span><span class="o">();</span> <span class="c1">//2014-06-06</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>LocalDate -> Date</li>
<li>LocalTime -> Date</li>
<li>LocalDateTime -> Date</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">LocalDateTime</span> <span class="n">localDateTime</span> <span class="o">=</span> <span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
</span><span class='line'><span class="n">Instant</span> <span class="n">instant</span> <span class="o">=</span> <span class="n">localDateTime</span><span class="o">.</span><span class="na">toInstant</span><span class="o">(</span><span class="n">ZoneOffset</span><span class="o">.</span><span class="na">UTC</span><span class="o">);</span>
</span><span class='line'><span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">instant</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>日期格式</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="n">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">&quot;yyyy-MM-dd HH:mm&quot;</span><span class="o">));</span> <span class="c1">//2014-06-06 00:52</span>
</span></code></pre></td></tr></table></div></figure>


<p>LocalDateTime 是沒有時區資訊的，所以，如果要轉成 epoch (unix time)，就必需要加入時區資訊，沒有加入時區，就無法直接轉換。</p>

<p>LocalDateTime 對人來說，是使用上比較直覺的，不管在世界上任何一個地方 &#8216;2014-1-1 12:00:00&#8217; 都是指2014年第一天的中午12點，不用去管時區，但，如果把這個時間轉成格林威治時間(GMT)，或世界協調時間(UTC)，就必需加上時區的資料，才會正確，美國紐約的 &#8216;2014-1-1 12:00:00&#8217;跟台灣的&#8217;2014-1-1 12:00:00&#8217;, 一定是不一樣的，美國紐約是GMT - 4:00，台灣是GMT + 8:00</p>

<p>java的 getMillis() 的是採 unix timesamp(epoch)的設計，所以，如果要轉成 MILL</p>

<blockquote><p><a href="http://www.computerhope.com/jargon/e/epoch.htm">epoch</a>通常是指從1970/1/1 開始增加至今的秒數，最多可到2038-1-19 03:14:07 (32位元有號數最大值: 2,147,483,647)
<img src="http://en.wikipedia.org/wiki/Year_2038_problem#mediaviewer/File:Year_2038_problem.gif" alt="img" /></p></blockquote>

<h2>Resource</h2>

<ul>
<li><a href="http://docs.oracle.com/javase/tutorial/datetime/iso/legacy.html">http://docs.oracle.com/javase/tutorial/datetime/iso/legacy.html</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/14/umlet-sequence-diagram/">UMLet Sequence Diagram</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-14T12:05:00+08:00" pubdate data-updated="true">Mar 14<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/03/14/umlet-sequence-diagram/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://blog.kent-chiu.com/images/2014-05-14/umlet-sequence-diagram_001.jpg" alt="img_001" /></p>

<pre><code>title: sample
_alpha:A~id1_|_beta:B~id2_|_gamma:G~id3_
id1-&gt;&gt;id2:id1,id2
id2-/&gt;id1:async Msg.
id3-&gt;&gt;&gt;id1:id1,id3
id1.&gt;id3:id1,id3:async return Msg
id1-&gt;id1:id1:self
// this comment will not be render
iframe{:interaction frame
id2-&gt;id3:id1,id3:async Msg.
iframe}
</code></pre>

<p><code>title</code> : 圖左上方的標題</p>

<h2>Life Cycle</h2>

<p><code>_alpha:A~id1_</code> : alpha 是instance name, A: 是class name, id1 是識別用的id，用來當作其他圖示的reference，加上 <code>_</code> 則會出現下畫線</p>

<h2>Message</h2>

<p>訊息流向的基本格式為: <code>line:active:name</code> ，可以分成三段</p>

<ol>
<li><p>第一段是訊息的線條
訊息的線條又可分為</p>

<ul>
<li><code>-&gt;&gt;</code> 同步，空心箭頭</li>
<li><code>-/&gt;</code> 非同步，單邊箭頭</li>
<li>&#8217;->>>&#8217; 同步，實心箭頭</li>
<li>&#8217;.>&#8217; 非同步，虛線</li>
<li>&#8217;->&#8217; 同步</li>
</ul>
</li>
<li><p>第二段是訊息是否活動中
如果是活動中的訊息，會出現 execution specification (或者是 activation)</p></li>
<li><p>第三段是訊息的名稱，可省略</p></li>
</ol>


<p>ex:</p>

<p><code>id1-&gt;&gt;id2:id1,id2</code> :  <code>-&gt;&gt;</code> 表示同步訊息，從id1到id2
<code>id2-/&gt;id1:async Msg</code> : <code>-/&gt;</code> 表示非同步訊息，<code>async Msg</code>是訊息名稱
<code>3-&gt;&gt;&gt;1:1,3</code> : <code>-&gt;&gt;&gt;</code> 表示</p>

<h2>Interaction Fragment</h2>

<p>在 iframe 包來的範圍是 interaction fragment</p>

<h2>Resource</h2>

<ul>
<li><a href="http://www.uml-diagrams.org/sequence-diagrams.html">http://www.uml-diagrams.org/sequence-diagrams.html</a> uml圖示說明</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/28/python-type-hint-in-idea/">Python Type Hint in IDEA</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-28T12:09:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/12/28/python-type-hint-in-idea/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在現代的IDE中，程式碼自動完成(code assist or code complete)幾乎是必備的基本功能，這個功能在靜態功能型別的語言中，IDE通常可以很完全的運作；但是在動態型別的語言中，就常常沒辦法推斷出正確的型別了。
因為有的IDE從另外從程式碼外的其它地方(通常是註解)加入協助IDE做類型推斷(type infer)的動作。</p>

<p>IDEA的python plugin(或 pycharm)也是使用註解的做type hint來協助IDEA做類型推斷。如果是使用python3開發，那麼還可以用<a href="http://www.python.org/dev/peps/pep-3107/">PEP-3107</a>。
<em>PEP-3107</em>在語言的級別上加入了參數跟傳回值的型別，這樣IDE就有辦法做類型的推斷。</p>

<pre><code># 未採用PEP-3107的method宣告方式
def a_method(foo, bar) :
    return foobar;

# 採用PEP-3107的method宣告方式
def a_method(foo : TypeFoo, bar: TypeBar) -&gt; TypeFooBar
</code></pre>

<p>TypeFoo是參數foo的型別，TypeBar是參數bar的型別，而TypeFooBar則是 return value foobar的型別</p>

<p>但是以下幾種狀況是<em>PEP-3107</em>無法處理的:</p>

<ul>
<li>locale variable，如果 locale variable不是某個method的傳回值，那就沒有型別</li>
<li>field ，field也沒有型別</li>
<li>third party的lib，third party的lib寫法可能不是採用<em>PEP-3107</em>方式，所以ide也無法提供code complete</li>
</ul>


<p>計對這些狀況，可以用一開始提到的方式，套用特定的註解來協助IDE做類型推斷。</p>

<pre><code>r = praw.Reddit(user_agent='User-Agent: rbot/1.0 by draculacwg')
''':type: six.Subreddit ''' 
subreddit = r.get_subreddit(subreddits)
submissions = subreddit.get_new()
</code></pre>

<p>原來的<code>subreddit.get_new()</code>，原本沒有code complete，加入<code>''':type: six.Subreddit '''</code> 後，就會有code complete了</p>

<h4>IDEA 建議的type hinting 語法</h4>

<ul>
<li>Foo # Class Foo visible in the current scope</li>
<li>x.y.Bar # Class Bar from x.y module</li>
<li>Foo | Bar # Foo or Bar</li>
<li>(Foo, Bar) # Tuple of Foo and Bar</li>
<li>list[Foo] # List of Foo elements</li>
<li>dict[Foo, Bar] # Dict from Foo to Bar</li>
<li>T # Generic type (T-Z are reserved for generics)</li>
<li>T &lt;= Foo # Generic type with upper bound Foo</li>
<li>Foo[T] # Foo parameterized with T</li>
<li>(Foo, Bar) -> Baz # Function of Foo and Bar that returns Baz</li>
<li>list[dict[str, datetime]] # List of dicts from str to datetime (nested arguments)</li>
</ul>


<h2>Resource</h2>

<ul>
<li><a href="http://www.jetbrains.com/pycharm/webhelp/type-hinting-in-pycharm.html">http://www.jetbrains.com/pycharm/webhelp/type-hinting-in-pycharm.html</a> - pycharm 或 IDEA python plugin中 type hint的方式</li>
<li><a href="http://www.python.org/dev/peps/pep-0257/">http://www.python.org/dev/peps/pep-0257/</a> - PEP 257  : Docstring Conventions</li>
<li><a href="http://www.python.org/dev/peps/pep-3107/">http://www.python.org/dev/peps/pep-3107/</a> - PEP 3107 : python 3 中可用的類型註解</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/28/mac-dev-setup/">“Mac開發環境設定”</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-28T12:09:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/12/28/mac-dev-setup/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>mac os重裝，重裝後開發需要用到的工具及相關設定方式如下:</p>

<ul>
<li>JDK 1.8</li>
<li>Apache Maven 3.2.1</li>
<li>ruby</li>
<li>python</li>
<li>homebrew</li>
<li>octopress</li>
<li>postgresql</li>
</ul>


<h2>環境變數</h2>

<p>設定環境變數可以在<code>.bashrc</code>跟<code>.bashfile</code>,
為了保證不管透過遠端登入或在登入後另外開shell都會執行設定環境的動作，可以在<code>.bashfile</code>加入環境變數的設定，
但linux下的習慣以’.bashrc’為主，因為在linux環境下，反而是’.bashrc’會保證被執行到</p>

<p><code>vi ~/.bash_profile</code></p>

<pre><code>function setjdk() {
  if [ $# -ne 0 ]; then
   removeFromPath '/System/Library/Frameworks/JavaVM.framework/Home/bin'
   if [ -n "${JAVA_HOME+x}" ]; then
    removeFromPath $JAVA_HOME
   fi
   export JAVA_HOME=`/usr/libexec/java_home -v $@`
   export PATH=$JAVA_HOME/bin:$PATH
  fi
 }
 function removeFromPath() {
  export PATH=$(echo $PATH | sed -E -e "s;:$1;;" -e "s;$1:?;;")
 }
setjdk 1.8

export MAVEN_HOME=/Users/kent/dev/apache-maven-3.2.1
export M2_HOME=$MAVEN_HOME
export CATALINA_HOME=/Users/kent/dev/apache-tomcat-8.0.5
export GRADLE_HOME=/Users/kent/dev/gradle-1.10

export PATH=$MAVEN_HOME/bin:$GRADLE_HOME/bin:$PATH
</code></pre>

<p>完成後，記得執行一下 <code>source ~/.bash_profile</code>看看有沒有錯誤，然後便可以<code>echo $JAVA_HOME</code>看看java的部徑有沒有設定進去，
如果都ok，可以執行一下<code>java -version</code> 跟 &#8216;mvn -v&#8217;看一下java跟maven的版號</p>

<h4>Eclipse找不到jdk (JDK 7 only)</h4>

<p>Oracle沒有定義jvm 1.7的相容性，所以在gui環境eclipse會找不到jdk
解決的方式如下</p>

<pre><code># COPYjdk7的Info.plist出來修改
cp /Library/Java/JavaVirtualMachines/jdk.1.7.&lt;…&gt;/Contents/Info.plist ~/Downloads/
</code></pre>

<p>Info.plist</p>

<pre><code>&lt;key&gt;JVMCapabilities&lt;/key&gt;
 &lt;array&gt;
  &lt;string&gt;CommandLine&lt;/string&gt;
 &lt;/array&gt;
</code></pre>

<p>改成</p>

<pre><code>&lt;key&gt;JVMCapabilities&lt;/key&gt;
 &lt;array&gt;
  &lt;string&gt;JNI&lt;/string&gt;
  &lt;string&gt;BundledApp&lt;/string&gt;
  &lt;string&gt;WebStart&lt;/string&gt;
  &lt;string&gt;Applets&lt;/string&gt;
  &lt;string&gt;CommandLine&lt;/string&gt;
 &lt;/array&gt; 
</code></pre>

<p>之後再copy回去原來的地上，改完需重新登入或重開機，之後eclipse便可以執行了</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/16/reload-tomcat-web-application-by-jmx/">透過JMX重新載入Tomcat上的Web Application</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-16T15:45:00+08:00" pubdate data-updated="true">Nov 16<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/11/16/reload-tomcat-web-application-by-jmx/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>tomcat</h2>

<h2>test by jconsole</h2>

<p>啟動tomat</p>

<pre><code>kents-mbp:~ kent$ tail -f ~/dev/apache-tomcat-7.0.42/logs/catalina.out
Nov 16, 2013 4:05:29 PM org.apache.catalina.startup.HostConfig deployWAR
INFO: Deploying web application archive /Users/kent/dev/apache-tomcat-7.0.42/webapps/my-webapp.war
</code></pre>

<p>jconsole的位置在JDK的bin目錄下，執行後可以看到本機jvm運行中的程式。</p>

<p>一層一層展開下去可以看到tomcat有一個reload的節點，把節點的object name複製出來，程式會用到</p>

<p><code>Catalina/WebModule/"//localhost/my-webapp"/non/e/none/Operations/reload</code></p>

<p>jconsole可以直接執行reload的節點，執行後可以看到tomcat進行reload</p>

<pre><code>Nov 16, 2013 4:16:24 PM org.apache.catalina.core.StandardContext reload  # 透過JMX執行reload operation後可以看到tomcat對my-webapp進行reload
INFO: Reloading Context with name [/my-webapp] has started
Nov 16, 2013 4:16:25 PM org.apache.catalina.core.StandardContext reload
INFO: Reloading Context with name [/my-webapp] is completed
</code></pre>

<p>也可以透過程式進行jmx呼叫，下面的程式是透過spring3執行jmx</p>

<pre><code>// bean的configration檔
public MBeanServerConnection jmxConnector() {
    MBeanServerConnectionFactoryBean factoryBean =new MBeanServerConnectionFactoryBean();
    try {
        factoryBean.setServiceUrl("service:jmx:rmi://localhost/jndi/rmi://localhost:1099/jmxrmi");
        factoryBean.afterPropertiesSet();
        MBeanServerConnection connection = factoryBean.getObject();
        return connection;
    } catch (Exception e) {
        e.printStackTrace();
    }
    return null;
}


// 程式
@Autowaire
private MBeanServerConnection connection;

public void reloadWebApplication() {
    try {
        ObjectName objectName = new ObjectName("Catalina:j2eeType=WebModule,name=//localhost/idcview,J2EEApplication=none,J2EEServer=none");
        connection.invoke(objectName, "reload", null, null); // 執行tomcat的reload
    } catch (Exception e) {
        e.printStackTrace();
    }
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/31/access-imgur-with-api/">Access Imgur With API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-31T01:20:00+08:00" pubdate data-updated="true">Aug 31<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/08/31/access-imgur-with-api/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li>先註冊 <a href="http://imgur.com/">imgur</a> 的帳號</li>
<li>申請API使用權限
<img src="http://blog.kent-chiu.com/images/2013-08-31/2013-08-31-access-imgur-with-api-001.png" alt="2013-08-31-access-imgur-with-api-001.png" /></li>
<li>註冊成後功，imgur會寄信到email裡，裡面會有 client_id 跟 client_secret</li>
<li><p>試車 <code>https://api.imgur.com/3/gallery.json</code> 是取得</p>

<pre><code>curl https://api.imgur.com/3/gallery.json -i -H "Authorization: Client-ID 69a8cxxxxxxxxxx" 

HTTP/1.1 200 OK
Server: nginx
Date: Fri, 30 Aug 2013 17:59:29 GMT
Content-Type: application/json
Transfer-Encoding: chunked
Connection: keep-alive
…..
</code></pre>

<p>如果看到    http status code 200，就表示成功了</p>

<blockquote><p>69a8cxxxxxxxxxx -> 換成你自已的 client_id</p></blockquote></li>
</ol>


<h4>取得相簿</h4>

<pre><code>curl -i -H "Authorization: Client-ID 69a8cxxxxxxxxxx"  https://api.imgur.com/3/gallery/album/lDRB2/json
    https://api.imgur.com/3/gallery/album/lDRB2/json

{
    "data": {
        "id": "lDRB2",
        "title": "Imgur Office",
        "description": null,
        "datetime": 1357856292,
        "cover": "24nLu",
        "account_url": "Alan",
        "privacy": "public",
        "layout": "blog",
        "views": 13780,
        "link": "http://alanbox.imgur.com/a/lDRB2",
        "ups": 1602,
        "downs": 14,
        "score": 1917,
        "is_album": true,
        "vote": null,
        "images_count": 11,
        "images": [
            {
                "id": "24nLu",
                "title": null,
                "description": null,
                "datetime": 1357856352,
                "type": "image/jpeg",
                "animated": false,
                "width": 2592,
                "height": 1944,
                "size": 855658,
                "views": 135772,
                "bandwidth": 116174397976,
                "link": "http://i.imgur.com/24nLu.jpg"
            },
            {
                "id": "Ziz25",
                "title": null,
                "description": null,
                "datetime": 1357856394,
                "type": "image/jpeg",
                "animated": false,
                "width": 2592,
                "height": 1944,
                "size": 919391,
                "views": 135493,
                "bandwidth": 124571044763,
                "link": "http://i.imgur.com/Ziz25.jpg"
            },
            {
                "id": "9tzW6",
                "title": null,
                "description": null,
                "datetime": 1357856385,
                "type": "image/jpeg",
                "animated": false,
                "width": 2592,
                "height": 1944,
                "size": 655028,
                "views": 135063,
                "bandwidth": 88470046764,
                "link": "http://i.imgur.com/9tzW6.jpg"
            },
            {
                "id": "dFg5u",
                "title": null,
                "description": null,
                "datetime": 1357856378,
                "type": "image/jpeg",
                "animated": false,
                "width": 2592,
                "height": 1944,
                "size": 812738,
                "views": 134704,
                "bandwidth": 109479059552,
                "link": "http://i.imgur.com/dFg5u.jpg"
            },
            {
                "id": "oknLx",
                "title": null,
                "description": null,
                "datetime": 1357856338,
                "type": "image/jpeg",
                "animated": false,
                "width": 1749,
                "height": 2332,
                "size": 717324,
                "views": 32938,
                "bandwidth": 23627217912,
                "link": "http://i.imgur.com/oknLx.jpg"
            },
            {
                "id": "OL6tC",
                "title": null,
                "description": null,
                "datetime": 1357856321,
                "type": "image/jpeg",
                "animated": false,
                "width": 2592,
                "height": 1944,
                "size": 1443262,
                "views": 32346,
                "bandwidth": 46683752652,
                "link": "http://i.imgur.com/OL6tC.jpg"
            },
            {
                "id": "cJ9cm",
                "title": null,
                "description": null,
                "datetime": 1357856330,
                "type": "image/jpeg",
                "animated": false,
                "width": 2592,
                "height": 1944,
                "size": 544702,
                "views": 31829,
                "bandwidth": 17337319958,
                "link": "http://i.imgur.com/cJ9cm.jpg"
            },
            {
                "id": "7BtPN",
                "title": null,
                "description": null,
                "datetime": 1357856369,
                "type": "image/jpeg",
                "animated": false,
                "width": 2592,
                "height": 1944,
                "size": 844863,
                "views": 31257,
                "bandwidth": 26407882791,
                "link": "http://i.imgur.com/7BtPN.jpg"
            },
            {
                "id": "42ib8",
                "title": null,
                "description": null,
                "datetime": 1357856424,
                "type": "image/jpeg",
                "animated": false,
                "width": 2592,
                "height": 1944,
                "size": 905073,
                "views": 30945,
                "bandwidth": 28007483985,
                "link": "http://i.imgur.com/42ib8.jpg"
            },
            {
                "id": "BbwIx",
                "title": null,
                "description": null,
                "datetime": 1357856360,
                "type": "image/jpeg",
                "animated": false,
                "width": 1749,
                "height": 2332,
                "size": 662413,
                "views": 30107,
                "bandwidth": 19943268191,
                "link": "http://i.imgur.com/BbwIx.jpg"
            },
            {
                "id": "x7b91",
                "title": null,
                "description": null,
                "datetime": 1357856406,
                "type": "image/jpeg",
                "animated": false,
                "width": 1944,
                "height": 2592,
                "size": 618567,
                "views": 29259,
                "bandwidth": 18098651853,
                "link": "http://i.imgur.com/x7b91.jpg"
            }
        ]
    },
    "success": true,
    "status": 200
}               
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/08/30/liquibase-101/">Liquibase 筆記</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/30/spring-boot-101/">Spring Boot筆記</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/14/java-8-lambda/">Java 8 Lambda</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/14/java-8-utility-object/">Java 8 好用工具箱</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/14/java-8-date-and-time-api/">Java 8 時間、日期 API</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Category Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/actionbar' style='font-size: 102.4%'>actionbar(1)</a> <a href='/blog/categories/android' style='font-size: 160.0%'>android(25)</a> <a href='/blog/categories/apache' style='font-size: 116.8%'>apache(7)</a> <a href='/blog/categories/authentication' style='font-size: 102.4%'>authentication(1)</a> <a href='/blog/categories/authorization' style='font-size: 102.4%'>authorization(1)</a> <a href='/blog/categories/bash' style='font-size: 109.6%'>bash(4)</a> <a href='/blog/categories/best-practice' style='font-size: 102.4%'>best_practice(1)</a> <a href='/blog/categories/book' style='font-size: 102.4%'>book(1)</a> <a href='/blog/categories/broadcast-receiver' style='font-size: 104.8%'>broadcast_receiver(2)</a> <a href='/blog/categories/cdi' style='font-size: 104.8%'>cdi(2)</a> <a href='/blog/categories/centos' style='font-size: 112.0%'>centos(5)</a> <a href='/blog/categories/clean-code' style='font-size: 102.4%'>clean code(1)</a> <a href='/blog/categories/clojure' style='font-size: 102.4%'>clojure(1)</a> <a href='/blog/categories/command' style='font-size: 112.0%'>command(5)</a> <a href='/blog/categories/concurrency' style='font-size: 102.4%'>concurrency(1)</a> <a href='/blog/categories/curl' style='font-size: 102.4%'>curl(1)</a> <a href='/blog/categories/database' style='font-size: 116.8%'>database(7)</a> <a href='/blog/categories/datetime' style='font-size: 102.4%'>datetime(1)</a> <a href='/blog/categories/di' style='font-size: 104.8%'>di(2)</a> <a href='/blog/categories/drawable' style='font-size: 102.4%'>drawable(1)</a> <a href='/blog/categories/ec' style='font-size: 102.4%'>ec(1)</a> <a href='/blog/categories/eclipse' style='font-size: 102.4%'>eclipse(1)</a> <a href='/blog/categories/ecshop' style='font-size: 116.8%'>ecshop(7)</a> <a href='/blog/categories/editor' style='font-size: 102.4%'>editor(1)</a> <a href='/blog/categories/emulator' style='font-size: 102.4%'>emulator(1)</a> <a href='/blog/categories/encoding' style='font-size: 102.4%'>encoding(1)</a> <a href='/blog/categories/english' style='font-size: 133.6%'>english(14)</a> <a href='/blog/categories/excel' style='font-size: 104.8%'>excel(2)</a> <a href='/blog/categories/extjs' style='font-size: 104.8%'>extjs(2)</a> <a href='/blog/categories/functional-programming' style='font-size: 102.4%'>functional programming(1)</a> <a href='/blog/categories/gesture' style='font-size: 102.4%'>gesture(1)</a> <a href='/blog/categories/git' style='font-size: 109.6%'>git(4)</a> <a href='/blog/categories/git-flow' style='font-size: 102.4%'>git-flow(1)</a> <a href='/blog/categories/guava' style='font-size: 104.8%'>guava(2)</a> <a href='/blog/categories/guice' style='font-size: 102.4%'>guice(1)</a> <a href='/blog/categories/hamcrest' style='font-size: 102.4%'>hamcrest(1)</a> <a href='/blog/categories/i18n' style='font-size: 102.4%'>i18n(1)</a> <a href='/blog/categories/ide' style='font-size: 102.4%'>IDE(1)</a> <a href='/blog/categories/idea' style='font-size: 104.8%'>IDEA(2)</a> <a href='/blog/categories/imgur' style='font-size: 102.4%'>imgur(1)</a> <a href='/blog/categories/injection' style='font-size: 102.4%'>injection(1)</a> <a href='/blog/categories/intent' style='font-size: 102.4%'>intent(1)</a> <a href='/blog/categories/ireport' style='font-size: 104.8%'>ireport(2)</a> <a href='/blog/categories/jasterreport' style='font-size: 104.8%'>jasterreport(2)</a> <a href='/blog/categories/java' style='font-size: 152.8%'>java(22)</a> <a href='/blog/categories/java8' style='font-size: 104.8%'>java8(2)</a> <a href='/blog/categories/java-ee' style='font-size: 112.0%'>java_ee(5)</a> <a href='/blog/categories/jms' style='font-size: 102.4%'>jms(1)</a> <a href='/blog/categories/jmx' style='font-size: 102.4%'>JMX(1)</a> <a href='/blog/categories/joda' style='font-size: 102.4%'>joda(1)</a> <a href='/blog/categories/jpa' style='font-size: 102.4%'>jpa(1)</a> <a href='/blog/categories/jquery' style='font-size: 102.4%'>jquery(1)</a> <a href='/blog/categories/jsp' style='font-size: 104.8%'>jsp(2)</a> <a href='/blog/categories/junit' style='font-size: 102.4%'>junit(1)</a> <a href='/blog/categories/jvm' style='font-size: 104.8%'>jvm(2)</a> <a href='/blog/categories/kohana' style='font-size: 102.4%'>kohana(1)</a> <a href='/blog/categories/l10n' style='font-size: 102.4%'>l10n(1)</a> <a href='/blog/categories/lambda' style='font-size: 102.4%'>lambda(1)</a> <a href='/blog/categories/layout' style='font-size: 102.4%'>layout(1)</a> <a href='/blog/categories/linux' style='font-size: 126.4%'>linux(11)</a> <a href='/blog/categories/liquibase' style='font-size: 102.4%'>liquibase(1)</a> <a href='/blog/categories/listview' style='font-size: 104.8%'>listview(2)</a> <a href='/blog/categories/logger' style='font-size: 102.4%'>logger(1)</a> <a href='/blog/categories/m2eclilpse' style='font-size: 102.4%'>m2eclilpse(1)</a> <a href='/blog/categories/mac' style='font-size: 107.2%'>mac(3)</a> <a href='/blog/categories/mat' style='font-size: 102.4%'>mat(1)</a> <a href='/blog/categories/maven' style='font-size: 112.0%'>maven(5)</a> <a href='/blog/categories/memory' style='font-size: 102.4%'>memory(1)</a> <a href='/blog/categories/menu' style='font-size: 102.4%'>menu(1)</a> <a href='/blog/categories/mindmap' style='font-size: 104.8%'>mindmap(2)</a> <a href='/blog/categories/misc' style='font-size: 102.4%'>misc(1)</a> <a href='/blog/categories/mysql' style='font-size: 116.8%'>mysql(7)</a> <a href='/blog/categories/nio' style='font-size: 102.4%'>nio(1)</a> <a href='/blog/categories/octopress' style='font-size: 102.4%'>octopress(1)</a> <a href='/blog/categories/oracle' style='font-size: 102.4%'>oracle(1)</a> <a href='/blog/categories/osgi' style='font-size: 107.2%'>osgi(3)</a> <a href='/blog/categories/pdf' style='font-size: 104.8%'>pdf(2)</a> <a href='/blog/categories/pdt' style='font-size: 112.0%'>pdt(5)</a> <a href='/blog/categories/pear' style='font-size: 104.8%'>pear(2)</a> <a href='/blog/categories/performace' style='font-size: 102.4%'>performace(1)</a> <a href='/blog/categories/pgsql' style='font-size: 102.4%'>pgsql(1)</a> <a href='/blog/categories/php' style='font-size: 114.4%'>php(6)</a> <a href='/blog/categories/play-framework' style='font-size: 102.4%'>play_framework(1)</a> <a href='/blog/categories/pm' style='font-size: 112.0%'>pm(5)</a> <a href='/blog/categories/postgresql' style='font-size: 104.8%'>postgresql(2)</a> <a href='/blog/categories/profile' style='font-size: 102.4%'>profile(1)</a> <a href='/blog/categories/programming' style='font-size: 128.8%'>programming(12)</a> <a href='/blog/categories/python' style='font-size: 104.8%'>python(2)</a> <a href='/blog/categories/re' style='font-size: 102.4%'>re(1)</a> <a href='/blog/categories/refactory' style='font-size: 104.8%'>refactory(2)</a> <a href='/blog/categories/rest' style='font-size: 116.8%'>rest(7)</a> <a href='/blog/categories/roboguice' style='font-size: 102.4%'>roboguice(1)</a> <a href='/blog/categories/sbt' style='font-size: 102.4%'>sbt(1)</a> <a href='/blog/categories/scala' style='font-size: 109.6%'>scala(4)</a> <a href='/blog/categories/security' style='font-size: 104.8%'>security(2)</a> <a href='/blog/categories/sequence-diagram' style='font-size: 102.4%'>sequence_diagram(1)</a> <a href='/blog/categories/service' style='font-size: 104.8%'>service(2)</a> <a href='/blog/categories/shiro' style='font-size: 102.4%'>shiro(1)</a> <a href='/blog/categories/shortchut' style='font-size: 102.4%'>shortchut(1)</a> <a href='/blog/categories/smarty' style='font-size: 107.2%'>smarty(3)</a> <a href='/blog/categories/spring' style='font-size: 107.2%'>spring(3)</a> <a href='/blog/categories/spring-boot' style='font-size: 102.4%'>spring-boot(1)</a> <a href='/blog/categories/sql' style='font-size: 102.4%'>sql(1)</a> <a href='/blog/categories/style' style='font-size: 102.4%'>style(1)</a> <a href='/blog/categories/tdd' style='font-size: 102.4%'>tdd(1)</a> <a href='/blog/categories/testing' style='font-size: 124.0%'>testing(10)</a> <a href='/blog/categories/theme' style='font-size: 102.4%'>theme(1)</a> <a href='/blog/categories/tips' style='font-size: 104.8%'>tips(2)</a> <a href='/blog/categories/tomcat' style='font-size: 102.4%'>tomcat(1)</a> <a href='/blog/categories/ubuntu' style='font-size: 119.2%'>ubuntu(8)</a> <a href='/blog/categories/ui' style='font-size: 104.8%'>ui(2)</a> <a href='/blog/categories/uml' style='font-size: 102.4%'>uml(1)</a> <a href='/blog/categories/umlet' style='font-size: 102.4%'>umlet(1)</a> <a href='/blog/categories/vim' style='font-size: 104.8%'>vim(2)</a> <a href='/blog/categories/web' style='font-size: 104.8%'>web(2)</a> <a href='/blog/categories/windows' style='font-size: 102.4%'>windows(1)</a> <a href='/blog/categories/xampp' style='font-size: 102.4%'>xampp(1)</a> <a href='/blog/categories/xml' style='font-size: 104.8%'>xml(2)</a> </span>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/actionbar'>actionbar (1)</a></li><li><a href='/blog/categories/android'>android (25)</a></li><li><a href='/blog/categories/apache'>apache (7)</a></li><li><a href='/blog/categories/authentication'>authentication (1)</a></li><li><a href='/blog/categories/authorization'>authorization (1)</a></li><li><a href='/blog/categories/bash'>bash (4)</a></li><li><a href='/blog/categories/best-practice'>best_practice (1)</a></li><li><a href='/blog/categories/book'>book (1)</a></li><li><a href='/blog/categories/broadcast-receiver'>broadcast_receiver (2)</a></li><li><a href='/blog/categories/cdi'>cdi (2)</a></li><li><a href='/blog/categories/centos'>centos (5)</a></li><li><a href='/blog/categories/clean-code'>clean code (1)</a></li><li><a href='/blog/categories/clojure'>clojure (1)</a></li><li><a href='/blog/categories/command'>command (5)</a></li><li><a href='/blog/categories/concurrency'>concurrency (1)</a></li><li><a href='/blog/categories/curl'>curl (1)</a></li><li><a href='/blog/categories/database'>database (7)</a></li><li><a href='/blog/categories/datetime'>datetime (1)</a></li><li><a href='/blog/categories/di'>di (2)</a></li><li><a href='/blog/categories/drawable'>drawable (1)</a></li><li><a href='/blog/categories/ec'>ec (1)</a></li><li><a href='/blog/categories/eclipse'>eclipse (1)</a></li><li><a href='/blog/categories/ecshop'>ecshop (7)</a></li><li><a href='/blog/categories/editor'>editor (1)</a></li><li><a href='/blog/categories/emulator'>emulator (1)</a></li><li><a href='/blog/categories/encoding'>encoding (1)</a></li><li><a href='/blog/categories/english'>english (14)</a></li><li><a href='/blog/categories/excel'>excel (2)</a></li><li><a href='/blog/categories/extjs'>extjs (2)</a></li><li><a href='/blog/categories/functional-programming'>functional programming (1)</a></li><li><a href='/blog/categories/gesture'>gesture (1)</a></li><li><a href='/blog/categories/git'>git (4)</a></li><li><a href='/blog/categories/git-flow'>git-flow (1)</a></li><li><a href='/blog/categories/guava'>guava (2)</a></li><li><a href='/blog/categories/guice'>guice (1)</a></li><li><a href='/blog/categories/hamcrest'>hamcrest (1)</a></li><li><a href='/blog/categories/i18n'>i18n (1)</a></li><li><a href='/blog/categories/ide'>IDE (1)</a></li><li><a href='/blog/categories/idea'>IDEA (2)</a></li><li><a href='/blog/categories/imgur'>imgur (1)</a></li><li><a href='/blog/categories/injection'>injection (1)</a></li><li><a href='/blog/categories/intent'>intent (1)</a></li><li><a href='/blog/categories/ireport'>ireport (2)</a></li><li><a href='/blog/categories/jasterreport'>jasterreport (2)</a></li><li><a href='/blog/categories/java'>java (22)</a></li><li><a href='/blog/categories/java8'>java8 (2)</a></li><li><a href='/blog/categories/java-ee'>java_ee (5)</a></li><li><a href='/blog/categories/jms'>jms (1)</a></li><li><a href='/blog/categories/jmx'>JMX (1)</a></li><li><a href='/blog/categories/joda'>joda (1)</a></li><li><a href='/blog/categories/jpa'>jpa (1)</a></li><li><a href='/blog/categories/jquery'>jquery (1)</a></li><li><a href='/blog/categories/jsp'>jsp (2)</a></li><li><a href='/blog/categories/junit'>junit (1)</a></li><li><a href='/blog/categories/jvm'>jvm (2)</a></li><li><a href='/blog/categories/kohana'>kohana (1)</a></li><li><a href='/blog/categories/l10n'>l10n (1)</a></li><li><a href='/blog/categories/lambda'>lambda (1)</a></li><li><a href='/blog/categories/layout'>layout (1)</a></li><li><a href='/blog/categories/linux'>linux (11)</a></li><li><a href='/blog/categories/liquibase'>liquibase (1)</a></li><li><a href='/blog/categories/listview'>listview (2)</a></li><li><a href='/blog/categories/logger'>logger (1)</a></li><li><a href='/blog/categories/m2eclilpse'>m2eclilpse (1)</a></li><li><a href='/blog/categories/mac'>mac (3)</a></li><li><a href='/blog/categories/mat'>mat (1)</a></li><li><a href='/blog/categories/maven'>maven (5)</a></li><li><a href='/blog/categories/memory'>memory (1)</a></li><li><a href='/blog/categories/menu'>menu (1)</a></li><li><a href='/blog/categories/mindmap'>mindmap (2)</a></li><li><a href='/blog/categories/misc'>misc (1)</a></li><li><a href='/blog/categories/mysql'>mysql (7)</a></li><li><a href='/blog/categories/nio'>nio (1)</a></li><li><a href='/blog/categories/octopress'>octopress (1)</a></li><li><a href='/blog/categories/oracle'>oracle (1)</a></li><li><a href='/blog/categories/osgi'>osgi (3)</a></li><li><a href='/blog/categories/pdf'>pdf (2)</a></li><li><a href='/blog/categories/pdt'>pdt (5)</a></li><li><a href='/blog/categories/pear'>pear (2)</a></li><li><a href='/blog/categories/performace'>performace (1)</a></li><li><a href='/blog/categories/pgsql'>pgsql (1)</a></li><li><a href='/blog/categories/php'>php (6)</a></li><li><a href='/blog/categories/play-framework'>play_framework (1)</a></li><li><a href='/blog/categories/pm'>pm (5)</a></li><li><a href='/blog/categories/postgresql'>postgresql (2)</a></li><li><a href='/blog/categories/profile'>profile (1)</a></li><li><a href='/blog/categories/programming'>programming (12)</a></li><li><a href='/blog/categories/python'>python (2)</a></li><li><a href='/blog/categories/re'>re (1)</a></li><li><a href='/blog/categories/refactory'>refactory (2)</a></li><li><a href='/blog/categories/rest'>rest (7)</a></li><li><a href='/blog/categories/roboguice'>roboguice (1)</a></li><li><a href='/blog/categories/sbt'>sbt (1)</a></li><li><a href='/blog/categories/scala'>scala (4)</a></li><li><a href='/blog/categories/security'>security (2)</a></li><li><a href='/blog/categories/sequence-diagram'>sequence_diagram (1)</a></li><li><a href='/blog/categories/service'>service (2)</a></li><li><a href='/blog/categories/shiro'>shiro (1)</a></li><li><a href='/blog/categories/shortchut'>shortchut (1)</a></li><li><a href='/blog/categories/smarty'>smarty (3)</a></li><li><a href='/blog/categories/spring'>spring (3)</a></li><li><a href='/blog/categories/spring-boot'>spring-boot (1)</a></li><li><a href='/blog/categories/sql'>sql (1)</a></li><li><a href='/blog/categories/style'>style (1)</a></li><li><a href='/blog/categories/tdd'>tdd (1)</a></li><li><a href='/blog/categories/testing'>testing (10)</a></li><li><a href='/blog/categories/theme'>theme (1)</a></li><li><a href='/blog/categories/tips'>tips (2)</a></li><li><a href='/blog/categories/tomcat'>tomcat (1)</a></li><li><a href='/blog/categories/ubuntu'>ubuntu (8)</a></li><li><a href='/blog/categories/ui'>ui (2)</a></li><li><a href='/blog/categories/uml'>uml (1)</a></li><li><a href='/blog/categories/umlet'>umlet (1)</a></li><li><a href='/blog/categories/vim'>vim (2)</a></li><li><a href='/blog/categories/web'>web (2)</a></li><li><a href='/blog/categories/windows'>windows (1)</a></li><li><a href='/blog/categories/xampp'>xampp (1)</a></li><li><a href='/blog/categories/xml'>xml (2)</a></li></ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Kent -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kentchiu';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
