
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Kent's Blog</title>
  <meta name="author" content="Kent">

  
  <meta name="description" content="maven的command是有次序性的 ex:
mvn clean install source:jar javadoc:jar
只會產生source.jar跟javadoc.jar在target目錄下，但是
mvn clean source:jar javadoc:jar install &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.kent-chiu.com/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Kent's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39152849-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Kent's Blog</a></h1>
  
    <h2>Kent的學習筆記</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.kent-chiu.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/07/resource/">Maven Resources</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-07T00:00:00+08:00" pubdate data-updated="true">Dec 7<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/12/07/resource/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>maven的command是有次序性的 ex:
<code>mvn clean install source:jar javadoc:jar</code>
只會產生source.jar跟javadoc.jar在target目錄下，但是
<code>mvn clean source:jar javadoc:jar install</code>
就會產生source.jar跟javadoc.jar並安裝到local的repository，
善用這個特性可以加快building的速度</p>

<h3>m2eclipse</h3>

<p>使用m2eclipse時如果過到maven
console出現求要使用jdk不要使用jre的訊息時，可以透過以-vm指定vm</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>....
</span><span class='line'>
</span><span class='line'>-install
</span><span class='line'>C:\Users\Kent\AppData\Local\Genuitec\Profiles\Bellwin_3.6
</span><span class='line'>#用這一行指定eclipse使用的vm是jdk版本而不是jre版本後，就正常了
</span><span class='line'>-vm 
</span><span class='line'>C:\Program Files\Java\jdk1.6.0_25\bin\javaw.exe 
</span><span class='line'>-configuration
</span><span class='line'>C:\Users\Kent\AppData\Local\Genuitec\Profiles\Bellwin_3.6\configuration
</span><span class='line'>-vmargs
</span><span class='line'>-Xms250m
</span><span class='line'>-Xmx768m</span></code></pre></td></tr></table></div></figure>


<h3>download source &amp; javadoc</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn dependency:sources
</span><span class='line'>mvn dependency:resolve -Dclassifier=javadoc</span></code></pre></td></tr></table></div></figure>


<h3>版本檢查，java source下載</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>versions:display-dependency-updates versions:display-plugin-updates versions:display-property-updates   dependency:sources dependency:resolve -Dclassifier=javadoc</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/15/extjs_101/">EXT JS 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-15T00:00:00+08:00" pubdate data-updated="true">Nov 15<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/11/15/extjs_101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本文章內容在說明<a href="http://www.sencha.com/" title="http://www.sencha.com/">EXT JS
4</a>的基本知識。”EXT JS
4”(以下簡稱ext)是<a href="http://www.sencha.com/" title="http://www.sencha.com/">Sencha</a>公司出的一套javascript
lib，有兩種授權模式，但基本上”就是要錢”。</p>

<p>從架構面來看ext可以分成兩部份，ext core跟ext UI componment，ext
core的部份是跟ui比較沒有關係的核心模型，像資料模型<a href="#model" title="extjs:extjs_101 ↵">Model</a>、後端的溝通處理用的<a href="#proxy" title="extjs:extjs_101 ↵">Proxy</a>、以及<a href="#plugin" title="extjs:extjs_101 ↵">Plugin</a>跟<a href="#extension" title="extjs:extjs_101 ↵">Extension</a>
。而ext UI
componment就是一堆UI元件。建議在看完簡單的文件，玩玩ext的hello
word程式後，可以先從內功(ext
core)下手，等內功任督二脈打通了後，外功(UI元件)再個個擊破就很快了。</p>

<h2>Data Package</h2>

<p>整個Data Package的主要觀念如下圖:</p>

<p><img src="http://blog.kent-chiu.com/images/2012-11-15/extjs_101_001.png" alt="extjs_101_001.png" /></p>

<h3>Model</h3>

<p>Model就是資料模型，像User的model，就是具有username, password,
email,….這些屬性(圖中的Field)的資料模型，
模型的驗証邏輯(圖中的Validation)及與其他模組關聯(Association)。</p>

<h5>Validation</h5>

<p>可以是單位欄位性質得欄位型態，內容，長度…驗証，也可以是同一個model裡欄位與欄位間關係的驗証，甚至少
Business Logic的驗証。</p>

<p>過於複雜的驗証，最後再後端處理後，再送回前端</p>

<h3>Proxy</h3>

<p>Proxy負看將資料載入model或儲存model的資料。可分為Client Proxy及Server
Proxy</p>

<h5>Client Proxy</h5>

<ol>
<li><p>WebStorageProxy</p>

<ol>
<li>LocalStorageProxy</li>
<li>SessionStorageProxy</li>
</ol>
</li>
<li><p>MemoryProxy</p></li>
</ol>


<h5>Server Proxy</h5>

<ol>
<li><p>AjaxProxy - 透過AJAX跟後端溝通(常用)</p>

<ol>
<li>RestProxy - 透過REST跟後端REST service進行溝通(利用HTTP protocol
的uri代表資源位置，GET, POST, PUT, DELETE
methods來對資源進行Read, Save, Update, Delete的動作)</li>
</ol>
</li>
<li><p>ScriptTagProxy - 透遛JSONP(JSON with
Padding)的方式與其他domain的server溝通</p></li>
<li>DirectProxy -</li>
</ol>


<p>JSONP(JSON with
Padding):browser的限制不能存取其他網域(domain)的資料，而JSONP是利用JSON
+ callback function來跨越這個限制</p>

<h5>Reader</h5>

<p>Reader負責來解析資料格式，目前有</p>

<ol>
<li><p>JsonReader (預設)</p>

<ol>
<li>ArrayReader</li>
</ol>
</li>
<li><p>XmlReader</p></li>
</ol>


<h5>Writer</h5>

<p>Writer比Reader複雜一些，通常是被Server
Proxy使用，Writer裡面有一個叫Operation，Operation會決定url的格式內容及參數。
透過改成Operation.action 為&#8217;create&#8217;, &#8216;read&#8217;, &#8216;update&#8217; or
&#8216;destroy&#8217;可以決定要對Server Proxy送出什麼樣的url</p>

<h3>Store</h3>

<p>如果將Model視為處理一筆資料的物件，那麼我們可以說，Store多筆資料(Model)的物件，Store跟Model一樣可以透過Proxy讀取或儲存資料。
而Store因為資料內容是多筆的，所以，還可以對這些資料進行排序(sorting)，過濾(filtering)，郡組(Grouping)或查詢(querying)的動作.</p>

<h2>如何看懂API</h2>

<p>為了學習如果使用API進行開發，以下設計了一個簡單的例子來說明如果使用FireBug
+ ExtJS的API說明文件來進行練習</p>

<p>一般來說，我們會透過ajax
proxy跟後端要資料，一開始，我們可以用一個簡單的純文字檔，讓proxy直接跟檔案要資料，而不是跟server
side要</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[{"id":1,"name":"kent","email":null},{"id":2,"name":"juiwen","email":null},{"id":3,"name":"Roger","email":null}]</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;script type="text/javascript" src="%EXT_HOME%/ext-core-debug.js"&gt;&lt;/script&gt;
</span><span class='line'>&lt;script type="text/javascript" src="%EXT_HOME%/ext-all-debug.js"&gt;&lt;/script&gt;
</span><span class='line'> 
</span><span class='line'>Ext.require([
</span><span class='line'>             'Ext.data.*',
</span><span class='line'>         ]);
</span><span class='line'>Ext.onReady(function(){
</span><span class='line'> 
</span><span class='line'> 
</span><span class='line'>    Ext.regModel('User', {
</span><span class='line'>        fields: ['id', 'name', 'email'],
</span><span class='line'>        proxy: {
</span><span class='line'>            type: 'ajax', // load using HTTP
</span><span class='line'>            url: 'model.json' // 載入下面的json檔案
</span><span class='line'>        }
</span><span class='line'>    });
</span><span class='line'>    var user = Ext.ModelMgr.getModel('User');
</span><span class='line'>    // 宣告剛成後，user只是一個Ext.data.Model型別的物件
</span><span class='line'>    // 查Ext.data.Model的API doc可以知道，有一個load method可以用來載入資料
</span><span class='line'>    // 載入json file第一筆{id=1, name='kent'}記錄進user
</span><span class='line'>    user.load(1, {
</span><span class='line'>        scope: this,
</span><span class='line'>        failure: function(record, operation) {
</span><span class='line'>            // 載入失敗時，這個method會被呼叫
</span><span class='line'>        },
</span><span class='line'>        success: function(record, operation) {
</span><span class='line'>            // 載入成功時，這個method會被呼叫
</span><span class='line'>            conlog.log(record); // record本時為json file的第一筆資料，但是Ext.data.Model
</span><span class='line'>        }
</span><span class='line'>    });
</span><span class='line'>    console.log(user); // 注意:這樣得到的user是會空的，因為，取得資料的method 'load'是非同步的，所以，load還沒取回資料前，就會執行load之後的動作了
</span><span class='line'> 
</span><span class='line'> 
</span><span class='line'>    var userStore = new Ext.data.Store({
</span><span class='line'>        model: 'User',
</span><span class='line'>        autoLoad: true,
</span><span class='line'>    });
</span><span class='line'> 
</span><span class='line'>    userStore.on('load', function(self, records, success) {
</span><span class='line'>        // Ext.data.Store.data是Ext.util.MixedCollection型別，MixedCollection中有each method可以取得集合內的每一個內容，每一個內容均為Ext.data.Model
</span><span class='line'>        userStore.data.each(function(item, index, length){
</span><span class='line'>            // item此時為json file的"某"一筆資料，被包裝成Ext.data.Model型別,Ext.data.Model有一個data的屬性可以取得物件
</span><span class='line'>            console.log(item.data.name)
</span><span class='line'>        });
</span><span class='line'>    });
</span><span class='line'>&lt;/script&gt;
</span><span class='line'> 
</span><span class='line'>&lt;title&gt;Model Example&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>EXT JS Model Test
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;</span></code></pre></td></tr></table></div></figure>


<h4>透過plugin + API Doc</h4>

<p>EXT是利用動態語言JavaScript寫的，由於動態語言的特性是在Runtime的才能知道物件真正的內容為何，如果要光靠API做物件型別的推斷，會很辛苦。
再加上EXT JS
4版後，採用Mixins的技術，會讓物件型別的推斷更加麻煩，所以，建議在API不熟前，可以多利用Debugger工具，在runtime去查出物件的真正型別
，這樣對初學者，會比較容易克服ext的進入門檻。</p>

<h5>API inspect in action</h5>

<p>這裡利用FireBug + <a href="http://www.illuminations-for-developers.com/" title="http://www.illuminations-for-developers.com/">extjs
plugin</a>來觀查extjs元件內容並說明如何搭配API文件來將程式改成符合我們需求的設定。</p>

<p>FireBug必須利用script
debugger的功能，設定中斷點後，執行script會停在中斷點上，便可在執行時可以得知物件型別，對照API一起看，就會很清楚了</p>

<p><img src="http://blog.kent-chiu.com/images/2012-11-15/extjs_101_002.png" alt="extjs_101_002.png" /></p>

<h3>Ext.Template</h3>

<p>範本功能是透過建立一個固定的範本，然後可以將範本裡面特定的內容給取代掉。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var t = new Ext.Template("&lt;div&gt;Hello {0}.&lt;/div&gt;");
</span><span class='line'>t.append('some-element', ['foo']);</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var t = new Ext.Template([
</span><span class='line'>    '&lt;div name="{id}"&gt;',
</span><span class='line'>        '&lt;span class="{cls}"&gt;{name:trim} {value:ellipsis(10)}&lt;/span&gt;',
</span><span class='line'>    '&lt;/div&gt;',
</span><span class='line'>]);
</span><span class='line'>t.compile();
</span><span class='line'>t.append('some-element', {id: 'myid', cls: 'myclass', name: 'foo', value: 'bar'});</span></code></pre></td></tr></table></div></figure>


<h3>Ext.AbstractComponent</h3>

<p>如下圖，Ext.AbstractComponent是許多元件的共同祖先，提供了許多元件共同的基本行為，像</p>

<p>其有幾個特別需要提及的</p>

<ol>
<li>getEl()</li>
<li>getPlugin()</li>
<li>getXTypes()</li>
</ol>


<h3>事件處理</h3>

<p>Ext.util.Observable是所有事件處理的根基。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var el = Ext.get('myDiv');
</span><span class='line'>el.on('click', clickHandle(){});</span></code></pre></td></tr></table></div></figure>


<h3>TBD</h3>

<ul>
<li>Ext.Function.bind 將前一次的function的傳回值當作參數傳入下一次的呼叫
(有functional programming的味道)</li>
<li>Ext.Function.pass
建立一個新的function，用來取代舊function但改變scope</li>
<li>Ext.Function.defer 延遲一段時間後，進行function call</li>
</ul>


<h2>Resource</h2>

<ul>
<li>十個應避免的extjs設計 - <a href="http://www.sencha.com/blog/top-10-ext-js-development-practices-to-avoid/">http://www.sencha.com/blog/top-10-ext-js-development-practices-to-avoid/</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/11/english/">English</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-11T00:00:00+08:00" pubdate data-updated="true">Oct 11<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/10/11/english/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=english:notes" title="english:notes">My English
Notes</a></li>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=english:defining_vocabulary" title="english:defining_vocabulary">Longman Dictionary Defining Vocabulary (2,000
words)</a></li>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=english:my_vocabulary" title="english:my_vocabulary">My
Vocabulary</a></li>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=english:collocation" title="english:collocation">搭配詞</a></li>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=sense_grammer:start" title="sense_grammer:start">文法書</a></li>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=english:linguistic" title="english:linguistic">語言學簡介</a></li>
<li>Grammer Mind Map - <a href="http://wiki.kent-chiu.com/doku.php?id=english:grammer" title="english:grammer">Image
format</a>,
<a href="http://wiki.kent-chiu.com/lib/exe/fetch.php?media=english:grammar.xmind" title="english:grammar.xmind">XMind format</a></li>
<li><a href="http://georgechen.idv.tw/wordpress/" title="http://georgechen.idv.tw/wordpress/">英文字典達人的站</a></li>
<li><a href="http://lsmls.org/" title="http://lsmls.org/">路 - 自學館</a></li>
<li><a href="http://www.sense-english.com/default.php?id=179" title="http://www.sense-english.com/default.php?id=179">廣讀(extensive
reading)的作法</a></li>
<li><a href="http://georgechen.idv.tw/wordpress/?p=59" title="http://georgechen.idv.tw/wordpress/?p=59">為什麼要使用英英字典</a></li>
<li><a href="http://blog.sina.com.cn/zhangliminqd" title="http://blog.sina.com.cn/zhangliminqd">Longman Dictionary
Enhancement</a></li>
<li><a href="http://crazycat1130.pixnet.net/blog/post/15426620" title="http://crazycat1130.pixnet.net/blog/post/15426620">形容詞子句(source:
瘋小貓的華麗冒險)</a></li>
<li><a href="http://crazycat1130.pixnet.net/blog/post/17458923" title="http://crazycat1130.pixnet.net/blog/post/17458923">名詞子句(source:
瘋小貓的華麗冒險)</a></li>
<li><a href="http://crazycat1130.pixnet.net/blog/post/17459071" title="http://crazycat1130.pixnet.net/blog/post/17459071">Direct/Indirect Speech(source:
瘋小貓的華麗冒險)</a></li>
<li><a href="http://www.englishclub.com/writing/spelling_add-ing.htm" title="http://www.englishclub.com/writing/spelling_add-ing.htm">+ing,+ed的方式</a></li>
</ul>


<h2>Phonics</h2>

<ul>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=english:phonics_101" title="english:phonics_101">Phonics
101</a></li>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=english:syllables_101" title="english:syllables_101">Syllable
101</a></li>
<li><a href="http://www.phonicsontheweb.com/index.php" title="http://www.phonicsontheweb.com/index.php">Phonics on
web</a>

<ul>
<li>the Phonics rules</li>
</ul>
</li>
<li><a href="http://www.cla.calpoly.edu/~jrubba/phon/syllables.html" title="http://www.cla.calpoly.edu/~jrubba/phon/syllables.html">Syllable Structure in
English</a>

<ul>
<li>一篇說明如何劃分音節的文章</li>
</ul>
</li>
<li><a href="http://www.spelling.hemscott.net/" title="http://www.spelling.hemscott.net/">Spelling it Right - Learn How to Spell
Confidently</a></li>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=english:the_eight_great_spelling_rules" title="english:the_eight_great_spelling_rules">The Eight Great Spelling
Rules</a></li>
<li>Phonics Mind Map - <a href="http://wiki.kent-chiu.com/doku.php?id=english:phonics" title="english:phonics">Image
format</a>,
<a href="http://wiki.kent-chiu.com/lib/exe/fetch.php?media=english:phonics.xmind" title="english:phonics.xmind">XMind
format</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/30/date_and_time/">時間日期處理</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-30T00:00:00+08:00" pubdate data-updated="true">Sep 30<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/09/30/date_and_time/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>日期的處理，在java中，一直是一個麻煩的問題，很多時間或日期操作若只是想透過JDK的<a href="http://download.oracle.com/javase/6/docs/api/java/util/Date.html" title="http://download.oracle.com/javase/6/docs/api/java/util/Date.html">Date</a>
或<a href="http://download.oracle.com/javase/6/docs/api/java/util/Calendar.html" title="http://download.oracle.com/javase/6/docs/api/java/util/Calendar.html">Calendar</a>來處理，會相當的不方便，況且
JDK內日期時間就有好幾種，很容易讓許多人無從下手，以下列出JDK
1.6內的日期時間相關物件(不含時間日期格式物件)</p>

<ol>
<li><a href="http://download.oracle.com/javase/6/docs/api/java/util/Date.html" title="http://download.oracle.com/javase/6/docs/api/java/util/Date.html">java.util.Date</a>
java日期物件</li>
<li><a href="http://download.oracle.com/javase/6/docs/api/java/sql/Date.html" title="http://download.oracle.com/javase/6/docs/api/java/sql/Date.html">java.sql.Date</a>
資料庫用的日期物件</li>
<li><a href="http://download.oracle.com/javase/6/docs/api/java/sql/Time.html" title="http://download.oracle.com/javase/6/docs/api/java/sql/Time.html">java.sql.Time</a>
資料庫用的日期物件</li>
<li><a href="http://download.oracle.com/javase/6/docs/api/java/sql/Timestamp.html" title="http://download.oracle.com/javase/6/docs/api/java/sql/Timestamp.html">java.sql.Timestamp</a>
資料庫用的時間戳記物件</li>
<li><a href="http://download.oracle.com/javase/6/docs/api/java/util/Calendar.html" title="http://download.oracle.com/javase/6/docs/api/java/util/Calendar.html">java.util.Calendar</a>
java日期物件</li>
</ol>


<p>目前處理日期相關的工具，除了上述的之外，JDK內還有<a href="http://wiki.kent-chiu.com/doku.php?id=java:date_and_time" title="java:date_and_time">日期格式化的相關功能</a>，另外，還有
Apache
<a href="http://commons.apache.org/lang/" title="http://commons.apache.org/lang/">connons-lang</a>裡的<a href="http://commons.apache.org/lang/api-2.6/org/apache/commons/lang/time/DateUtils.html" title="http://commons.apache.org/lang/api-2.6/org/apache/commons/lang/time/DateUtils.html">DateUtils</a>有許多好用的method可以做日期的判斷，
如果還是不足夠的話，還有時間日期處理的終極武器<a href="http://joda-time.sourceforge.net/" title="http://joda-time.sourceforge.net/">Joda
time</a>，可以很有效的對付時間日期區間的問題(Start
Time, End Time報表常會用到)， 那也可以看看<a href="http://sourceforge.net/apps/mediawiki/threeten/index.php?title=ThreeTen" title="http://sourceforge.net/apps/mediawiki/threeten/index.php?title=ThreeTen">JSR
310時間日期處理功能</a>，這個原本有可能是<a href="http://download.oracle.com/javase/7/docs/" title="http://download.oracle.com/javase/7/docs/">JDK
7</a>的一部份，現在就不了了之了</p>

<h3>日期時間常見的議題有</h3>

<ol>
<li>例假日</li>
<li>農民曆</li>
<li>中華民國歷</li>
<li>日光節約時間</li>
<li>地區化</li>
<li>格式化</li>
<li>日期區間運算</li>
</ol>


<h1>Apache Commons Lang</h1>

<h4>時間的shift</h4>

<ul>
<li>addDays</li>
<li>addHours</li>
<li>addMinutes</li>
<li>…</li>
</ul>


<h4>四捨五入，完全捨去，完全進位</h4>

<ul>
<li>ceiling</li>
<li>round</li>
<li>truncate</li>
</ul>


<h4>其他</h4>

<ul>
<li>toCalendar(Date) Date轉Calendar</li>
<li>isSameDay 是否為同一天</li>
<li>parseDate(String, String[]) 將字串轉成日期</li>
<li>getFragmentInXXX() 經過了多少的時間單位</li>
<li>iterator</li>
</ul>


<p>getFragmentInXXX()一系列的方法，可以計算出從何時到何時，總共經過了多時間，比如說，今年到今天，總共已經了多少天，或多少小時或多少秒，…</p>

<p>而iterator可以用以下的參數對某一個時間做iterator</p>

<ol>
<li>RANGE_MONTH_SUNDAY</li>
<li>RANGE_MONTH_MONDAY</li>
<li>RANGE_WEEK_SUNDAY</li>
<li>RANGE_WEEK_MONDAY</li>
<li>RANGE_WEEK_RELATIVE</li>
<li>RANGE_WEEK_CENTER</li>
</ol>


<h1>Joda Time</h1>

<ul>
<li>很容易從jdk的Date,Calendar轉換，只要傳入DateTime的Constructor即可</li>
<li>所有的datetime
classes都是immutable，但有提供一些method可以方便的傳回運算後新的datetime</li>
</ul>


<h3>主要的觀念</h3>

<ul>
<li>Instant - 最基本的觀念，基本上就是一個時間點或DateTime</li>
<li>Partial -</li>
<li>Interval - 時間間隔，也就是start time 跟 end time</li>
<li>Period - 期間，像是3天，6個月，5個小時，可以從interval轉換過來</li>
<li>Duration -
期間，跟Interval的不同是Duration是無timezone的，可以從interval轉換過來，但無法轉回interval</li>
<li>Chronology - 設計日曆的api用，大部份的情況下，可以不管它</li>
<li>DateTimeZone - Time Zone</li>
</ul>


<p>Duration V.S Period</p>

<p>Duration是很簡純的觀念，它就是一個固定的時間(多少毫秒)，而Period則是會隨CONTEXT變化的時間單位，比如說Period如果為一個月，對
一月份一的個月，跟二月份的一個月，長度就不一樣。</p>

<p>ex: 1/15要加一個月的時間，用Period來處理，就是1 Month Period,
(記為P1M)，就是是2/15日，如果用Duration來處理，它只能固定為一個時間長度(換算成milliseconds)，1月到2月是(29天的換算成的milliseconds)，所以就無法用相同的一個Duration來計算下個月的15號時何時(2-3月是30天)。</p>

<p>base, chrono, convert, field and tz這幾個packages是private
package,一般的application大多字會用到<code>org.joda.time</code> package的內容</p>

<h3>重要的Interface</h3>

<h5>ReadableInstant</h5>

<ol>
<li>compareTo(Object)</li>
<li>equals(Object)</li>
<li>get(DateTimeFieldType)</li>
<li>getChronology()</li>
<li>getMillis()</li>
<li>getZone()</li>
<li>hashCode()</li>
<li>isAfter(ReadableInstant)</li>
<li>isBefore(ReadableInstant)</li>
<li>isEqual(ReadableInstant)</li>
<li>isSupported(DateTimeFieldType)</li>
<li>toInstant()</li>
<li>toString()</li>
</ol>


<h5>ReadableInterval</h5>

<ol>
<li>contains(ReadableInstant)</li>
<li>contains(ReadableInterval)</li>
<li>equals(Object)</li>
<li>getChronology()</li>
<li>getEnd()</li>
<li>getEndMillis()</li>
<li>getStart()</li>
<li>getStartMillis()</li>
<li>hashCode()</li>
<li>isAfter(ReadableInstant)</li>
<li>isAfter(ReadableInterval)</li>
<li>isBefore(ReadableInstant)</li>
<li>isBefore(ReadableInterval)</li>
<li>overlaps(ReadableInterval)</li>
<li>toDuration()</li>
<li>toDurationMillis()</li>
<li>toInterval()</li>
<li>toMutableInterval()</li>
<li>toPeriod()</li>
<li>toPeriod(PeriodType)</li>
<li>toString()</li>
</ol>


<h5>ReadablePeriod</h5>

<ol>
<li>equals(Object)</li>
<li>get(DurationFieldType)</li>
<li>getFieldType(int)</li>
<li>getPeriodType()</li>
<li>getValue(int)</li>
<li>hashCode()</li>
<li>isSupported(DurationFieldType)</li>
<li>size()</li>
<li>toMutablePeriod()</li>
<li>toPeriod()</li>
<li>toString()</li>
</ol>


<p>joda-time中的interface跟一般framework中的interface不大一樣，一般的framework中，會建議儘量宣告物件成interface，但是在joda-time中，大多數的情況下，
必須用Concreate Class方能取得物件完整的能力</p>

<h3>ISO Date Format</h3>

<p><a href="http://en.wikipedia.org/wiki/ISO_8601" title="http://en.wikipedia.org/wiki/ISO_8601">ISO_8601</a>是關於日期時間格式相關的ISO規定，裡面的日期，是用”-“做分隔符號(而不是”/”)，建議所有的日期格式與ISO
8601相容 這樣，很多lib(不管是前端或後端)都可以比較容易處理。</p>

<h3>code snippet</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Days days = Days.daysBetween(new DateTime(start), new DateTime(end));</span></code></pre></td></tr></table></div></figure>


<p>parse含有AM/PM，要加上Locale.US，不然會出exception</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SimpleDateFormat df = new SimpleDateFormat("hh:mm aa", Locale.US);</span></code></pre></td></tr></table></div></figure>


<p>如果有時確定格式是對的，但是就是一直出ParseException，這時記得加上Locale.US的參數試試</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import org.joda.time.DateTime;
</span><span class='line'>import org.joda.time.Interval;
</span><span class='line'> 
</span><span class='line'>public enum Scheduling {
</span><span class='line'>    DAILY, WEEKLY, MONTHLY,;
</span><span class='line'> 
</span><span class='line'>    public Interval interval(DateTime dt) {
</span><span class='line'>        DateTime start;
</span><span class='line'>        DateTime end;
</span><span class='line'>        switch (this.name()) {
</span><span class='line'>        case "DAILY":
</span><span class='line'>            start = dt.withMillisOfDay(0);
</span><span class='line'>            end = dt.withMillisOfDay(24 * 60 * 60 * 1000 -1);
</span><span class='line'>            break;
</span><span class='line'>        case "WEEKLY":
</span><span class='line'>            start = dt.withDayOfWeek(1);
</span><span class='line'>            end = dt.withDayOfWeek(7).withMillisOfDay(24 * 60 * 60 * 1000 -1);
</span><span class='line'>            break;
</span><span class='line'>        case "MONTHLY":
</span><span class='line'>            start = dt.withDayOfMonth(1);
</span><span class='line'>            int max = dt.dayOfMonth().getMaximumValue();
</span><span class='line'>            end = dt.withDayOfMonth(max).withMillisOfDay(24 * 60 * 60 * 1000 -1);
</span><span class='line'>            break;
</span><span class='line'>        default:
</span><span class='line'>            throw new UnsupportedOperationException("Unknow name :" + this.name());
</span><span class='line'>        }
</span><span class='line'>        return new Interval(start, end);
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>//
</span><span class='line'>// test case 
</span><span class='line'>//
</span><span class='line'>import static org.hamcrest.Matchers.is;
</span><span class='line'>import static org.junit.Assert.assertThat;
</span><span class='line'> 
</span><span class='line'>import java.util.Date;
</span><span class='line'>import java.util.Locale;
</span><span class='line'> 
</span><span class='line'>import org.apache.commons.lang3.time.DateUtils;
</span><span class='line'>import org.joda.time.DateTime;
</span><span class='line'>import org.joda.time.Interval;
</span><span class='line'>import org.junit.Test;
</span><span class='line'> 
</span><span class='line'>public class SchedulingTest {
</span><span class='line'> 
</span><span class='line'>    @Test
</span><span class='line'>    public void interval_daily() throws Exception {
</span><span class='line'>        Date date = DateUtils.parseDate("2012/02/14", "yyyy/MM/dd");
</span><span class='line'>        Interval interval = Scheduling.DAILY.interval(new DateTime(date));
</span><span class='line'>        assertThat("2012/02/14 00:00:00", is(interval.getStart().toString("yyyy/MM/dd HH:mm:ss")));
</span><span class='line'>        assertThat("2012/02/14 23:59:59", is(interval.getEnd().toString("yyyy/MM/dd HH:mm:ss")));
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    @Test
</span><span class='line'>    public void interval_weekly() throws Exception {
</span><span class='line'>        Date date = DateUtils.parseDate("2012/02/14", "yyyy/MM/dd"); // 2012/2/14 was a Tuesday
</span><span class='line'>        Interval interval = Scheduling.WEEKLY.interval(new DateTime(date));
</span><span class='line'>        assertThat("2012/02/13 00:00:00", is(interval.getStart().toString("yyyy/MM/dd HH:mm:ss")));
</span><span class='line'>        assertThat("2012/02/19 23:59:59", is(interval.getEnd().toString("yyyy/MM/dd HH:mm:ss")));
</span><span class='line'>        assertThat(interval.getStart().dayOfWeek().getAsText(Locale.ENGLISH), is("Monday")); // which day is first day of week that depend on OS settings
</span><span class='line'>        assertThat(interval.getEnd().dayOfWeek().getAsText(Locale.ENGLISH), is("Sunday"));  // which day is end day of week that depend on OS settings
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    @Test
</span><span class='line'>    public void interval_monthly() throws Exception {
</span><span class='line'>        Date date = DateUtils.parseDate("2012/02/14", "yyyy/MM/dd"); 
</span><span class='line'>        Interval interval = Scheduling.MONTHLY.interval(new DateTime(date));
</span><span class='line'>        assertThat("2012/02/01 00:00:00", is(interval.getStart().toString("yyyy/MM/dd HH:mm:ss")));
</span><span class='line'>        assertThat("2012/02/29 23:59:59", is(interval.getEnd().toString("yyyy/MM/dd HH:mm:ss")));
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h1>Resources</h1>

<ul>
<li><a href="http://commons.apache.org/lang/" title="http://commons.apache.org/lang/">http://commons.apache.org/lang/</a>

<ul>
<li>Apache Commons Lang</li>
</ul>
</li>
<li><a href="http://joda-time.sourceforge.net/" title="http://joda-time.sourceforge.net/">joda
time</a>

<ul>
<li>joda-time</li>
</ul>
</li>
<li><a href="http://sourceforge.net/apps/mediawiki/threeten/index.php?title=ThreeTen" title="http://sourceforge.net/apps/mediawiki/threeten/index.php?title=ThreeTen">JSR
310</a>

<ul>
<li>採用了很多<a href="http://joda-time.sourceforge.net/" title="http://joda-time.sourceforge.net/">joda
time</a>的API設計，但還沒穩定，建用還是用joda</li>
</ul>
</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/12/regular_expression/">Regular Expression (RE)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-12T00:00:00+08:00" pubdate data-updated="true">Sep 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/09/12/regular_expression/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>The Negated Character ^</h3>

<p>Remember, a negated character class means “match a character that&#8217;s not
listed” and not “don&#8217;t match what is listed.”</p>

<p>Thus, [^x] doesn&#8217;t mean <strong>“match unless there is an x”, but rather
match if there is something that is not x .</strong> The difference is subtle,
but important. The first concept matches a blank line, for example,
while ![^x] does not.</p>

<p>A character class, even negated, still requires a character to match.</p>

<h3>The Dot Charactor .</h3>

<p>It can be convenient when you want to have an <strong>any character here</strong>
placeholder in your expression.</p>

<h3>Parenthesis ()</h3>

<ol>
<li>capture</li>
<li>grouping</li>
<li>TBD</li>
</ol>


<h3>Lookaround</h3>

<ul>
<li>lookahead left to right</li>
<li>lookbehind right to left</li>
</ul>


<p>lookaround do <strong>NOT</strong> consume text</p>

<h3>Lookaround</h3>

<p>* (?=Expr) - zero-width positive lookahead 符合後面為exp的文字 *
(?!Expr) - zero-width negative lookahead 符合後面沒接exp的文字 *
(?⇐Expr) - zero-width positive lookbehind 符合前為為exp的文字
*(?&lt;!Expr) - zero-width negative lookbehind 符合前面沒接exp字首的文字</p>

<h4>Positive Lookaround</h4>

<p>lookahead及
lookbehind所搜尋的是目前符合之前或之後的文字，並不包含目前符合本身。這些就如同”^”及”\b”特殊字元，本身並不會對應任何文字
(用來界定位置)，也因此稱做是zero-width assertions。</p>

<p>可以想像成SQL語法的<strong>LIKE</strong>或<strong>NOT
LIKE</strong>不過行為並儘相似，反正想到可用SQL
like來處理的問題，用Lookaround來處理一定可行。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>\b\w+(?=ing\b) (字尾為ing的字，比如說filling所符合的就是fill)</span></code></pre></td></tr></table></div></figure>


<p>(?⇐exp)是一個”zero-width positive lookbehind
assertion”。它指的就是符合字首為exp的文字，但不包含exp本身。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(?&lt;=\bre)\w+\b (字首為re的字，比如說repeated所符合的就是peated)
</span><span class='line'>(?&lt;=\d)\d{3}\b (在字尾的三位數字，且之前接一位數字)
</span><span class='line'>(?&lt;=\s)\w+(?=\s) (由空白字元分隔開的字母數字字串)</span></code></pre></td></tr></table></div></figure>


<h4>Negative Lookaround</h4>

<p>但如果只是要驗証某字元不存在而不要對應這些字元進來呢?舉個例子來說，假設要搜尋一個字，它的字母裏有q但接下來的字母不是u，可以用下列的RE來做。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>\b\w*q[^u]\w*\b (一個字，其字母裏有q但接下來的字母不是u)</span></code></pre></td></tr></table></div></figure>


<p>這樣的RE會有一個問題，因為[^u]要對應一個字元，所以若q是字的最後一個字母，[^u]這樣的下法就會將空白字元對應下去，結果就有可能會符合二個字，比如說”Iraq
haha”這樣的文字。使用Negative Lookaround就能解決這樣的問題。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>\b\w*q(?!u)\w*\b (一個字，其字母裏有q但接下來的字母不是u)</span></code></pre></td></tr></table></div></figure>


<p>這是”zero-width negative lookahead assertion”。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>\d{3}(?!\d) (三個位元的數字，其後不接一個位元數字)</span></code></pre></td></tr></table></div></figure>


<p>同樣的，可以使用(?&lt;!exp)，”zero-width negative lookbehind
assertion”，來符合前面沒接exp字首的文字串。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(?&lt;![a-z ])\w{7} (七個字母數字的字串，其前面沒接字母或空格)
</span><span class='line'>(?&lt;=&lt;(\w+)&gt;).*(?=&lt;\/\1&gt;) (HTML標籤間的文字)</span></code></pre></td></tr></table></div></figure>


<p>這使用lookahead及lookbehind
assertion來取出HTML間的文字，不包括HTML標籤。</p>

<h3>MISC</h3>

<p>“03[-./]19[-./]76” 與 “03[.-/]19[.-/]76”不同，因為”-“會變rang的意思</p>

<p>找gary (gery) 可用”gr[ea]y”，”grey|gray”, and even
“gr(a|e)y”，但不能用”g[a|e]ry” 因為[a|e]會被當作 a or | or e</p>

<p>“gr(a|e)y”跟”gra|ey”是後者找的是gra或者是ey</p>

<p>.-^ 等在character裡面跟外面有不同的意義</p>

<p>可有可以的字用”?” 如 ”(July|Jul)” 可用 “July?”. “4th|4” 可用 4(th)?</p>

<p>”&lt;H[1-6]
*>”.如果*前面多一個空格，表示要空n格，如果沒有空格表示n個”]”</p>

<h3>\p{class}, \P{class}</h3>

<p>\p{class} - POSIX or unicode character class \P{class} - exculde POSIX
or unicode character class</p>

<p>if pattern only contains \p(or \P) without {class}, it means all(or
excluded all) class</p>

<p>Supported class codes</p>

<p>C</p>

<p>Other</p>

<p>Cc</p>

<p>Control</p>

<p>Cf</p>

<p>Format</p>

<p>Cn</p>

<p>Unassigned</p>

<p>Co</p>

<p>Private use</p>

<p>Cs</p>

<p>Surrogate</p>

<p>L</p>

<p>Letter</p>

<p>Ll</p>

<p>Lower case letter</p>

<p>Lm</p>

<p>Modifier letter</p>

<p>Lo</p>

<p>Other letter</p>

<p>Lt</p>

<p>Title case letter</p>

<p>Lu</p>

<p>Upper case letter</p>

<p>M</p>

<p>Mark</p>

<p>Mc</p>

<p>Spacing mark</p>

<p>Me</p>

<p>Enclosing mark</p>

<p>Mn</p>

<p>Non-spacing mark</p>

<p>N</p>

<p>Number</p>

<p>Nd</p>

<p>Decimal number</p>

<p>Nl</p>

<p>Letter number</p>

<p>No</p>

<p>Other number</p>

<p>P</p>

<p>Punctuation</p>

<p>Pc</p>

<p>Connector punctuation</p>

<p>Pd</p>

<p>Dash punctuation</p>

<p>Pe</p>

<p>Close punctuation</p>

<p>Pf</p>

<p>Final punctuation</p>

<p>Pi</p>

<p>Initial punctuation</p>

<p>Po</p>

<p>Other punctuation</p>

<p>Ps</p>

<p>Open punctuation</p>

<p>S</p>

<p>Symbol</p>

<p>Sc</p>

<p>Currency symbol</p>

<p>Sk</p>

<p>Modifier symbol</p>

<p>Sm</p>

<p>Mathematical symbol</p>

<p>So</p>

<p>Other symbol</p>

<p>Z</p>

<p>Separator</p>

<p>Zl</p>

<p>Line separator</p>

<p>Zp</p>

<p>Paragraph separator</p>

<p>Zs</p>

<p>Space separator</p>

<p>中日韓文可以用 \p{InCJKUnifiedIdeographs}</p>

<h3>TBD</h3>

<p>\i - Match of capture group i</p>

<p>\cC - control character</p>

<p>\G - previous match&#8217;s end</p>

<p>\A - The beginning of the input</p>

<p>&amp;&amp;</p>

<p>(Expr) - mark Expr as capture group</p>

<p>(ismd-ismd) - turn flags on or off</p>

<p>(ismd-ismd:Expr) - turn flags on or off in Expr</p>

<p>(?:Expr) - non capture group (有performance問題時才會使用)</p>

<p>(?>Expr) - non capture atomic group</p>

<h2>Lazy quantifiers</h2>

<ol>
<li>??</li>
<li>+?</li>
<li>*?</li>
<li>{n}?</li>
<li>{n,}?</li>
<li>{n,m}?</li>
</ol>


<p>minimal matching, non-greedy, and un-greedy quantifiers.</p>

<h2>Possessive quantifiers</h2>

<ol>
<li>?+</li>
<li>++</li>
<li>*+</li>
<li>{n}+</li>
<li>{n,}+</li>
<li>{n,m}+</li>
</ol>


<p>Only Java supports those quantifiers now</p>

<h2>Regex Modes and Match Modes</h2>

<ol>
<li>/i - case-insensitive mode</li>
<li>/x - free-spacing and comments mode</li>
<li>/s - dot matches-all match mode (a.k.a., single-line mode)</li>
<li>/m - enhanced line-anchor match mode (a.k.a., multiline mode)</li>
<li>\Q…\E - literal-text regex mode</li>
</ol>


<h4>free-spacing and comments mode</h4>

<p>all spaces and anything after comment mark(#) will not interpreted.</p>

<p>if you need a space in pattern, using \s instead normal space
character.</p>

<h4>dot matches-all match mode (a.k.a., single-line mode)</h4>

<p>Usually, dot does not match a newline, but in this mode, dot does.</p>

<h4>\Q&#8230;\E - literal-text regex mode</h4>

<p>\Q, \E means start/end quoting.</p>

<p>the contents of which have all meta-characters ignored (expect the \E
itself).</p>

<h3>mode modifier (?modifier)</h3>

<p>(?modifier) could be (?i) or (?-i) to enabled/disabled case-sensitive
matching.</p>

<p>the modifier can be i, x ,m ,s mode of <a href="#regex_modes_and_match_modes" title="prog:regular_expression ↵">Regex Modes and Match
Modes</a></p>

<h2>Capture (\1) ,(?&lt;Name>&#8230;) or(?P&lt;Name>&#8230;)</h2>

<p>Here&#8217;s a <strong>PHP</strong> regular expression for matching *nested* parentheses
(e.g. blocks of code):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>((?:[^()]++|\((?1)\))*)</span></code></pre></td></tr></table></div></figure>


<p>The ?1 is a recursive reference to the regex marked by the outermost
parentheses. It is a feature of the PHP regex engine.</p>

<p>See Jeffrey Friedl&#8217;s Mastering Regular Expressions, 3rd ed., p. 476,
“Recursive reference to a set of capturing parentheses”.</p>

<p>Another potentially useful regex technique is “named capture”:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>^(?P&lt;protocol&gt;https?)://(?P&lt;host&gt;[^/:]+)(?::(?P&lt;port&gt;\d+))?</span></code></pre></td></tr></table></div></figure>


<p>Here you can use either \$matches[0], \$matches[1], \$matches[2] or
\$matches[&#8216;protocol&#8217;], \$matches[&#8216;host&#8217;], \$matches[&#8216;port&#8217;].</p>

<p>This favour has difference implementation in difference language
(library), you should check manual of yours.</p>

<h2>Greediness (貪婪)</h2>

<p>regexp 的搜尋引擎有一個特性, 叫做 greediness – 能吃多少,
就盡量吃多少。克服貪婪可用以下方式</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[^...] "除了 ... 之外的任何一個字元"    </span></code></pre></td></tr></table></div></figure>


<p>也可利用<a href="#lazy_quantifiers" title="prog:regular_expression ↵">lazy greedy</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.??  或 .*? </span></code></pre></td></tr></table></div></figure>


<p>Lazy quantifiers是要用在<code>.*</code>後面，end of match的前面</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
</span><span class='line'>&lt;title&gt;Insert title here&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;!-- #BeginLibraryItem "/library/page_header.lbi" --&gt;
</span><span class='line'>content of /page_header.lbi
</span><span class='line'>&lt;!-- #EndLibraryItem --&gt;
</span><span class='line'>&lt;!-- #BeginLibraryItem "/library/page_center.lbi" --&gt;
</span><span class='line'>content of /page_center.lbi
</span><span class='line'>&lt;!-- #EndLibraryItem --&gt;
</span><span class='line'>&lt;!-- #BeginLibraryItem "/library/page_footer.lbi" --&gt;
</span><span class='line'>content of /page_footer.lbi
</span><span class='line'>&lt;!-- #EndLibraryItem --&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;</span></code></pre></td></tr></table></div></figure>


<p>在使用Single-Line (Dot All) mode下，
如果是以上面這個RE做條件，會從第8行選到第16行，所以這樣會有三個matchs</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!--\s*#BeginLibraryItem.*#EndLibraryItem\s*--&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- #BeginLibraryItem "/library/page_header.lbi" --&gt;
</span><span class='line'>content of /page_header.lbi
</span><span class='line'>&lt;!-- #EndLibraryItem --&gt;
</span><span class='line'>&lt;!-- #BeginLibraryItem "/library/page_center.lbi" --&gt;
</span><span class='line'>content of /page_center.lbi
</span><span class='line'>&lt;!-- #EndLibraryItem --&gt;
</span><span class='line'>&lt;!-- #BeginLibraryItem "/library/page_footer.lbi" --&gt;
</span><span class='line'>content of /page_footer.lbi
</span><span class='line'>&lt;!-- #EndLibraryItem --&gt;</span></code></pre></td></tr></table></div></figure>


<p>但是如果利用lazy quantifiers <code>*?</code>
，就只會選到第一個#EndLibraryItem(第8行到第10行)，所以這樣會有三個matchs</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!--\s*#BeginLibraryItem.*?#EndLibraryItem\s*--&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- #BeginLibraryItem "/library/page_header.lbi" --&gt;
</span><span class='line'>content of /page_header.lbi
</span><span class='line'>&lt;!-- #EndLibraryItem --&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- #BeginLibraryItem "/library/page_center.lbi" --&gt;
</span><span class='line'>content of /page_center.lbi
</span><span class='line'>&lt;!-- #EndLibraryItem --&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- #BeginLibraryItem "/library/page_footer.lbi" --&gt;
</span><span class='line'>content of /page_footer.lbi
</span><span class='line'>&lt;!-- #EndLibraryItem --&gt;</span></code></pre></td></tr></table></div></figure>


<h2>The Backtracking</h2>

<p><strong>TBD</strong></p>

<h2>參考資源</h2>

<ul>
<li>洪朝貴教授的<a href="http://fsoss.fcu.org.tw/2004/hong-chaogui/08-regexp.html" title="http://fsoss.fcu.org.tw/2004/hong-chaogui/08-regexp.html">一輩子受用的 Regular
Expressions</a></li>
<li><a href="http://tw2.php.net/manual/en/reference.pcre.pattern.modifiers.php" title="http://tw2.php.net/manual/en/reference.pcre.pattern.modifiers.php">PHP patter
modifierss</a></li>
<li><a href="http://tw2.php.net/manual/en/regexp.reference.php" title="http://tw2.php.net/manual/en/regexp.reference.php">PHP RE
details</a></li>
<li><a href="http://www.regular-expressions.info/completelines.html" title="http://www.regular-expressions.info/completelines.html">http://www.regular-expressions.info/completelines.html</a>

<ul>
<li>a lot of RE examples</li>
</ul>
</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/24/sbt_101/">SBT 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-24T14:27:00+08:00" pubdate data-updated="true">Jul 24<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/24/sbt_101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>dependency時，兩個%%表示cross-build，會把sbt的版號給納入dependency的資訊</p></blockquote>

<h5>Local Maven Repository</h5>

<p>如果要使用local或自己架設的maven
repository，可以透過<code>resolvers += “name” at “maven repositor url”</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>resolvers += "Local Maven Repository" at "file:///C:/Users/Kent/.m2/repository"</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/13/jms_101/">JMS 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-13T00:00:00+08:00" pubdate data-updated="true">Jul 13<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/13/jms_101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本文中內容，主要以<a href="http://activemq.apache.org/" title="http://activemq.apache.org/">ActiveMQ
5.4</a>為主，若不是此版本，程式碼不一定可以執行</p>

<blockquote><p>JMS 2 於2013年Q1 release,使用者更會簡單，也內建訊息延遲發送功能(目前每一個使用方式都不一樣)，如果沒有相容性問題，建議採 JMS 2.0</p></blockquote>

<h1>基本觀念</h1>

<h3>JMS 基本元素</h3>

<ul>
<li>provider :</li>
<li>client : 產出(傳送)或消費(接收)訊息</li>
<li>consumer : 消費(接收)訊息</li>
<li>message : 在client間被傳遞的訊息物件</li>
<li><p>destination : 信息的目的或<strong>來源</strong></p>

<ol>
<li>queue : 訊息佇列,destination在PTP叫queue</li>
<li>topic :
一個散佈訊息給多個訂閱者的機制,destination在pub/sub叫topic</li>
</ol>
</li>
<li><p>session : thread context，用來producing/consuming messages</p></li>
<li>Administered Objects</li>
</ul>


<h3>Messaging Domains</h3>

<h5>Point-to-Point Messaging Domain （PTP）</h5>

<ul>
<li>基於queues, senders, and receivers的模型</li>
<li>每一個message<strong>同時只有一個</strong>Consumer</li>
<li>Consumer跟Producer沒有時間的依賴性，Producer發送訊息後，Consumer可以隨時上去接收</li>
<li>Consumer回應訊息處理狀態</li>
</ul>


<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_001.gif" alt="jms_101_001.gif" /></p>

<h5>Publish/Subscribe Messaging Domain (pub/sub)</h5>

<ul>
<li><p>主要就三個要素</p>

<ol>
<li>Publisher 發佈者:發佈訊息</li>
<li>Subscriber 訂閱者: 訂閱訊息</li>
<li>Topic 訊息的閱者，為發佈者或訂閱者之間的channel</li>
</ol>
</li>
<li><p>Broadcast型的結構</p></li>
<li>每一個Topic<strong>可以多個</strong>Subscribers</li>
<li>Subscriber跟Publisher<strong>有</strong>時間的依賴性，Subscriber可以必須先進行訂閱後，才會收到Producer發佈的Topic</li>
<li><p>Subscriber 依連線方式可以分為</p>

<ol>
<li>Nondurable Subscribers : 必須一直保持在接收狀態^<a href="#fn__1">1)</a>^</li>
<li>Durable Subscribers :
建立後，如以inactive，當active後，會將累積的訊息一起收下來</li>
</ol>
</li>
<li><p>Subscriber 依建立方式可分為</p>

<ol>
<li>Dynamic Subscribers : 程式動態建立</li>
<li>Administered Subscribers : 由provider (server)建立</li>
</ol>
</li>
</ul>


<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_002.gif" alt="jms_101_002.gif" /></p>

<h3>JMS API</h3>

<p>在JMS裡，上述的觀念，主要是透過JMS API來定義的，JMS
API只是定義規格(類似於JDBC)，至於實作會由其他實作的vendors提供，JMS
API主要的類似如下：</p>

<ul>
<li>ConnectionFactory</li>
<li>Destination</li>
<li>Connection</li>
<li>Session</li>
<li>Message</li>
<li>MessageProducer</li>
<li>MessageConsumer</li>
</ul>


<h1>建立Connection/Session的流程</h1>

<p>不論是PTP或是pub/sub模組，要跟MessageQuery
Server溝通的流程是差不多的，流程如下</p>

<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_003.gif" alt="jms_101_003.gif" /></p>

<ol>
<li>建立ConnectionFactory</li>
<li>由ConnectionFactory建立Connection</li>
<li>由Connection建立Session</li>
<li>由Session建立訊息(包含訊息內容，目的(Destination)，模型，…)</li>
</ol>


<h3>與Message Server建立連線</h3>

<h4>由ActiveMQ提供的ActiveMQConnectionFactory建立connection</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// ActiveMQConnectionFactory是ActiveMQ專屬寫法，會有平台跟lib依賴性，可用jndi來解決這個問題
</span><span class='line'>factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
</span><span class='line'>connection = factory.createConnection();
</span><span class='line'>connection.start(); </span></code></pre></td></tr></table></div></figure>


<p>剛建立好後的connection是在停止狀態的，必需先啟動才有辦法使用，一般啟動後，不用特別去stop，因為stop也會一併停止接受來自mq
server的訊息，但是如果不希望connection一直連著，可以把他close掉</p>

<h4>用JNDI的方式建立connection</h4>

<p>這種方式比較通用，不會依賴特定平台的API</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Properties env = new Properties();
</span><span class='line'>env.put(Context.SECURITY_PRINCIPAL, "system");
</span><span class='line'>env.put(Context.SECURITY_CREDENTIALS, "manager");
</span><span class='line'>env.put(Context.INITIAL_CONTEXT_FACTORY,"org.apache.activemq.jndi.ActiveMQInitialContextFactory");
</span><span class='line'>env.put(Context.PROVIDER_URL, "tcp://localhost:61616");
</span><span class='line'>InitialContext ctx = new InitialContext(env);
</span><span class='line'>TopicConnectionFactory conFactory = (TopicConnectionFactory)ctx.lookup(topicFactory);</span></code></pre></td></tr></table></div></figure>


<h3>建立Session</h3>

<h4>用傳統的方式建立Session</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>connection = factory.createConnection();
</span><span class='line'>connection.start();
</span><span class='line'>session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);</span></code></pre></td></tr></table></div></figure>


<h4>用Annotation的方式建立connection</h4>

<p>這種方式，需要DI Container的支援</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Resource(lookup = "jms/Queue")
</span><span class='line'>private static Queue queue;
</span><span class='line'> 
</span><span class='line'>@Resource(lookup = "jms/Topic")
</span><span class='line'>private static Topic topic;</span></code></pre></td></tr></table></div></figure>


<h1>Hello JMS</h1>

<p>以下是幾個比較完整(可執行)的範例，可以在ActiveMQ的web admin(ex:
<a href="http://localhost:8161/admin/queues.jsp" title="http://localhost:8161/admin/queues.jsp">http://localhost:8161/admin/queues.jsp</a>
)畫面上看到息的狀態</p>

<h3>傳送訊息 (PTP)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Test
</span><span class='line'>public void sendMessagePTP() throws JMSException {
</span><span class='line'>    ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616"); // 記得先確定61616 port的service有enabled
</span><span class='line'>    Connection connection = factory.createConnection();
</span><span class='line'>    connection.start();
</span><span class='line'>    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
</span><span class='line'>    Destination destination = session.createQueue("queue1"); // 建立PTP message,Destination為"queue1"
</span><span class='line'>    MessageProducer sender = session.createProducer(destination);
</span><span class='line'>    TextMessage message = session.createTextMessage("Hello World!");
</span><span class='line'>    sender.send(message);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>執行後可以在ActiveMQ的”Queue”看到”queue1”的message</p>

<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_005.png" alt="jms_101_005.png" /></p>

<ul>
<li>Number Of Pending Messages: 在queue等待處理的訊息的數量</li>
<li>Number Of Consumers:
連線中，正在等待訊息的Consumers的數量(正在listening的client的數量)</li>
<li>Messages Enqueued : 進入佇列的訊息數量</li>
<li>Messages Dequeued : 離開佇列的訊息數量</li>
</ul>


<h3>取得訊息 (PTP)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Test
</span><span class='line'>public void retrieveMessagePTP() throws Exception {
</span><span class='line'>    ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616"); // 記得先確定61616 port的service有enabled
</span><span class='line'>    Connection connection = factory.createConnection();
</span><span class='line'>    connection.start();
</span><span class='line'>    Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
</span><span class='line'>    Destination destination = session.createQueue("queue1"); // 建立PTP message,Destination為"queue1"
</span><span class='line'>    MessageConsumer consumer = session.createConsumer(destination);
</span><span class='line'>    System.out.println(consumer.receive());
</span><span class='line'>    // 取回的訊息如下(內容會依執行環境的不同而不同)
</span><span class='line'>    // ActiveMQTextMessage {commandId = 5, responseRequired = true, messageId = ID:kent-PC-4384-1294370677008-0:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:kent-PC-4384-1294370677008-0:0:1:1, destination = queue://queue1, transactionId = null, expiration = 0, timestamp = 1294370677215, arrival = 0, brokerInTime = 1294370677215, brokerOutTime = 1294370677264, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, text = Hello World!}
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>建立Topic (Pub/Sub)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Test
</span><span class='line'>public void createTopic() throws Exception {
</span><span class='line'>    ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
</span><span class='line'>    TopicConnection connection = factory.createTopicConnection();
</span><span class='line'>    connection.start();
</span><span class='line'>    TopicSession session = connection.createTopicSession(false, Session.AUTO_ACKNOWLEDGE);
</span><span class='line'>    Topic topic = session.createTopic("MyTopic");
</span><span class='line'>    TopicPublisher publisher = session.createPublisher(topic);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>執行後可以在ActiveMQ的”Topic”看到”MyTopic”</p>

<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_006.png" alt="jms_101_006.png" /></p>

<h3>建立Topic並發佈訊息 (Pub/Sub)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Test
</span><span class='line'>public void createTopicAndPublishMessage() throws Exception {
</span><span class='line'>    ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
</span><span class='line'>    TopicConnection connection = factory.createTopicConnection();
</span><span class='line'>    connection.start();
</span><span class='line'>    TopicSession session = connection.createTopicSession(false, Session.AUTO_ACKNOWLEDGE);
</span><span class='line'>    Topic topic = session.createTopic("MyTopic2");
</span><span class='line'>    TopicPublisher publisher = session.createPublisher(topic);
</span><span class='line'>    TextMessage message = session.createTextMessage("MyTopic2 Message Body");
</span><span class='line'>    publisher.publish(message);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>執行後可以在ActiveMQ的”Topic”看到”MyTopic2”，”Messages Enqueued”會加1</p>

<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_006.png" alt="jms_101_006.png" /></p>

<h3>訂閱Topic</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Test
</span><span class='line'>public void subscribeMessage() throws Exception {
</span><span class='line'>    ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
</span><span class='line'>    TopicConnection connection = factory.createTopicConnection();
</span><span class='line'>    connection.start();
</span><span class='line'>    TopicSession session = connection.createTopicSession(false, Session.AUTO_ACKNOWLEDGE);
</span><span class='line'>    Topic topic = session.createTopic("MyTopic2");
</span><span class='line'>    TopicSubscriber subscriber = session.createSubscriber(topic);
</span><span class='line'>    System.out.println(subscriber.receive()); // 執行後，會停在這一行，直到有訊息被取回
</span><span class='line'>    // result
</span><span class='line'>    // ActiveMQTextMessage {commandId = 7, responseRequired = false, messageId = ID:kent-PC-2524-1294364408121-4:5:1:1:3, originalDestination = null, originalTransactionId = null, producerId = ID:kent-PC-2524-1294364408121-4:5:1:1, destination = topic://MyTopic2, transactionId = null, expiration = 0, timestamp = 1294375382476, arrival = 0, brokerInTime = 1294375382477, brokerOutTime = 1294375382478, correlationId = , replyTo = null, persistent = false, type = , priority = 0, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 0, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, text = MyMessage}
</span><span class='line'> 
</span><span class='line'>    // 也可以設定timeout，如果timeout前都沒有取到訊息，會傳回null
</span><span class='line'>    // System.out.println(subscriber.receive(10 * 1000)); // 執行後，會停在這一行，直到有訊息被取回或10秒後timeout，並傳回null
</span><span class='line'>    // result
</span><span class='line'>    // null
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>以上面的例子來說，如果是同步接受的，一收完訊息，程式會馬上往下執行，並結速，這樣便無法一直接到MQ
Server的訊息，
如果想持續一直收到MQ的訊息，可以recive()後加一個無限迴圈，讓程式不會結束，即可以一直收到訊息</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>TopicSubscriber subscriber = session.createSubscriber(topic);
</span><span class='line'>subscriber.recive();
</span><span class='line'>connection.start();
</span><span class='line'>while (true) {
</span><span class='line'>    // prevent main thread stop 
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>執行後可以在ActiveMQ的”Topic”看到”MyTopic2”，”Number Of Consumers”會加1</p>

<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_007.png" alt="jms_101_007.png" /></p>

<p>程式會一直hold住(如果沒設timeout的話)，此時，可以透過”Send
To”的hyperlink，讓”MyTopic2”發佈一個訊息，這樣”subscriber.receive()“就會取得”MyTopic2”發佈的訊息了.</p>

<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_008.png" alt="jms_101_008.png" /></p>

<h1>JMS API使用說明</h1>

<h2>Destination</h2>

<p>Destination的結構如下</p>

<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_004.png" alt="jms_101_004.png" /></p>

<p>Destination本身是一個空的Interface，它主要是要標明，Destination的概念，底下有Queue(用在PTP)跟Topic(用在Pub/Sub)兩個介面繼承自Destination</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package javax.jms;
</span><span class='line'> 
</span><span class='line'>public interface Destination {
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>PTP model</h2>

<h4>Producing / Consuming Message</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MessageConsumer consumer = session.createConsumer(dest);
</span><span class='line'>MessageConsumer consumer = session.createConsumer(queue);
</span><span class='line'>MessageConsumer consumer = session.createConsumer(topic);
</span><span class='line'> 
</span><span class='line'>connection.start();
</span><span class='line'>Message m = consumer.receive();
</span><span class='line'>connection.start();
</span><span class='line'>Message m = consumer.receive(1000); // time out after a second</span></code></pre></td></tr></table></div></figure>


<h4>Queue Browsers</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>QueueBrowser browser = session.createBrowser(queue);</span></code></pre></td></tr></table></div></figure>


<h2>Pub/Sub model</h2>

<h2>Message</h2>

<h3>Message Header</h3>

<table>
<thead>
<tr>
<th>  Header Field       </th>
<th> Set By                  </th>
<th> description</th>
</tr>
</thead>
<tbody>
<tr>
<td>  JMSDestination     </td>
<td> send or publish method  </td>
<td> 訊息的目的地</td>
</tr>
<tr>
<td>  JMSDeliveryMode    </td>
<td> send or publish method  </td>
<td> DeliveryMode.NON_PERSISTENT (不存到DB) or DeliveryMode.PERSISTENT (存到DB)</td>
</tr>
<tr>
<td>  JMSExpiration      </td>
<td> send or publish method  </td>
<td> 訊息過期的時間</td>
</tr>
<tr>
<td>  JMSPriority        </td>
<td> send or publish method  </td>
<td> 0-9的值(9最高)，0-4是一般,5-9是 “加急”</td>
</tr>
<tr>
<td>  JMSMessageID       </td>
<td> send or publish method  </td>
<td> 一個唯一的訊息id字串</td>
</tr>
<tr>
<td>  JMSTimestamp       </td>
<td> send or publish method  </td>
<td> 訊息傳送的時間</td>
</tr>
<tr>
<td>  JMSCorrelationID   </td>
<td> Client                  </td>
<td> 相關的id (參閱<a href="#jmscorrelationid" title="java:jms_101 ↵">下面</a>的說明)</td>
</tr>
<tr>
<td>  JMSReplyTo         </td>
<td> Client                  </td>
<td> 讓client知道，要”回信”給誰</td>
</tr>
<tr>
<td>  JMSType            </td>
<td> Client                  </td>
<td> <a href="#message_type" title="java:jms_101 ↵">Message Type</a></td>
</tr>
<tr>
<td>  JMSRedelivered     </td>
<td> JMS provider            </td>
<td> 值為true或false，指明message之前是否沒有被consumer成功取回</td>
</tr>
</tbody>
</table>


<p>只有 Set By
Client的header需要進行設定，其他的大部份是由send或publish的method設定.</p>

<h5>JMSCorrelationID</h5>

<p>在大多數的情況下，JMSCorrelationID會是指回應那一個JMSMessageID，但JMSCorrelationID可以是任何的值，不見得要是JMSMessageID.
一般也會被拿來放Application-specific ID.</p>

<h5>Message Type</h5>

<table>
<thead>
<tr>
<th>  Message Type   </th>
<th> Body Contains</th>
</tr>
</thead>
<tbody>
<tr>
<td>  TextMessage    </td>
<td> A java.lang.String object (for example, the contents of an XML file).</td>
</tr>
<tr>
<td>  MapMessage     </td>
<td> A set of name-value pairs, with names as String objects and values as primitive types in the Java programming language. The entries can be accessed sequentially by enumerator or randomly by name. The order of the entries is undefined.</td>
</tr>
<tr>
<td>  BytesMessage   </td>
<td> A stream of uninterpreted bytes. This message type is for literally encoding a body to match an existing message format.</td>
</tr>
<tr>
<td>  StreamMessage  </td>
<td> A stream of primitive values in the Java programming language, filled and read sequentially.</td>
</tr>
<tr>
<td>  ObjectMessage  </td>
<td> A Serializable object in the Java programming language.</td>
</tr>
<tr>
<td>  Message        </td>
<td> Nothing. Composed of header fields and properties only. This message type is useful when a message body is not required.</td>
</tr>
</tbody>
</table>


<h3>Message Property</h3>

<p>Property像是message的metadata，可以放入一些特定的屬性，之後可以透過<a href="#message_selectors" title="java:jms_101 ↵">Message
Selectors</a>的功能來做查詢。^<a href="#fn__2">2)</a>^</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>TextMessage message = pubSession.createTextMessage();
</span><span class='line'>message.setText(text);
</span><span class='line'>message.setStringProperty("username",username);
</span><span class='line'>publisher.publish(message);</span></code></pre></td></tr></table></div></figure>


<h5>JMS-Defined Properties &amp; Provider-Specific Properties</h5>

<p>另外，還會有JMS訂義的JMS-Defined Properties及Provider-Specific
Properties</p>

<p>JMS-Defined Properties</p>

<ol>
<li>JMSXUserID</li>
<li>JMSXAppID</li>
<li>JMSXProducerTXID</li>
<li>JMSXConsumerTXID</li>
<li>JMSXRcvTimestamp</li>
<li>JMSXDeliveryCount</li>
<li>JMSXState</li>
<li>JMSXGroupID</li>
<li>JMSXGroupSeq</li>
</ol>


<h3>Message Selectors</h3>

<p>Message
Selectors的功能，是在Messages中過濾出需要的部份，Messages只對針對property進行過濾，不能針對message
body做過濾，但可以透過簡單的expression來操作properties.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>String filter = "(currentRate - newRate) &gt;= 1.0";
</span><span class='line'>TopicSubscriber subscriber = session.createSubscriber(topic, filter, true);</span></code></pre></td></tr></table></div></figure>


<p>currentRate範例中的<code>currentRate</code>跟<code>newRate</code>是message的User定義的<a href="#message_property" title="java:jms_101 ↵">properties</a></p>

<p>Message Selectors的語法是SQL 92的子集，可以用許多SQL
92的運算符來作為expression的一部份，ex:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Shares &gt; 1000.0 AND Symbol LIKE 'A%C'</span></code></pre></td></tr></table></div></figure>


<p><strong>Message Filtering approach VS Multiple Destination approach</strong></p>

<p>在設計時，可以採用Message Filtering或Multiple
Destination的方式進行訊息的分類</p>

<p>Message Filtering approach
:是所有的訊息進到同一個Destination後透過selector進行分類選取。</p>

<p>Multiple Destination
approach:是不同類的訊息，一開始就分派到不同的Destination。</p>

<h3>Message Persistent</h3>

<p>Message可以選擇Persistent或Nonpersistent,Persistent的訊息是存在db或file，Nonpersistent只是放在memory
所以Nonpersistent的訊息，在server重啟後就不見了，如果是Persistent，server重啟後，還是會存在。</p>

<p>Persistent或Nonpersistent是由JMSDeliveryMode決定。</p>

<h1>Acknowledge Mode</h1>

<p>Acknowledge
Mode是用來確定訊息傳遞的可靠性的，需要做Acknowledge(回應，確認)的是在傳送或接收(發佈或訂閱)訊息時，client用來回應provider訊息有確實收到的機制</p>

<p>Acknowledge Mode是在建立session時決定的。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Session = Connect.createTopicSession(false, Session.CLIENT_ACKNOWLEDGE);
</span><span class='line'>Session = Connect.createQueueSession(false, Session.DUPS_OK_ACKNOWLEDGE);</span></code></pre></td></tr></table></div></figure>


<p>Acknowledge Mode有以下幾種</p>

<ol>
<li><a href="#auto_acknowledge" title="java:jms_101 ↵">AUTO_ACKNOWLEDGE</a> 自動回應</li>
<li><a href="#client_acknowledge" title="java:jms_101 ↵">CLIENT_ACKNOWLEDGE</a>
由客戶端自行回應</li>
<li><a href="#dups_ok_acknowledge" title="java:jms_101 ↵">DUPS_OK_ACKNOWLEDGE</a>
可重覆的回應</li>
</ol>


<h4>AUTO_ACKNOWLEDGE</h4>

<p>只要訊息成功被傳送或接收，就會產生回應，而且最多只會回應一次(once-and-only-once)</p>

<h4>CLIENT_ACKNOWLEDGE</h4>

<p>如果客戶端需在傳送時接受訊息後，先進行一些額外的處理，等這些額外的處理直正的成功後，才進行回應，如果失敗的話(或沒回應的話)，訊息就不會被產生出來(或消化掉)</p>

<h4>DUPS_OK_ACKNOWLEDGE</h4>

<p>如果不介意訊息被重覆的傳送或接收，可以用這個模式，<strong>DUPS_OK_ACKNOWLEDGE</strong>
mode，其最大的特色就是效能會有顯著的提昇。 要使用這個模式，需要把
<code>JMSRedelivered</code>屬性設為<code>true</code></p>

<h1>Transactions</h1>

<p>Transactions是用來做批量messages的處理，用來保證所有的messages都有被成功的同時送出或取回。</p>

<p>Transactions的啟用方式是將createSession的第一個參數設為true，第二個參數將會被忽略，當所以有訊息被處理後，可以透過<code>session.commit()</code>提交或<code>session.rollback()</code>取消。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Session session = connection.createSession(true, Session.SESSION_TRANSACTED);;</span></code></pre></td></tr></table></div></figure>


<h1>Transport Connectors (ActiveMQ)</h1>

<p>ActiveMQ提供許多連線的Protocol叫Transport Connectors,Transport
Connectors所使用的ports是透過ActiveMQ_HOME/conf/activemq.xml進行設定。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- The transport connectors ActiveMQ will listen to --&gt;
</span><span class='line'>&lt;transportConnectors&gt;
</span><span class='line'>&lt;transportConnector name="openwire" uri="tcp://localhost:61616"
</span><span class='line'>discoveryUri="multicast://default"/&gt;
</span><span class='line'>&lt;transportConnector name="ssl" uri="ssl://localhost:61617"/&gt;
</span><span class='line'>&lt;transportConnector name="stomp" uri="stomp://localhost:61613"/&gt;
</span><span class='line'>&lt;transportConnector name="xmpp" uri="xmpp://localhost:61222"/&gt;
</span><span class='line'>&lt;/transportConnectors&gt;</span></code></pre></td></tr></table></div></figure>


<h3>連線格式</h3>

<p>JMS是透過URIs當做連線格式</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;scheme&gt;:&lt;scheme-specific-part&gt;
</span><span class='line'>&lt;scheme&gt;://&lt;authority&gt;&lt;path&gt;&lt;?query&gt;</span></code></pre></td></tr></table></div></figure>


<p>ex:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tcp://localhost:61616
</span><span class='line'>tcp://hostname:port?key=value&key=value</span></code></pre></td></tr></table></div></figure>


<p>特別需要注意的是 JMS 亦提供composite URIs</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>static://(tcp://host1:61616, tcp://host2:61616)</span></code></pre></td></tr></table></div></figure>


<h5>Protocol</h5>

<ol>
<li>tcp</li>
<li>nio</li>
<li>ssl (需要認證)</li>
<li>http/https (80 port)</li>
<li>VM (with other JVM)</li>
</ol>


<p>如果有許多clients需要連線到MQ，
連線數可能會受到OS限制，這時可以採用NIO的protocol</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nio://hostname:port?key=value</span></code></pre></td></tr></table></div></figure>


<h1>遠端監控ActiveMQ</h1>

<p>有時需要取得MQ上面的連線資訊或管理MQ
Server，此時可以透過JMX的功能進行監控。 要進行JMX前，可以需先開啟設定</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;managementContext&gt;
</span><span class='line'>    &lt;managementContext createConnector="true"/&gt; 
</span><span class='line'>&lt;/managementContext&gt;</span></code></pre></td></tr></table></div></figure>


<p>把managementContext/managementContext的createConnector屬性設成true即可</p>

<p>完成後，重新啟動mq，然後，可以先用jdk內建的jconsole(jdk/bin/jconsole.exe)做連線測試</p>

<p>啟動jconsole後，remote process填入</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi</span></code></pre></td></tr></table></div></figure>


<p>填入後，按連線即可(本例中，mq跟jconsole在同一台，所以用localhost，如果不同一台，需先確認1099的port沒被防火牆擋住)，
連線成功後，即可取得MQ的相關資訊，需要的內容會在MBeans的tab頁上</p>

<p><img src="http://blog.kent-chiu.com/images/2012-07-13/jms_101_009.png" alt="jms_101_009.png" /></p>

<p>確定可以用jconsole連線後，便可以使用程式取得連線資訊</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>RemoteJMXBrokerFacade createConnector = new RemoteJMXBrokerFacade();
</span><span class='line'>System.setProperty("webconsole.jmx.url", "service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi");
</span><span class='line'>SystemPropertiesConfiguration configuration = new SystemPropertiesConfiguration();
</span><span class='line'>createConnector.setConfiguration(configuration);
</span><span class='line'>// 可透過brokerAdmin取得broker上的資訊
</span><span class='line'>BrokerViewMBean brokerAdmin = createConnector.getBrokerAdmin();
</span><span class='line'>String brokerName = brokerAdmin.getBrokerName();
</span><span class='line'>brokerAdmin.getTotalConsumerCount();  
</span><span class='line'>brokerAdmin.getTotalMessageCount();</span></code></pre></td></tr></table></div></figure>


<h1>Resources</h1>

<ul>
<li><a href="http://download.oracle.com/javaee/6/tutorial/doc/bncdr.html" title="http://download.oracle.com/javaee/6/tutorial/doc/bncdr.html">Java Message Service Concepts - The Java EE 6
Tutorial</a>

<ul>
<li>文章圖片來源大多來自這裡</li>
</ul>
</li>
<li><a href="http://wenku.baidu.com/view/f90394aad1f34693daef3ee8.html" title="http://wenku.baidu.com/view/f90394aad1f34693daef3ee8.html">ActiveMQ in
action</a></li>
<li><a href="http://wenku.baidu.com/view/a7a05927a5e9856a5612609a.html" title="http://wenku.baidu.com/view/a7a05927a5e9856a5612609a.html">ActiveMQ in
action(中文)</a></li>
</ul>


<p>[java</p>

<p>^<a href="#fnt__1">1)</a>^ Durable Subscribe可以不用一直保持連線狀態</p>

<p>^<a href="#fnt__2">2)</a>^ message body本身是沒辦法做查詢的</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/12/jpa_101/">JPA 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-12T00:00:00+08:00" pubdate data-updated="true">Jul 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/12/jpa_101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Java Persistence API(JPA)</p>

<h1>Where to put the persistence.xml</h1>

<ul>
<li>for web application → WEB-INF/classes/META-INF/persistence.xml</li>
<li>for jar →</li>
<li>for maven main folder → src/main/resource/META-INF/persistence.xml</li>
<li>for maven test folder → src/test/resource/META-INF/persistence.xml</li>
</ul>


<p>If uses maven structure in Eclipse IDE, main resource and test resource
would complied to same directory(the build directory), we should avoid
using the same <strong>persistence-unit</strong> name in test and main resources</p>

<h1>presitence.xml</h1>

<h3>Hibernate</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
</span><span class='line'>&lt;persistence version="1.0" xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;
</span><span class='line'>    &lt;persistence-unit name="entity" transaction-type="RESOURCE_LOCAL"&gt;
</span><span class='line'>        &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
</span><span class='line'>        &lt;class&gt;com.kent.MyClass&lt;/class&gt;
</span><span class='line'>        &lt;properties&gt;
</span><span class='line'>            &lt;property name="hibernate.hbm2ddl.auto" value="update" /&gt;
</span><span class='line'>            &lt;property name="hibernate.dialect" value="org.hibernate.dialect.MySQLDialect" /&gt;
</span><span class='line'>            &lt;property name="hibernate.connection.driver_class" value="com.mysql.jdbc.Driver" /&gt;
</span><span class='line'>            &lt;property name="hibernate.connection.url" value="jdbc:mysql://localhost/database_name" /&gt;
</span><span class='line'>            &lt;property name="hibernate.connection.username" value="root" /&gt;
</span><span class='line'>            &lt;property name="hibernate.connection.password" value="" /&gt;
</span><span class='line'>                        &lt;property name="hibernate.show_sql" value="true" /&gt;
</span><span class='line'>        &lt;/properties&gt;
</span><span class='line'>    &lt;/persistence-unit&gt;
</span><span class='line'>&lt;/persistence&gt;</span></code></pre></td></tr></table></div></figure>


<p>set property bernate.show_sql to true to output HSQL → SQL in console.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;property name="hibernate.dialect" value="org.hibernate.dialect.MySQLDialect" /&gt;
</span><span class='line'>&lt;property name="hibernate.connection.driver_class" value="com.mysql.jdbc.Driver" /&gt;
</span><span class='line'>&lt;property name="hibernate.connection.url" value="jdbc:mysql://localhost/database_name" /&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;property name="hibernate.connection.url" value="jdbc:hsqldb:mem:database_name"/&gt;
</span><span class='line'>&lt;property name="hibernate.connection.driver_class" value="org.hsqldb.jdbcDriver"/&gt;
</span><span class='line'>&lt;property name="hibernate.dialect" value="org.hibernate.dialect.HSQLDialect"/&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;property name="hibernate.connection.url" value="jdbc:derby:memory:database_name"/&gt;
</span><span class='line'>&lt;property name="hibernate.connection.driver_class" value="org.apache.derby.jdbc.EmbeddedDriver"/&gt;
</span><span class='line'>&lt;property name="hibernate.dialect" value="org.hibernate.dialect.DerbyDialect"/&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;property name="hibernate.connection.url" value="jdbc:postgresql://localhost:5432/databaseName"/&gt;
</span><span class='line'>&lt;property name="hibernate.connection.driver_class" value="org.postgresql.Driver"/&gt;
</span><span class='line'>&lt;property name="hibernate.dialect" value="org.hibernate.dialect.PostgreSQLDialect"/&gt;</span></code></pre></td></tr></table></div></figure>


<p>MySQL encoding issue. If you encountered encoding issue when result set
contains CJK code, you can add this property to url connection string.
<code>?useUnicode=true&amp;amp;characterEncoding=UTF-8</code> ex:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  jdbc:mysql://localhost/database_name?useUnicode=true&amp;characterEncoding=UTF-8</span></code></pre></td></tr></table></div></figure>


<h3>EclipseLink - MySQL</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
</span><span class='line'>&lt;persistence version="1.0" xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;
</span><span class='line'>    &lt;persistence-unit name="entity" transaction-type="RESOURCE_LOCAL"&gt;
</span><span class='line'>    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
</span><span class='line'>        &lt;class&gt;com.kent.MyClass&lt;/class&gt;
</span><span class='line'>        &lt;properties&gt;
</span><span class='line'>            &lt;property name="eclipselink.target-database" value="MYSQL"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.jdbc.url" value="jdbc:mysql://localhost/database_name"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.jdbc.driver" value="com.mysql.jdbc.Driver"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.jdbc.user" value="root"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.jdbc.password" value=""/&gt;
</span><span class='line'>            &lt;property name="eclipselink.ddl-generation" value="update-tables"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.logging.level" value="SEVERE"/&gt;
</span><span class='line'>        &lt;/properties&gt;
</span><span class='line'>    &lt;/persistence-unit&gt;
</span><span class='line'>&lt;/persistence&gt;</span></code></pre></td></tr></table></div></figure>


<h3>EclipseLink - HSQL</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
</span><span class='line'>&lt;persistence version="1.0" xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;
</span><span class='line'>    &lt;persistence-unit name="entity" transaction-type="RESOURCE_LOCAL"&gt;
</span><span class='line'>    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
</span><span class='line'>        &lt;class&gt;com.kent.MyClass&lt;/class&gt;
</span><span class='line'>        &lt;properties&gt;
</span><span class='line'>            &lt;property name="eclipselink.target-database" value="HSQL"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.jdbc.url" value="jdbc:hsqldb:mem:database_name"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.jdbc.driver" value="org.hsqldb.jdbcDriver"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.jdbc.user" value="sa"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.jdbc.password" value=""/&gt;
</span><span class='line'>            &lt;property name="eclipselink.ddl-generation" value="create-tables"/&gt;
</span><span class='line'>            &lt;property name="eclipselink.logging.level" value="SEVERE"/&gt;
</span><span class='line'>        &lt;/properties&gt;
</span><span class='line'>    &lt;/persistence-unit&gt;
</span><span class='line'>&lt;/persistence&gt;</span></code></pre></td></tr></table></div></figure>


<h1>Properties</h1>

<p>EclipseLink does NOT support the property <code>show sql</code> like hibernate, but
we can turn the logging system to <code>FINE</code> level
(<code>&lt;property name=“eclipselink.logging.level” value=“FINE”/&gt;</code>), the
interpret SQL would be dumped.</p>

<h1>CRUD</h1>

<p><strong>C</strong>reate, <strong>R</strong>ead, <strong>U</strong>pdate, <strong>D</strong>elete operations in JPA</p>

<p>Read類型的methods像find(), getReference(), refresh(), detach() and read
queries，可以在transaction外執行(沒有tx.begin()/tx.commit()的包覆).</p>

<h4>Create</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>entityManager.getTransaction().begin();
</span><span class='line'>Employee newEmployee = new Employee(5);
</span><span class='line'>entityManager.persist(newEmployee);
</span><span class='line'>entityManager.getTransaction().commit();</span></code></pre></td></tr></table></div></figure>


<h4>Read</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>entityManager.find(Employee.class, 1);
</span><span class='line'>// lazy load (as same as hibernate load() method)
</span><span class='line'>entityManager.getReference(Employee.class, 1);
</span><span class='line'>entityManager.createQuery("select employee from Employee employee");</span></code></pre></td></tr></table></div></figure>


<ul>
<li>for single result uses <code>query.getSingleResult()</code>;</li>
<li>for multiple results (result set) uses <code>query.getResultList()</code>;</li>
</ul>


<h4>Update</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>entityManager.getTransaction().begin();
</span><span class='line'>Employee existingEmployee = entityManager.find(Employee.class, 5);
</span><span class='line'>existingEmployee.setLastName("NewLastName");
</span><span class='line'>entityManager.getTransaction().commit();</span></code></pre></td></tr></table></div></figure>


<p>or</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Employee existingEmployee = entityManager.find(Employee.class, 5);
</span><span class='line'>existingEmployee.setLastName("NewLastName");
</span><span class='line'> 
</span><span class='line'>entityManager.getTransaction().begin();
</span><span class='line'>entityManager.getTransaction().commit();</span></code></pre></td></tr></table></div></figure>


<h4>Delete</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>entityManager.getTransaction().begin();
</span><span class='line'>Employee existingEmployee = entityManager.find(Employee.class, 5);
</span><span class='line'>entityManager.remove(existingEmployee);
</span><span class='line'>entityManager.getTransaction().commit();</span></code></pre></td></tr></table></div></figure>


<h3>Bulk Update / Delete</h3>

<h4>Bulk Update</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>EntityManager entityManager = entityManagerFactory.createEntityManager();
</span><span class='line'>entityManager.getTransaction().begin();
</span><span class='line'>String jpqlUpdate = "update Customer set name = :newName where name = :oldName"
</span><span class='line'>int updatedEntities = entityManager.createQuery( jpqlUpdate )
</span><span class='line'>                            .setParameter( "newName", newName )
</span><span class='line'>                            .setParameter( "oldName", oldName )
</span><span class='line'>                            .executeUpdate();
</span><span class='line'>entityManager.getTransaction().commit();
</span><span class='line'>entityManager.close();</span></code></pre></td></tr></table></div></figure>


<h4>Bulk Delete</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>EntityManager entityManager = entityManagerFactory.createEntityManager();
</span><span class='line'>entityManager.getTransaction().begin();
</span><span class='line'>String hqlDelete = "delete Customer where name = :oldName";
</span><span class='line'>int deletedEntities = entityManager.createQuery( hqlDelete )
</span><span class='line'>                            .setParameter( "oldName", oldName )
</span><span class='line'>                            .executeUpdate();
</span><span class='line'>entityManager.getTransaction().commit();
</span><span class='line'>entityManager.close();</span></code></pre></td></tr></table></div></figure>


<h1>Tips</h1>

<ul>
<li>Using wrapper type rather than primitive type to avoid <a href="http://stackoverflow.com/questions/2565352/whats-difference-between-primitive-and-wrapper-class-in-jpa-hibernate-column-m" title="http://stackoverflow.com/questions/2565352/whats-difference-between-primitive-and-wrapper-class-in-jpa-hibernate-column-m">null
assinged
issue</a>.</li>
</ul>


<h1>FK constraint violation</h1>

<p>Sometime the forgine key constraint that export by DDL tools would be a
problem when doing unit testing. But there is no way to disable
hibernate FK constraints exports. In the situation we can rewrite the
Dialect to prevent FK constraints exported.</p>

<p>In this case, we created our own H2Dialet (for <a href="http://www.h2database.com/html/main.html" title="http://www.h2database.com/html/main.html">H2
database</a>)
and let <code>getAddForeignKeyConstraintString()</code> method empty. Which will
disable the original <code>org.hibernate.dialect.H2Dialect</code> constraint
generating statement.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package com.kent.hibernate.dialect;
</span><span class='line'>
</span><span class='line'>public class H2Dialect extends org.hibernate.dialect.H2Dialect {
</span><span class='line'>    @Override
</span><span class='line'>    public String getAddForeignKeyConstraintString(String constraintName, String[] foreignKey, String referencedTable, String[] primaryKey, boolean referencesPrimaryKey) {
</span><span class='line'>        return "";
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Once we have the Dialect, we need apply it our persistence.xml, after
done, when the schema be generated, the schema will not include any FK
constraint.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
</span><span class='line'>&lt;persistence version="1.0" xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;
</span><span class='line'>    &lt;persistence-unit name="entity-test" transaction-type="RESOURCE_LOCAL"&gt;
</span><span class='line'>        &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
</span><span class='line'>                 ...
</span><span class='line'>        &lt;properties&gt;
</span><span class='line'>            ...
</span><span class='line'>            &lt;property name="hibernate.hbm2ddl.auto" value="create-drop" /&gt;
</span><span class='line'>                        &lt;property name="hibernate.dialect" value="com.kent.hibernate.dialect.H2Dialect"/&gt;
</span><span class='line'>            ...
</span><span class='line'>        &lt;/properties&gt;
</span><span class='line'>    &lt;/persistence-unit&gt;
</span><span class='line'>&lt;/persistence&gt;</span></code></pre></td></tr></table></div></figure>


<h1>JPA Query</h1>

<p>JPA Query supports</p>

<ol>
<li>query</li>
<li><strong>update</strong></li>
<li><strong>delete</strong></li>
</ol>


<p>function to retrieves, modify, remove data from database.</p>

<h5>IS [NOT] EMPTY</h5>

<p>JPA provides a <strong>empty</strong> to test a collection empty or not:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select book from Book book where book.chapters is not empty</span></code></pre></td></tr></table></div></figure>


<h5>Join Fetch</h5>

<p>JPA tries to fetch any entity as LAZY as possible whatever uses JPA QL
or get by API.</p>

<p>Fetch lazy or eager is by JPA vendor implementation, not all field type
can fetch as LAZY</p>

<h3>Local Manager Transaction</h3>

<p>In a non-managed environment, an EntityManagerFactory is usually
responsible for its own database connection pool. The application
developer has to manually set transaction boundaries, in other words,
begin, commit, or rollback database transactions itself</p>

<p>If using local manager transaction, better to apply this template in
code.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Non-managed environment idiom
</span><span class='line'>EntityManager em = emf.createEntityManager();
</span><span class='line'>EntityTransaction tx = null;
</span><span class='line'>try {
</span><span class='line'>    tx = em.getTransaction();
</span><span class='line'>    tx.begin();
</span><span class='line'>    // do some work
</span><span class='line'>    ...
</span><span class='line'>    tx.commit();
</span><span class='line'>} catch (RuntimeException e) {
</span><span class='line'>    if ( tx != null && tx.isActive() ) tx.rollback();
</span><span class='line'>    throw e; // or display error message
</span><span class='line'>} finally {
</span><span class='line'>    em.close(); // make sure you always close and never outside of guaranteed finally block
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Joins and Fetches</h3>

<ol>
<li>inner join = join</li>
<li>left out join = left join</li>
<li>fetch = 用一個select把屬性或集合一次取回</li>
<li>fetch all = 如果有lazy properties，可用fetch all去init all lazy</li>
</ol>


<h1>Expressions</h1>

<ul>
<li>is empty, is not empty</li>
<li>member of, not member of 僅適用於embedded object</li>
<li>elements 測試某個element是否在elements中</li>
<li>minimum, maximum, minindex, maxindex 可用於 array, list, map</li>
<li>KEY() and VALUE() 可用於map</li>
<li>any, some, all, exists, in 這幾個可以和elements,minimum, maximum,
minindex, maxinde 搭配使用</li>
<li>current_date(), current_time(), current_timestamp()</li>
<li>second(…), minute(…), hour(…), day(…), month(…), year(…), (specific
to HQL)</li>
<li>coalesce() and nullif() coalesce（） 取回第一個非NULL的值</li>
<li>TYPE … in …</li>
<li>cast(… as …)</li>
<li>Java public static final constants eg.Color.TABBY</li>
</ul>


<h5>member of</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>'867-5309' MEMBER OF p.phoneNumbers</span></code></pre></td></tr></table></div></figure>


<h5>coalesce</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SELECT COALESCE( NULL, 34, 13, 0 )
</span><span class='line'>// return 34</span></code></pre></td></tr></table></div></figure>


<h5>any, some, all, exists, in</h5>

<p><a href="http://twpug.net/docs/postgresql-doc-8.0-zh_TW/functions-subquery.html" title="http://twpug.net/docs/postgresql-doc-8.0-zh_TW/functions-subquery.html">any, some, all, exists,
in</a>在SQL-92中的定義</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select mother from Cat as mother, Cat as kit
</span><span class='line'>where kit in elements(foo.kittens)</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select p from NameList list, Person p where p.name = some elements(list.names)</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select cat from Cat cat where exists elements(cat.kittens)</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select cat from Player p where 3 &gt; all elements(p.scores)</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select cat from Show show where 'fizard' in indices(show.acts)</span></code></pre></td></tr></table></div></figure>


<h5>index</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select order from Order order where order.items[0].id = 1234</span></code></pre></td></tr></table></div></figure>


<h5>KEY(),VALUE()</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select i.name, VALUE(p) FROM Item i JOIN i.photos p WHERE KEY(p) LIKE ‘%egret’</span></code></pre></td></tr></table></div></figure>


<p>Data in collection</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public List&lt;Role&gt; listRolesByPermissions(Set&lt;String&gt; permissions) {
</span><span class='line'>  String ql = "select role from Role role left join role.permissions p where p in (:perms)";
</span><span class='line'>  Query q = entityManager.createQuery(ql).setParameter("perms", permissions);
</span><span class='line'>  return q.getResultList();
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>上面的例子採用naming parameter可以正常動作，但下面採用position
parameter的方式卻不行？</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public List&lt;Role&gt; listRolesByPermissions(Set&lt;String&gt; permissions) {
</span><span class='line'>  String ql = "select role from Role role left join role.permissions p where p in (?)";
</span><span class='line'>  Query q = entityManager.createQuery(ql).setParameter(1, permissions);
</span><span class='line'>  return q.getResultList();
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h1>Implementation Restrictions</h1>

<p>To avoid conflicts with the original database operation that fires the
entity lifecycle event (which is still in progress) callback methods
should not call <code>EntityManager</code> or <code>Query</code> methods and should not access
other entity objects.</p>

<p>If a callback method throws an exception within an active transaction,
the transaction is marked for rollback and no more callback methods are
invoked for that operation.</p>

<h1>Architecture</h1>

<h4>EntityManagerFactory</h4>

<p>建立時會比較耗時耗資源，所以應隨server啟動而啟動，關閉而關閉.</p>

<h4>EntityManager</h4>

<p>The EntityManager API is used to access a database in a particular unit
of work. 正常來說，EntityManager的life cycle應該是一個database
transaction(也就是說，應隨著transaction committed而close),
但也可以跨多個database
transactions(跟hibernate的session一樣，可以跟多個transaction).
如果發生任何例外的話，應該要立即呼叫<code>EntityManager.close()</code>，並且棄用EntityManager
instance.</p>

<h1>Annotations</h1>

<p>如果需要讓boolean有預設值，可透過<code>@Column</code>的<code>columnDefinition</code>屬性</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Column(columnDefinition = "bool default false")
</span><span class='line'>private boolean   boolField;</span></code></pre></td></tr></table></div></figure>


<p>如果要讓欄位接受null，要宣告成物件型別(Object
type)而非原生型別(primitive type)</p>

<h1>Resources</h1>

<ul>
<li><a href="http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_%28ELUG%29" title="http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_%28ELUG%29">EclipseLink
properties</a></li>
<li><a href="http://docs.jboss.org/hibernate/stable/annotations/reference/en/html_single/" title="http://docs.jboss.org/hibernate/stable/annotations/reference/en/html_single/">hibernate annotations reference
manual</a></li>
<li><a href="http://docs.jboss.org/hibernate/stable/entitymanager/reference/en/html/index.html" title="http://docs.jboss.org/hibernate/stable/entitymanager/reference/en/html/index.html">hibernate Entity Manager reference
manual</a></li>
<li><a href="http://en.wikibooks.org/wiki/Java_Persistence" title="http://en.wikibooks.org/wiki/Java_Persistence">JPA 2 on
wikibook</a></li>
<li><a href="http://wiki.kent-chiu.com/lib/exe/fetch.php?media=java:jpa_mapping.pdf" title="java:jpa_mapping.pdf">A JavaTM Persistence API Mapping Magical Mystery
Tour</a>

<ul>
<li>相當清晰的MAPPING介紹</li>
</ul>
</li>
<li><a href="http://uaihebert.com/?p=1274" title="http://uaihebert.com/?p=1274">JPA Queries and
Tips</a> -
JPA的使用實例，有不到best practices的使用</li>
</ul>


<p>[java</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/02/scala_101/">Scala 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-02T00:00:00+08:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2012</time>
        
         | <a href="/blog/2012/07/02/scala_101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Scala IDE</p>

<ol>
<li>eclipse 3.7 (indigo)</li>
<li>scala IDE plugin 2.9</li>
<li>jdk 1.7.03</li>
</ol>


<p>一切換到scala的環境，IDE就凍住了，用<a href="http://wiki.kent-chiu.com/doku.php?id=java:jvm_profile" title="java:jvm_profile">VirtualVM</a>觀查的結果是執行scala的vm(不是ide本身的vm)的Permanent
Generation
Memory爆了，把它開到256M(-XX:MaxPermSize=256m)就不會一切到scala
perspective，IDE就掛掉。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#utf8 (do not remove)
</span><span class='line'>-startup
</span><span class='line'>../../Common/plugins/org.eclipse.equinox.launcher_1.2.0.v20110502.jar
</span><span class='line'>--launcher.library
</span><span class='line'>../../Common/plugins/org.eclipse.equinox.launcher.i18n.win32.win32.x86_64_4.2.0.v201201111650
</span><span class='line'>-showsplash
</span><span class='line'>C:\Genuitec\Common\plugins\org.eclipse.platform_3.7.2.v201202080800\splash.bmp
</span><span class='line'>--launcher.XXMaxPermSize
</span><span class='line'>256m
</span><span class='line'>--launcher.defaultAction
</span><span class='line'>openFile
</span><span class='line'>-install
</span><span class='line'>C:\Genuitec\Profiles\scala
</span><span class='line'>-configuration
</span><span class='line'>C:\Genuitec\Profiles\scala\configuration
</span><span class='line'>-vmargs
</span><span class='line'>-Xms256m
</span><span class='line'>-Xmx1024m
</span><span class='line'>-XX:MaxPermSize=256m</span></code></pre></td></tr></table></div></figure>


<ul>
<li>scala是可自我成長的語言</li>
<li>scala混合了oo跟function lang</li>
<li>java中的static method可以考慮用function的方式實現，statistic
method可視為一種退化的function lang?</li>
<li>scala是純oo
lang，所有的東西都是物件，所有的操作(含運算子)都是method，所以，可以做運算子的override</li>
<li><p>scala可以與java無縫的整合，事實上，scala很多型號都是來自java。scala
call java lib會很容易，但java call
scala會有比較多的限制，因為scala的物件模型及語意比java豐富，java沒辦法一一對應。</p></li>
<li><p>scala有兩種變數</p></li>
<li><p>expression後面的分號(;)可有可無</p></li>
<li>val : 像java的final變數，一旦宣告後，就不能改變
(如果重新指派，會出reassignment的error)</li>
<li><p>var : 像java的non final變數，可以重新指派值</p></li>
<li><p>scala的array跟java一樣是0-base但是，是透過()存取，而不是[]</p></li>
</ul>


<h5>method</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def mymethod(x: Int, y: Int) : Int = {
</span><span class='line'>  x + y
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def mymethod(x: Int, y: Int) = x + y</span></code></pre></td></tr></table></div></figure>


<p>所有的運算子在scala都是method，所以<code>1 + 2</code>是這樣的method call</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(1).+(2)</span></code></pre></td></tr></table></div></figure>


<p><code>1</code>是物件,<code>+</code>是method name，<code>1</code>物件透過<code>.</code>來呼叫<code>+</code>method並傳入參數值<code>2</code></p>

<p>以這樣的角度來看Array，Array就很直覺了，Array在Scala也只是一般的物件，而不是像java一樣，而不是像java一樣，是屬於語法等級的物件</p>

<h5>foreach</h5>

<p>for (arg ← args) println(arg)</p>

<h3>function</h3>

<h4>function literal</h4>

<p>單行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(x: Int, y: Int) =&gt; x + y </span></code></pre></td></tr></table></div></figure>


<p>多行時可以用大括號將 functio body括起來</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(x: Int, y: Int) =&gt; {
</span><span class='line'>    val z = x + 1
</span><span class='line'>    z + y
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>這邊用function literal來達到foreach的功能，function literal有三種用法</p>

<p>第一種是最囉嗦,array的item要給型別而且給了型別，外面還要配一對括號</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>myarray.foreach((item: String) =&gt; println(item))</span></code></pre></td></tr></table></div></figure>


<p>這個是比較正常的用法</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>myarray.foreach(item =&gt; println(item))</span></code></pre></td></tr></table></div></figure>


<p>超精簡的用法，但只適用於只有一個參數的狀況</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>myarray.foreach(println)</span></code></pre></td></tr></table></div></figure>


<h5>function return type</h5>

<p>為什麼sum function可以不用指定return type，而factorial必須指定return
type為Int?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  def sum(a:Int,b:Int) = a+b
</span><span class='line'>  def factorial(n:Int):Int = if (n==0) 1 else n * factorial(n-1)</span></code></pre></td></tr></table></div></figure>


<p>因為在sum function中complier可以推斷(infer)出a +
b的回傳值是Int型別，但在factorial中，回傳值可能是 1
或者是<code>n * factorial(n-1)</code>，
而<code>n * factorial(n-1)</code>是未知型別，所以，我們必須指定return
type，給complier一個提示。</p>

<p>有些語言的compiler可以由factorial function的第一個回傳值為1來推斷return
type為Int，但scala的complier不行</p>

<h5>operator notation</h5>

<ol>
<li>infix 1 + 2</li>
<li>prefix +1,-1, !foo, \~bar (只有+,-,!,\~可以為prefix
operator,定為方式為<code>unary_+</code>,<code>unary_-</code>,<code>unary_!</code>,<code>unary_~</code>,)</li>
<li>postfix 1.toLong</li>
</ol>


<h4>functionN</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package scala
</span><span class='line'> 
</span><span class='line'> 
</span><span class='line'>trait Function2[@specialized(scala.Int, scala.Long, scala.Double) -T1, @specialized(scala.Int, scala.Long, scala.Double) -T2, @specialized(scala.Unit, scala.Boolean, scala.Int, scala.Float, scala.Long, scala.Double) +R] extends AnyRef { self =&gt;
</span><span class='line'>  /** Apply the body of this function to the arguments.
</span><span class='line'>   *  @return   the result of function application.
</span><span class='line'>   */
</span><span class='line'>  def apply(v1: T1, v2: T2): R
</span><span class='line'> 
</span><span class='line'>  /** Creates a curried version of this function.
</span><span class='line'>   *
</span><span class='line'>   *  @return   a function `f` such that `f(x1)(x2) == apply(x1, x2)`
</span><span class='line'>   */
</span><span class='line'>  def curried: T1 =&gt; T2 =&gt; R = {
</span><span class='line'>    (x1: T1) =&gt; (x2: T2) =&gt; apply(x1, x2)
</span><span class='line'>  }
</span><span class='line'>  @deprecated("Use 'curried' instead", "2.8.0")
</span><span class='line'>  def curry = curried
</span><span class='line'> 
</span><span class='line'>  /** Creates a tupled version of this function: instead of 2 arguments,
</span><span class='line'>   *  it accepts a single [[scala.Tuple2]] argument.
</span><span class='line'>   *
</span><span class='line'>   *  @return   a function `f` such that `f((x1, x2)) == f(Tuple2(x1, x2)) == apply(x1, x2)`
</span><span class='line'>   */
</span><span class='line'>  def tupled: Tuple2[T1, T2] =&gt; R = {
</span><span class='line'>    case Tuple2(x1, x2) =&gt; apply(x1, x2)
</span><span class='line'>  }
</span><span class='line'>  override def toString() = "&lt;function2&gt;"
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>scala中的每個function，都是實作像上面的functionN(N從0\~22)的trait，以<code>(x: Int, y: Int) ⇒ x + y</code>來說，就是上例中的Function2[-T1,
-T2, +R]， 因為 (x: Int, y: Int) ⇒ x + y 就
傳入兩個int的參數並傳回一個int的結果，這樣與Function2的<code>def apply(v1: T1, v2: T2): R</code>是相等的。</p>

<h4>closure</h4>

<p>closure跟function literal語法很相似，但closure多了<a href="#free_variables" title="scala:scala_101 ↵">free
variables</a>，所以，free
variables可被當做區分closure跟function literal的依據</p>

<h5>free variables</h5>

<p>TBC</p>

<h4>Constructor</h4>

<h5>primary constructor</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class MyClass(x: Int, y: Int)</span></code></pre></td></tr></table></div></figure>


<h5>auxiliary constructor</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class MyClass(x: Int) {
</span><span class='line'>    def this(x:Int) = this(x, 1) 
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>在scala，只有primary constructor可以呼叫super class的Constructor</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> </span></code></pre></td></tr></table></div></figure>


<h4>function parameters</h4>

<h5>repeated parameters</h5>

<p>repeated parameters像java的 myfunc(String…
args)，後面能用0到多個相同型別的參數</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def myfunc(args: String*)</span></code></pre></td></tr></table></div></figure>


<h5>naming parameters</h5>

<p>naming
parameters主要是在使用functions時可以指定參數的名稱，也因為可以指定參數的名稱，
所以傳入的參數順序可以跟原來宣告時的不一樣</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def myfunc(foo: Int, bar: String)
</span><span class='line'> 
</span><span class='line'>// call myfunc with naming parameter
</span><span class='line'>val x = myfunc(bar="test", foo=1)</span></code></pre></td></tr></table></div></figure>


<h5>default value</h5>

<p>參數的預設值，如果沒有特別指定時，參數會以預設值為準</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def myfunc(foo: Int = 5)</span></code></pre></td></tr></table></div></figure>


<h5>loop</h5>

<p>如while 或者是 do-while loop 都是會帶有副作用(side
effect)，請儘量改用其他的方式實作</p>

<h5>for</h5>

<p>for loop有filter的功能</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>val filesHere = (new java.io.File(".")).listFiles
</span><span class='line'>for (file &lt;- filesHere if file.getName.endsWith(".scala"))
</span><span class='line'>  println(file)
</span><span class='line'> 
</span><span class='line'>// 上面那邊，的效果等同於  
</span><span class='line'>for (file &lt;- filesHere)
</span><span class='line'>  if (file.getName.endsWith(".scala"))
</span><span class='line'>    println(file)  </span></code></pre></td></tr></table></div></figure>


<p>filter也可以累加，像這樣</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for (
</span><span class='line'>  file &lt;- filesHere
</span><span class='line'>  if file.isFile
</span><span class='line'>  if file.getName.endsWith(".scala")
</span><span class='line'>) println(file)</span></code></pre></td></tr></table></div></figure>


<h5>apply() and update()</h5>

<p><code>()</code>跟<code>()=</code>是語法糖(complier sugar)，分別等效於<code>apply()</code>跟<code>update()</code> ()
: apply() ()= : update()</p>

<h3>Import and Package</h3>

<h5>pacakge</h5>

<ol>
<li>可以是 java style ，把 package name 放在最上面</li>
<li>可以是 c# like，用 com.kentchiu { <em>package content } 或 com{
kentchiu {</em> package content} }</li>
<li>_root_ package</li>
</ol>


<h5>import</h5>

<p>與 java 的不同</p>

<ol>
<li>可以直接 import class member</li>
<li>可以 rename 或隱藏部份被 import 的 members</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import com.kentchiu.{Foo, Bar}        // 只 import Foo 跟 Bar
</span><span class='line'>import com.kentchiu.{Foo, Bar =&gt; Baz} // 只 import Foo 跟 Bar， Bar 改名為 Baz
</span><span class='line'>import com.kentchiu.{Bar =&gt; _, _}     // Bar rename 成 _ ，會變成 import com.kentchiu 但把 Bar 排外</span></code></pre></td></tr></table></div></figure>


<h3>trait</h3>

<p>Trait像是java的interface，不過，更像是ruby的mixin</p>

<h5>Ordered Trait</h5>

<p>Ordered Trait是用來說明trait一個很好的例子，Rubyer應該對這個例子很眼熟</p>

<h3>case class</h3>

<h5>function programming</h5>

<p>Functional programming is a programming paradigm that describes
computation as the evaluation of mathematical functions avoiding state,
mutual data and therefore side effects</p>

<p>Function programming based on applying functions to arguments in order
to receive some desired values</p>

<p>The core idea for computation has shifted from a series of instructions
(which specify precisely how the computation should proceed) to Notation
of expressions, based on functions and values. You no longer have to
follow a plan of instructions in order to understand a computation but
decompose such an expression into its single elements.</p>

<h3>Sequence Comprehensions</h3>

<h3>Tuple</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scala&gt; val t = (1,2)
</span><span class='line'>t: (Int, Int) = (1,2)
</span><span class='line'> 
</span><span class='line'>scala&gt; val t = new Tuple2(1,2)
</span><span class='line'>t: (Int, Int) = (1,2)</span></code></pre></td></tr></table></div></figure>


<p>tuple是透過特殊index語法存取</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scala&gt; t._1
</span><span class='line'>res3: Int = 1
</span><span class='line'> 
</span><span class='line'>scala&gt; t._2
</span><span class='line'>res4: Int = 2</span></code></pre></td></tr></table></div></figure>


<p>另外一種建立tuple的語法</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>scala&gt; 1-&gt;2
</span><span class='line'>res0: (Int, Int) = (1,2)</span></code></pre></td></tr></table></div></figure>


<h3>Extractors</h3>

<p>利用 <code>unApply()</code> method搭配pattern match將資訊從class中萃取出來</p>

<h3>Parser Combinators</h3>

<ul>
<li>Christoph Henkelmann’s Blog - An Introduction To Scala Parser
Combinators

<ol>
<li><a href="http://henkelmann.eu/2011/01/13/an_introduction_to_scala_parser_combinators" title="http://henkelmann.eu/2011/01/13/an_introduction_to_scala_parser_combinators">Part 1: Parser
Basics</a></li>
<li><a href="http://henkelmann.eu/2011/01/28/an_introduction_to_scala_parser_combinators-part_2_literal_expressions" title="http://henkelmann.eu/2011/01/28/an_introduction_to_scala_parser_combinators-part_2_literal_expressions">Part 2: Parsing Literal
Expressions</a></li>
<li><a href="http://henkelmann.eu/2011/01/29/an_introduction_to_scala_parser_combinators-part_3_unit_tests" title="http://henkelmann.eu/2011/01/29/an_introduction_to_scala_parser_combinators-part_3_unit_tests">An Introduction To Scala Parser Combinators - Part 3: Writing
unit tests for
parsers</a></li>
</ol>
</li>
</ul>


<h3>Symbol Literals</h3>

<p>Symbol Literals是在字串前加一個單引號&#8217;，像這樣&#8217;foo</p>

<p>Symbol
Literal主要作用是用來當作識別用，可以視為一個字串，但它不同於字串的地方有</p>

<ol>
<li>不可以有任何空白</li>
<li>一致性</li>
<li>對重構比較友善</li>
</ol>


<p>像典型的map可以寫成這樣</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"key" -&gt; "value"</span></code></pre></td></tr></table></div></figure>


<p>key的部份可以換成Symbol Literal取代</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>'key -&gt; "value"</span></code></pre></td></tr></table></div></figure>


<p>這樣的好處是，&#8217;key更能代表唯一性，而且，如果要進行重構，&#8217;key對於重構的支援會比”key”來的好，如果任何地方需要用字串當作識別的時侯，或者可以考慮換成用Symbol
Literal取代</p>

<h1>TBD</h1>

<ul>
<li>The Divide and Conquer principle</li>
<li>Implicit Conversions and Parameters</li>
</ul>


<h1>Resource</h1>

<ul>
<li><a href="http://www.scala-lang.org/" title="http://www.scala-lang.org/">http://www.scala-lang.org/</a>
官網</li>
<li><a href="http://docs.scala-lang.org/index.html" title="http://docs.scala-lang.org/index.html">http://docs.scala-lang.org/index.html</a>
官網文件</li>
<li>Functional scala serial
這一系列教學，很適合java背景，而且沒有function programming的人

<ol>
<li><a href="http://gleichmann.wordpress.com/2010/10/28/functional-scala-introduction/" title="http://gleichmann.wordpress.com/2010/10/28/functional-scala-introduction/">episode 1:
Introduction</a></li>
<li><a href="http://gleichmann.wordpress.com/2010/10/31/functional-scala-functions/" title="http://gleichmann.wordpress.com/2010/10/31/functional-scala-functions/">episode 2:
Functions</a></li>
<li><a href="http://gleichmann.wordpress.com/2010/11/08/functional-scala-functions-as-objects-as-functions/" title="http://gleichmann.wordpress.com/2010/11/08/functional-scala-functions-as-objects-as-functions/">episode 3: Functions as Objects as
Functions</a></li>
<li><a href="http://gleichmann.wordpress.com/2010/11/15/functional-scala-closures/" title="http://gleichmann.wordpress.com/2010/11/15/functional-scala-closures/">episode 4:
Closures</a></li>
<li><a href="http://gleichmann.wordpress.com/2010/11/21/functional-scala-comprehending-comprehensions/" title="http://gleichmann.wordpress.com/2010/11/21/functional-scala-comprehending-comprehensions/">episode 5: Comprehending
Comprehensions</a></li>
<li><a href="http://gleichmann.wordpress.com/2010/11/28/high-higher-higher-order-functions/" title="http://gleichmann.wordpress.com/2010/11/28/high-higher-higher-order-functions/">episode 6: High, Higher, Higher Order
Functions</a></li>
<li><a href="http://gleichmann.wordpress.com/2010/12/05/functional-scala-lambdas-and-other-shortcuts/" title="http://gleichmann.wordpress.com/2010/12/05/functional-scala-lambdas-and-other-shortcuts/">episode 7: Lambdas and other
shortcuts</a></li>
</ol>
</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/02/play_framework_101/">Play Framework 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-02T00:00:00+08:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2012</time>
        
         | <a href="/blog/2012/07/02/play_framework_101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>在eclipse直接執行play console</h3>

<h3>Http Request處理流程</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>browser : http://localhost/foo?bar=baz
</span><span class='line'>
</span><span class='line'># project_home/conf/routes
</span><span class='line'>GET    /foo                        controllers.Application.foo(bar: String)
</span><span class='line'>
</span><span class='line'># project_home/app/controllers/Application.scala
</span><span class='line'>object Application extends Controller {
</span><span class='line'>
</span><span class='line'>    def foo(bar: String) = Action {
</span><span class='line'>        Ok("bar param value is: " +  bar) // 網頁顯示 bar param value is: baz
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>由網頁發起url: http://localhost/foo?bar=baz</li>
<li>play收到url後，會由routes這個設定檔來決定負責處理的controller是誰</li>
<li>controller中會有一個跟url
path相符的method進行處理，然後回應一個Action</li>
</ol>


<p>主要的流程就這樣，相當的單純</p>

<h3>Controller</h3>

<p>Controller是一個Singlton
Object，用來產生Action</p>

<h3>Action</h3>

<p>在play.api.mvc裡有兩個Action，一個是Singlton Object,另一個是trait，
trait的這個Action是一個 <code>play.api.mvc.Request ⇒ play.api.mvc.Result</code>
function負責處理並回應http request， 而Singtlton
Object這個Action是companion object，提供建立Action的一些helper
methods</p>

<p>Ok()這個method會回http status code 200給browser，http status code
200，就是沒有任何錯誤</p>

<p><img src="http://blog.kent-chiu.com/images/2012-07-02/play_framework_101-001.png" alt="play_framework_101-001.png" /></p>

<p>上面有提到Action是<code>play.api.mvc.Request ⇒ play.api.mvc.Result</code>
function，而AsyncResult, ChunkedResult, PlainResult, SimpleResult,
Status都是extends自trait Result，所以可以當作Action的傳回值</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package controllers
</span><span class='line'> 
</span><span class='line'>import play.api._
</span><span class='line'>import play.api.mvc._
</span><span class='line'> 
</span><span class='line'>object Application extends Controller {
</span><span class='line'> 
</span><span class='line'>  def index = Action {
</span><span class='line'>    Ok(views.html.index("Your new application is ready."))
</span><span class='line'>  }
</span><span class='line'> 
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Ok(context) 表示回應http 200(正常)給網頁，content是要顯示的內容</p>

<p>ex:</p>

<p><code>Ok("Hello World")</code></p>

<p>網頁就會顯示 Hello World</p>

<p><code>views.html.index("Your new application is ready.")</code></p>

<p>則是套用play的template來顯示內容</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def index(param: String) = Action { implicit request =&gt;
</span><span class='line'>  Ok("Got request [" + request + "] with param [" + param +"]")
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Request and Session</h3>

<p>Play的Session可以透過request.session取得，它是用cookie實作的，而且沒有所謂的session
timeout，如果需要session timeout的功能，要自已實作。</p>

<p>Play的Request不像java那樣，可以直接當作資料的載體，需透過Flash
Scope(也就是java servlet的request scope)</p>

<h2>Scala Template Engine</h2>

<h4>Handling the form submission</h4>

<p>在todolist這個教學中，有一段code是在建立 new
task的，這一些，對非scala的熟手來說不是那麼的易懂</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Application
</span><span class='line'>def newTask = Action { implicit request =&gt;
</span><span class='line'>  taskForm.bindFromRequest.fold(
</span><span class='line'>    errors =&gt; BadRequest(views.html.index(Task.all(), errors)),
</span><span class='line'>    label =&gt; {
</span><span class='line'>      Task.create(label)
</span><span class='line'>      Redirect(routes.Application.tasks)
</span><span class='line'>    }
</span><span class='line'>  )
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>newTask這個method的傳回值是Action型別,
taskForm一是個<code>play.api.data.Form</code>型別，而<code>bindFromRequest</code>跟<code>fold</code>的API如下:
taskForm.bindFromRequest的回傳值是Form[String]，而newTask的型別是Action，所以taskForm.bindFromRequest的結果不能直接當newAction的結果。
fold的回傳值是R，我們只要讓R為Action型別即可當newTask的回傳值。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * Binds request data to this form, i.e. handles form submission.
</span><span class='line'> *
</span><span class='line'> * @return a copy of this form filled with the new data
</span><span class='line'> */
</span><span class='line'>def bindFromRequest()(implicit request: play.api.mvc.Request[_]): Form[T] = {
</span><span class='line'>  val data = (request.body match {
</span><span class='line'>    case body: play.api.mvc.AnyContent if body.asFormUrlEncoded.isDefined =&gt; body.asFormUrlEncoded.get
</span><span class='line'>    case body: play.api.mvc.AnyContent if body.asMultipartFormData.isDefined =&gt; body.asMultipartFormData.get.asFormUrlEncoded
</span><span class='line'>    case body: play.api.mvc.AnyContent if body.asJson.isDefined =&gt; FormUtils.fromJson(js = body.asJson.get).mapValues(Seq(_))
</span><span class='line'>    case body: Map[_, _] =&gt; body.asInstanceOf[Map[String, Seq[String]]]
</span><span class='line'>    case body: play.api.mvc.MultipartFormData[_] =&gt; body.asFormUrlEncoded
</span><span class='line'>    case body: play.api.libs.json.JsValue =&gt; FormUtils.fromJson(js = body).mapValues(Seq(_))
</span><span class='line'>    case _ =&gt; Map.empty[String, Seq[String]]
</span><span class='line'>  }) ++ request.queryString
</span><span class='line'>  bind(data.mapValues(_.headOption.getOrElse("")))
</span><span class='line'>}
</span><span class='line'>   
</span><span class='line'>   
</span><span class='line'>def fold[R](hasErrors: Form[T] =&gt; R, success: T =&gt; R): R = value.map(success(_)).getOrElse(hasErrors(this))</span></code></pre></td></tr></table></div></figure>


<p>fold的第一個hasErrors的參數是，在這邊是個像這樣的function literal
Form[String] ⇒ R(也就是你需要傳入適合的function value進去)
因為我們希望fold的結果可以直接當newTask
method的回傳值，所以R的型別為Action，也就是</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def fold[R](hasErrors: Form[T] =&gt; R, success: T =&gt; R): R = value.map(success(_)).getOrElse(hasErrors(this))</span></code></pre></td></tr></table></div></figure>


<p>在這個例子的實際的型別是</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def fold[Action](hasErrors: Form[String] =&gt; Action, success: String =&gt; Action): Action = value.map(success(_)).getOrElse(hasErrors(this))</span></code></pre></td></tr></table></div></figure>


<p>fold的使用範例是這樣</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    anyForm.bindFromRequest().fold(
</span><span class='line'>       f =&gt; redisplayForm(f),                   // hasErrors: Form[String] =&gt; Action
</span><span class='line'>       t =&gt; handleValidFormSubmission(t)        // success: String =&gt; Action 
</span><span class='line'>    )
</span></code></pre></td></tr></table></div></figure>


<p>裡面的redisplayForm跟handleValidFormSubmission並不是play
API的一部份，他只是一個pseudo
code，用來表示通常hasErrors的處理方式是redisplayForm，而success的處理方式是handleValidFormSubmission</p>

<p>再回來看成來的例子</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Application
</span><span class='line'>def newTask = Action { implicit request =&gt;
</span><span class='line'>  taskForm.bindFromRequest.fold(
</span><span class='line'>    errors =&gt; BadRequest(views.html.index(Task.all(), errors)),  // hasErrors: Form[String] =&gt; Action
</span><span class='line'>    label =&gt; {                                                   // success: String =&gt; Action 
</span><span class='line'>      Task.create(label)
</span><span class='line'>      Redirect(routes.Application.tasks)
</span><span class='line'>    }
</span><span class='line'>  )
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h5>hasErrors參數的部份</h5>

<p>errors是Form[String]，而BadRequest是Action型別</p>

<p>hasErrors時會redisaply form，也就是用BadRequest(status 400)取代Ok(status
200)呼叫views.html.index，並把form的內容傳入</p>

<h5>success參數的部份</h5>

<p>label是String型別,
而傳回值Redirect(routes.Application.tasks)是Action型別 success時會handle
valid form submission，也就是建立task後，然後再轉到task list的頁面</p>

<h1>MISC</h1>

<h3>mapping method in Form</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import play.api.data._
</span><span class='line'>import play.api.data.Forms._
</span><span class='line'> 
</span><span class='line'>case class User(name: String, age: Int)
</span><span class='line'> 
</span><span class='line'>val userForm = Form(
</span><span class='line'>  mapping(
</span><span class='line'>    "name" -&gt; text,
</span><span class='line'>    "age" -&gt; number
</span><span class='line'>  )(User.apply)(User.unapply)
</span><span class='line'>)
</span><span class='line'> 
</span><span class='line'>val anyData = Map("name" -&gt; "bob", "age" -&gt; "18")
</span><span class='line'>val user: User = userForm.bind(anyData).get</span></code></pre></td></tr></table></div></figure>


<p>Form裡面的mapping，對於play的新手，很容易誤為是Form.mapping()，但怎麼看，都對不起來，完全不知道為什麼可以用apply()跟unapply()，其實它是Forms.mapping()</p>

<p>Forms.mapping是長這樣</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * Creates a Mapping of type `T`.
</span><span class='line'> *
</span><span class='line'> * For example:
</span><span class='line'> *
</span><span class='line'> * @tparam T the mapped type
</span><span class='line'> * @param apply A function able to create a value of T from a value of A1 (If T is case class you can use its own apply function)
</span><span class='line'> * @param unapply A function able to create A1 from a value of T (If T is a case class you can use its own unapply function)
</span><span class='line'> * @return a mapping for type `T`
</span><span class='line'> */
</span><span class='line'>def mapping[R, A1](a1: (String, Mapping[A1]))(apply: Function1[A1, R])(unapply: Function1[R, Option[(A1)]]): Mapping[R] = {
</span><span class='line'>  ObjectMapping1(apply, unapply, a1)
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>對於本來就看不太懂API的新手，還找錯API，只會讓新手更覺得太多無法理解的migic</p>

<h4>細節說明</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mapping[R, A1](a1: (String, Mapping[A1]))(apply: Function1[A1, R])(unapply: Function1[R, Option[(A1)]]): Mapping[R]</span></code></pre></td></tr></table></div></figure>


<p>mapping(…)(…)(…)把參數分成多個”群組”，表示這個function是<em>curried(柯里化)</em></p>

<p>先做大部拆解，這個method可以分為五個部份</p>

<ol>
<li>mapping[R, A1] 名稱，對應到上例中的mapping</li>
<li>(a1: (String, Mapping[A1])) 參數第一組，對應到上例中的 “email” →
of[String]</li>
<li>(apply: Function1[A1, R]) 參數第二組，對應到上例中的 User.apply</li>
<li>(unapply: Function1[R, Option[(A1)]]) 參數第三組，對應到上例中的
User.unapply</li>
<li>Mapping[R] 回傳值</li>
</ol>


<p>apply,unapply是來自case class</p>

<h5>mapping[R, A1]</h5>

<p>這部份可以知道裡面會有兩個泛型，一個是R,一個是A1</p>

<h5>(a1: (String, Mapping[A1]))</h5>

<p><code>(String, Mapping[A1])</code>是一個tuple，本例中為<code>“email” → of[String]</code></p>

<p>Mapping[A1]中的Mapping是trait型別，主要的功能是做格式間的轉換，本例是將request
string透過轉成String,Int,…格式</p>

<h5>(apply: Function1[A1, R])</h5>

<p><code>(apply: Function1[A1, R])</code>是一個function literal,在本例中為<code>User.apply</code>，</p>

<p>作用是將mapping的結果轉成User物件</p>

<p>由API可以知道Mapping是泛型<code>Mapping[R]</code>，所以R在例中，是<code>User</code></p>

<h5>(unapply: Function1[R, Option[(A1)]])</h5>

<p><code>(unapply: Function1[R, Option[(A1)]])</code>是一個function
literal,本例中為<code>User.unapply</code></p>

<p>作用是將User物件解構，把User的值再指派到<code>“email” → of[String]</code></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/07/15/mac-os-x-keyboard-shortcuts-for-terminal/">Mac OS X Keyboard Shortcuts for Terminal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/17/my-intellij-idea-shortcut/">My IntelliJ IDEA Shortcut</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/12/jesper-report-font-issue/">Jesper Report, IReport 匯出成中文PDF</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/12/jasperreport-101/">JasperReport 101</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/06/mac-tips/">Mac Tips</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Category Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/actionbar' style='font-size: 102.4%'>actionbar(1)</a> <a href='/blog/categories/android' style='font-size: 160.0%'>android(25)</a> <a href='/blog/categories/apache' style='font-size: 116.8%'>apache(7)</a> <a href='/blog/categories/bash' style='font-size: 107.2%'>bash(3)</a> <a href='/blog/categories/best-practice' style='font-size: 102.4%'>best_practice(1)</a> <a href='/blog/categories/book' style='font-size: 102.4%'>book(1)</a> <a href='/blog/categories/broadcast-receiver' style='font-size: 104.8%'>broadcast_receiver(2)</a> <a href='/blog/categories/cdi' style='font-size: 104.8%'>cdi(2)</a> <a href='/blog/categories/centos' style='font-size: 112.0%'>centos(5)</a> <a href='/blog/categories/clean-code' style='font-size: 102.4%'>clean code(1)</a> <a href='/blog/categories/command' style='font-size: 109.6%'>command(4)</a> <a href='/blog/categories/concurrency' style='font-size: 102.4%'>concurrency(1)</a> <a href='/blog/categories/database' style='font-size: 114.4%'>database(6)</a> <a href='/blog/categories/datetime' style='font-size: 102.4%'>datetime(1)</a> <a href='/blog/categories/di' style='font-size: 104.8%'>di(2)</a> <a href='/blog/categories/drawable' style='font-size: 102.4%'>drawable(1)</a> <a href='/blog/categories/ec' style='font-size: 102.4%'>ec(1)</a> <a href='/blog/categories/eclipse' style='font-size: 102.4%'>eclipse(1)</a> <a href='/blog/categories/ecshop' style='font-size: 116.8%'>ecshop(7)</a> <a href='/blog/categories/editor' style='font-size: 102.4%'>editor(1)</a> <a href='/blog/categories/emulator' style='font-size: 102.4%'>emulator(1)</a> <a href='/blog/categories/english' style='font-size: 133.6%'>english(14)</a> <a href='/blog/categories/excel' style='font-size: 104.8%'>excel(2)</a> <a href='/blog/categories/extjs' style='font-size: 104.8%'>extjs(2)</a> <a href='/blog/categories/gesture' style='font-size: 102.4%'>gesture(1)</a> <a href='/blog/categories/git' style='font-size: 109.6%'>git(4)</a> <a href='/blog/categories/git-flow' style='font-size: 102.4%'>git-flow(1)</a> <a href='/blog/categories/guava' style='font-size: 104.8%'>guava(2)</a> <a href='/blog/categories/guice' style='font-size: 102.4%'>guice(1)</a> <a href='/blog/categories/hamcrest' style='font-size: 102.4%'>hamcrest(1)</a> <a href='/blog/categories/i18n' style='font-size: 102.4%'>i18n(1)</a> <a href='/blog/categories/ide' style='font-size: 102.4%'>IDE(1)</a> <a href='/blog/categories/idea' style='font-size: 102.4%'>IDEA(1)</a> <a href='/blog/categories/injection' style='font-size: 102.4%'>injection(1)</a> <a href='/blog/categories/intent' style='font-size: 102.4%'>intent(1)</a> <a href='/blog/categories/ireport' style='font-size: 104.8%'>ireport(2)</a> <a href='/blog/categories/jasterreport' style='font-size: 104.8%'>jasterreport(2)</a> <a href='/blog/categories/java' style='font-size: 152.8%'>java(22)</a> <a href='/blog/categories/java-ee' style='font-size: 112.0%'>java_ee(5)</a> <a href='/blog/categories/jms' style='font-size: 102.4%'>jms(1)</a> <a href='/blog/categories/joda' style='font-size: 102.4%'>joda(1)</a> <a href='/blog/categories/jpa' style='font-size: 102.4%'>jpa(1)</a> <a href='/blog/categories/jquery' style='font-size: 102.4%'>jquery(1)</a> <a href='/blog/categories/jsp' style='font-size: 104.8%'>jsp(2)</a> <a href='/blog/categories/junit' style='font-size: 102.4%'>junit(1)</a> <a href='/blog/categories/jvm' style='font-size: 104.8%'>jvm(2)</a> <a href='/blog/categories/kohana' style='font-size: 102.4%'>kohana(1)</a> <a href='/blog/categories/l10n' style='font-size: 102.4%'>l10n(1)</a> <a href='/blog/categories/layout' style='font-size: 102.4%'>layout(1)</a> <a href='/blog/categories/linux' style='font-size: 126.4%'>linux(11)</a> <a href='/blog/categories/listview' style='font-size: 104.8%'>listview(2)</a> <a href='/blog/categories/logger' style='font-size: 102.4%'>logger(1)</a> <a href='/blog/categories/m2eclilpse' style='font-size: 102.4%'>m2eclilpse(1)</a> <a href='/blog/categories/mac' style='font-size: 104.8%'>mac(2)</a> <a href='/blog/categories/mat' style='font-size: 102.4%'>mat(1)</a> <a href='/blog/categories/maven' style='font-size: 112.0%'>maven(5)</a> <a href='/blog/categories/memory' style='font-size: 102.4%'>memory(1)</a> <a href='/blog/categories/menu' style='font-size: 102.4%'>menu(1)</a> <a href='/blog/categories/mindmap' style='font-size: 104.8%'>mindmap(2)</a> <a href='/blog/categories/misc' style='font-size: 102.4%'>misc(1)</a> <a href='/blog/categories/mysql' style='font-size: 116.8%'>mysql(7)</a> <a href='/blog/categories/nio' style='font-size: 102.4%'>nio(1)</a> <a href='/blog/categories/octopress' style='font-size: 102.4%'>octopress(1)</a> <a href='/blog/categories/oracle' style='font-size: 102.4%'>oracle(1)</a> <a href='/blog/categories/osgi' style='font-size: 107.2%'>osgi(3)</a> <a href='/blog/categories/pdf' style='font-size: 104.8%'>pdf(2)</a> <a href='/blog/categories/pdt' style='font-size: 112.0%'>pdt(5)</a> <a href='/blog/categories/pear' style='font-size: 104.8%'>pear(2)</a> <a href='/blog/categories/performace' style='font-size: 102.4%'>performace(1)</a> <a href='/blog/categories/pgsql' style='font-size: 102.4%'>pgsql(1)</a> <a href='/blog/categories/php' style='font-size: 114.4%'>php(6)</a> <a href='/blog/categories/play-framework' style='font-size: 102.4%'>play_framework(1)</a> <a href='/blog/categories/pm' style='font-size: 112.0%'>pm(5)</a> <a href='/blog/categories/postgresql' style='font-size: 104.8%'>postgresql(2)</a> <a href='/blog/categories/profile' style='font-size: 102.4%'>profile(1)</a> <a href='/blog/categories/programming' style='font-size: 128.8%'>programming(12)</a> <a href='/blog/categories/re' style='font-size: 102.4%'>re(1)</a> <a href='/blog/categories/refactory' style='font-size: 102.4%'>refactory(1)</a> <a href='/blog/categories/rest' style='font-size: 104.8%'>rest(2)</a> <a href='/blog/categories/roboguice' style='font-size: 102.4%'>roboguice(1)</a> <a href='/blog/categories/sbt' style='font-size: 102.4%'>sbt(1)</a> <a href='/blog/categories/scala' style='font-size: 109.6%'>scala(4)</a> <a href='/blog/categories/security' style='font-size: 102.4%'>security(1)</a> <a href='/blog/categories/service' style='font-size: 104.8%'>service(2)</a> <a href='/blog/categories/shiro' style='font-size: 102.4%'>shiro(1)</a> <a href='/blog/categories/shortchut' style='font-size: 102.4%'>shortchut(1)</a> <a href='/blog/categories/smarty' style='font-size: 107.2%'>smarty(3)</a> <a href='/blog/categories/spring' style='font-size: 102.4%'>spring(1)</a> <a href='/blog/categories/sql' style='font-size: 102.4%'>sql(1)</a> <a href='/blog/categories/style' style='font-size: 102.4%'>style(1)</a> <a href='/blog/categories/tdd' style='font-size: 102.4%'>tdd(1)</a> <a href='/blog/categories/testing' style='font-size: 124.0%'>testing(10)</a> <a href='/blog/categories/theme' style='font-size: 102.4%'>theme(1)</a> <a href='/blog/categories/tips' style='font-size: 104.8%'>tips(2)</a> <a href='/blog/categories/ubuntu' style='font-size: 119.2%'>ubuntu(8)</a> <a href='/blog/categories/ui' style='font-size: 104.8%'>ui(2)</a> <a href='/blog/categories/vim' style='font-size: 104.8%'>vim(2)</a> <a href='/blog/categories/web' style='font-size: 104.8%'>web(2)</a> <a href='/blog/categories/windows' style='font-size: 102.4%'>windows(1)</a> <a href='/blog/categories/xampp' style='font-size: 102.4%'>xampp(1)</a> <a href='/blog/categories/xml' style='font-size: 104.8%'>xml(2)</a> </span>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/actionbar'>actionbar (1)</a></li><li><a href='/blog/categories/android'>android (25)</a></li><li><a href='/blog/categories/apache'>apache (7)</a></li><li><a href='/blog/categories/bash'>bash (3)</a></li><li><a href='/blog/categories/best-practice'>best_practice (1)</a></li><li><a href='/blog/categories/book'>book (1)</a></li><li><a href='/blog/categories/broadcast-receiver'>broadcast_receiver (2)</a></li><li><a href='/blog/categories/cdi'>cdi (2)</a></li><li><a href='/blog/categories/centos'>centos (5)</a></li><li><a href='/blog/categories/clean-code'>clean code (1)</a></li><li><a href='/blog/categories/command'>command (4)</a></li><li><a href='/blog/categories/concurrency'>concurrency (1)</a></li><li><a href='/blog/categories/database'>database (6)</a></li><li><a href='/blog/categories/datetime'>datetime (1)</a></li><li><a href='/blog/categories/di'>di (2)</a></li><li><a href='/blog/categories/drawable'>drawable (1)</a></li><li><a href='/blog/categories/ec'>ec (1)</a></li><li><a href='/blog/categories/eclipse'>eclipse (1)</a></li><li><a href='/blog/categories/ecshop'>ecshop (7)</a></li><li><a href='/blog/categories/editor'>editor (1)</a></li><li><a href='/blog/categories/emulator'>emulator (1)</a></li><li><a href='/blog/categories/english'>english (14)</a></li><li><a href='/blog/categories/excel'>excel (2)</a></li><li><a href='/blog/categories/extjs'>extjs (2)</a></li><li><a href='/blog/categories/gesture'>gesture (1)</a></li><li><a href='/blog/categories/git'>git (4)</a></li><li><a href='/blog/categories/git-flow'>git-flow (1)</a></li><li><a href='/blog/categories/guava'>guava (2)</a></li><li><a href='/blog/categories/guice'>guice (1)</a></li><li><a href='/blog/categories/hamcrest'>hamcrest (1)</a></li><li><a href='/blog/categories/i18n'>i18n (1)</a></li><li><a href='/blog/categories/ide'>IDE (1)</a></li><li><a href='/blog/categories/idea'>IDEA (1)</a></li><li><a href='/blog/categories/injection'>injection (1)</a></li><li><a href='/blog/categories/intent'>intent (1)</a></li><li><a href='/blog/categories/ireport'>ireport (2)</a></li><li><a href='/blog/categories/jasterreport'>jasterreport (2)</a></li><li><a href='/blog/categories/java'>java (22)</a></li><li><a href='/blog/categories/java-ee'>java_ee (5)</a></li><li><a href='/blog/categories/jms'>jms (1)</a></li><li><a href='/blog/categories/joda'>joda (1)</a></li><li><a href='/blog/categories/jpa'>jpa (1)</a></li><li><a href='/blog/categories/jquery'>jquery (1)</a></li><li><a href='/blog/categories/jsp'>jsp (2)</a></li><li><a href='/blog/categories/junit'>junit (1)</a></li><li><a href='/blog/categories/jvm'>jvm (2)</a></li><li><a href='/blog/categories/kohana'>kohana (1)</a></li><li><a href='/blog/categories/l10n'>l10n (1)</a></li><li><a href='/blog/categories/layout'>layout (1)</a></li><li><a href='/blog/categories/linux'>linux (11)</a></li><li><a href='/blog/categories/listview'>listview (2)</a></li><li><a href='/blog/categories/logger'>logger (1)</a></li><li><a href='/blog/categories/m2eclilpse'>m2eclilpse (1)</a></li><li><a href='/blog/categories/mac'>mac (2)</a></li><li><a href='/blog/categories/mat'>mat (1)</a></li><li><a href='/blog/categories/maven'>maven (5)</a></li><li><a href='/blog/categories/memory'>memory (1)</a></li><li><a href='/blog/categories/menu'>menu (1)</a></li><li><a href='/blog/categories/mindmap'>mindmap (2)</a></li><li><a href='/blog/categories/misc'>misc (1)</a></li><li><a href='/blog/categories/mysql'>mysql (7)</a></li><li><a href='/blog/categories/nio'>nio (1)</a></li><li><a href='/blog/categories/octopress'>octopress (1)</a></li><li><a href='/blog/categories/oracle'>oracle (1)</a></li><li><a href='/blog/categories/osgi'>osgi (3)</a></li><li><a href='/blog/categories/pdf'>pdf (2)</a></li><li><a href='/blog/categories/pdt'>pdt (5)</a></li><li><a href='/blog/categories/pear'>pear (2)</a></li><li><a href='/blog/categories/performace'>performace (1)</a></li><li><a href='/blog/categories/pgsql'>pgsql (1)</a></li><li><a href='/blog/categories/php'>php (6)</a></li><li><a href='/blog/categories/play-framework'>play_framework (1)</a></li><li><a href='/blog/categories/pm'>pm (5)</a></li><li><a href='/blog/categories/postgresql'>postgresql (2)</a></li><li><a href='/blog/categories/profile'>profile (1)</a></li><li><a href='/blog/categories/programming'>programming (12)</a></li><li><a href='/blog/categories/re'>re (1)</a></li><li><a href='/blog/categories/refactory'>refactory (1)</a></li><li><a href='/blog/categories/rest'>rest (2)</a></li><li><a href='/blog/categories/roboguice'>roboguice (1)</a></li><li><a href='/blog/categories/sbt'>sbt (1)</a></li><li><a href='/blog/categories/scala'>scala (4)</a></li><li><a href='/blog/categories/security'>security (1)</a></li><li><a href='/blog/categories/service'>service (2)</a></li><li><a href='/blog/categories/shiro'>shiro (1)</a></li><li><a href='/blog/categories/shortchut'>shortchut (1)</a></li><li><a href='/blog/categories/smarty'>smarty (3)</a></li><li><a href='/blog/categories/spring'>spring (1)</a></li><li><a href='/blog/categories/sql'>sql (1)</a></li><li><a href='/blog/categories/style'>style (1)</a></li><li><a href='/blog/categories/tdd'>tdd (1)</a></li><li><a href='/blog/categories/testing'>testing (10)</a></li><li><a href='/blog/categories/theme'>theme (1)</a></li><li><a href='/blog/categories/tips'>tips (2)</a></li><li><a href='/blog/categories/ubuntu'>ubuntu (8)</a></li><li><a href='/blog/categories/ui'>ui (2)</a></li><li><a href='/blog/categories/vim'>vim (2)</a></li><li><a href='/blog/categories/web'>web (2)</a></li><li><a href='/blog/categories/windows'>windows (1)</a></li><li><a href='/blog/categories/xampp'>xampp (1)</a></li><li><a href='/blog/categories/xml'>xml (2)</a></li></ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Kent -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kentchiu';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
