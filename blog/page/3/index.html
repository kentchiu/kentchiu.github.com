
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Kent's Blog</title>
  <meta name="author" content="Kent">

  
  <meta name="description" content="柯里化(currying)是指把多個參數的單一function轉換成只使用單一參數多個functions，轉換的方式，是把參數折分後，將前一個function的執行結果傳入下一個function，
功能上的作用是讓每個function都只有一個參數，而實際上的運用是用來 1
2
3
4
5
6
7 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.kent-chiu.com/blog/page/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Kent's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39152849-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Kent's Blog</a></h1>
  
    <h2>Kent的學習筆記(剛從dokuwiki搬過來，內容還在整修中)</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.kent-chiu.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/21/currying/">Currying</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-21T00:00:00+08:00" pubdate data-updated="true">Jun 21<span>st</span>, 2012</time>
        
         | <a href="/blog/2012/06/21/currying/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>柯里化(currying)是指把多個參數的單一function轉換成只使用單一參數多個functions，轉換的方式，是把參數折分後，將前一個function的執行結果傳入下一個function，
功能上的作用是讓每個function都只有一個參數，而實際上的運用是用來</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// this code taken from http://www.codecommit.com/blog/scala/function-currying-in-scala
</span><span class='line'>def add(x:Int, y:Int) = x + y
</span><span class='line'> 
</span><span class='line'>add(1, 2)   // 3
</span><span class='line'>add(7, 3)   // 10
</span><span class='line'> 
</span><span class='line'>// currying版的
</span><span class='line'> 
</span><span class='line'>def add(x:Int) = (y:Int) =&gt; x + y
</span><span class='line'> 
</span><span class='line'>add(1)(2)   // 3
</span><span class='line'>add(7)(3)   // 10</span></code></pre></td></tr></table></div></figure>


<h5>以 x = 1, y =2為例</h5>

<p>第一個版本的add
function，是add接受兩個參數(x=1,y=2)，然後相加後得到結果3</p>

<p>第二個柯里化後的add function，是第一個function <code>add(x:Int)</code>,
add(1)執行後會傳回一個整數值1，然後執行的結果1當作輸入值傳到第二個function<code>(y:Int) ⇒ x + y</code>，
(這個是一個closure，因為他有一個free variable
<code>x</code>)，x=1(來自前一個function的執行結果),y=2可得執行結果為3</p>

<h3>The Power of Currying</h3>

<p>scala為什麼需要Currying這樣的語法?因為有了Currying可以讓程式更一般化(更抽象，更通用)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// this code taken from http://www.codecommit.com/blog/scala/function-currying-in-scala
</span><span class='line'> 
</span><span class='line'>def process[A](filter:A=&gt;Boolean)(list:List[A]):List[A] = {
</span><span class='line'>  lazy val recurse = process(filter) _
</span><span class='line'> 
</span><span class='line'>  list match {
</span><span class='line'>    case head::tail =&gt; if (filter(head)) {
</span><span class='line'>      head::recurse(tail)
</span><span class='line'>    } else {
</span><span class='line'>      recurse(tail)
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    case Nil =&gt; Nil
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>val even = (a:Int) =&gt; a % 2 == 0
</span><span class='line'> 
</span><span class='line'>val numbersAsc = 1::2::3::4::5::Nil
</span><span class='line'>val numbersDesc = 5::4::3::2::1::Nil
</span><span class='line'> 
</span><span class='line'>process(even)(numbersAsc)   // [2, 4]
</span><span class='line'>process(even)(numbersDesc)  // [4, 2]</span></code></pre></td></tr></table></div></figure>


<p>最後面的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>process(even)(numbersAsc)   // [2, 4]
</span><span class='line'>process(even)(numbersDesc)  // [4, 2]</span></code></pre></td></tr></table></div></figure>


<p><code>process(even)</code>像這樣的使用方式，如果一直在程式出現，在imperative
language(命令式語言 ex:java)中，我們通常會把這個透過extract
method的重構手法，把它抽出成一個獨立的method，
那在scala中，可以把<code>process(even)</code>變成Partially Applied
Functions(在此例中為<code>val processEvens = process(even) _</code>)，然後，直接使用processEvens會將原來<code>process(even)</code>變成Currying後的第一個
function的傳回值</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// this code taken from http://www.codecommit.com/blog/scala/function-currying-in-scala
</span><span class='line'> 
</span><span class='line'>val even = (a:Int) =&gt; a % 2 == 0
</span><span class='line'>val processEvens = process(even) _
</span><span class='line'> 
</span><span class='line'>val numbersAsc = 1::2::3::4::5::Nil
</span><span class='line'>val numbersDesc = 5::4::3::2::1::Nil
</span><span class='line'> 
</span><span class='line'>processEvens(numbersAsc)   // [2, 4]
</span><span class='line'>processEvens(numbersDesc)  // [4, 2]</span></code></pre></td></tr></table></div></figure>


<h1>Resources</h1>

<ul>
<li><a href="http://gleichmann.wordpress.com/2011/12/04/functional-scala-curried-functions-and-spicy-methods/" title="http://gleichmann.wordpress.com/2011/12/04/functional-scala-curried-functions-and-spicy-methods/">http://gleichmann.wordpress.com/2011/12/04/functional-scala-curried-functions-and-spicy-methods/</a></li>
<li><a href="http://www.codecommit.com/blog/scala/function-currying-in-scala" title="http://www.codecommit.com/blog/scala/function-currying-in-scala">http://www.codecommit.com/blog/scala/function-currying-in-scala</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/30/postgresql_101/">PostgreSQL 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-30T00:00:00+08:00" pubdate data-updated="true">May 30<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/05/30/postgresql_101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Command Line</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>psql -U username -W</span></code></pre></td></tr></table></div></figure>


<h1>Sequence (AUTO INCREMENT)</h1>

<p>PostgreSQL並沒有自增型欄位型態^<a href="#fn__1">1)</a><sup>AUTO
INCREMENT</sup>，但是有提供Sequence機制，這部份，與<a href="http://wiki.kent-chiu.com/doku.php?id=database:oracle_101#auto_increment" title="database:oracle_101">oracle</a>比較類似，但PostgreSQL可以透過建立table時的自訂語法來自動套用Sequence，讓其動作比較接近<strong>AUTO
INCREMENT</strong>的效果</p>

<h3>使用方式</h3>

<h5>讓table的某一column套用sequence</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE TABLE tablename (
</span><span class='line'>    colname SERIAL
</span><span class='line'>);</span></code></pre></td></tr></table></div></figure>


<p>上面的語法等效於</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE SEQUENCE tablename_colname_seq;
</span><span class='line'>CREATE TABLE tablename (
</span><span class='line'>    colname integer DEFAULT NEXTVAL('tablename_colname_seq') NOT NULL
</span><span class='line'>);</span></code></pre></td></tr></table></div></figure>


<h5>建立sequence</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>create sequence seq start 100;</span></code></pre></td></tr></table></div></figure>


<p>以上語法會建立一個名為<code>seq</code>的sequence，啟始值為100 (從100起跳)</p>

<h5>取得目前sequence的值</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select currval('seq');</span></code></pre></td></tr></table></div></figure>


<h5>取得下一個sequence的值</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select nextval('seq');</span></code></pre></td></tr></table></div></figure>


<h5>重新設定sequence值</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select setval('seq',9)</span></code></pre></td></tr></table></div></figure>


<h5>重新設定sequence值(建議)</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select setval('seq', max(id)) FROM myTable;</span></code></pre></td></tr></table></div></figure>


<h3>Drop all tables script</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* create a function for drop all tables */
</span><span class='line'>CREATE OR REPLACE FUNCTION drop_all_table() RETURNS SETOF RECORD   AS $$
</span><span class='line'>DECLARE
</span><span class='line'>  stmt RECORD;
</span><span class='line'>BEGIN
</span><span class='line'>    FOR stmt IN
</span><span class='line'>        /* select table */
</span><span class='line'>       SELECT c.relname FROM pg_catalog.pg_class AS c LEFT JOIN
</span><span class='line'>    pg_catalog.pg_namespace AS n ON n.oid = c.relnamespace WHERE relkind =
</span><span class='line'>    'r' AND n.nspname NOT IN ('pg_catalog', 'pg_toast') AND
</span><span class='line'>    pg_catalog.pg_table_is_visible(c.oid)
</span><span class='line'>     LOOP
</span><span class='line'>        /* drop table one by one */
</span><span class='line'>        EXECUTE 'drop table ' || quote_ident(stmt.relname) || ';';
</span><span class='line'>    END LOOP;
</span><span class='line'>END;
</span><span class='line'>$$ LANGUAGE plpgsql STRICT;
</span><span class='line'> 
</span><span class='line'>begin;
</span><span class='line'>/* execute the function */
</span><span class='line'>SELECT drop_all_table();
</span><span class='line'>commit;</span></code></pre></td></tr></table></div></figure>


<h3>Truncate all tables script</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* create a function for drop all tables */
</span><span class='line'>CREATE OR REPLACE FUNCTION truncate_all_table() RETURNS SETOF RECORD   AS $$
</span><span class='line'>DECLARE
</span><span class='line'>  stmt RECORD;
</span><span class='line'>BEGIN
</span><span class='line'>    FOR stmt IN
</span><span class='line'>        /* select table */
</span><span class='line'>       SELECT c.relname FROM pg_catalog.pg_class AS c LEFT JOIN
</span><span class='line'>    pg_catalog.pg_namespace AS n ON n.oid = c.relnamespace WHERE relkind =
</span><span class='line'>    'r' AND n.nspname NOT IN ('pg_catalog', 'pg_toast') AND
</span><span class='line'>    pg_catalog.pg_table_is_visible(c.oid)
</span><span class='line'>     LOOP
</span><span class='line'>        /* truncate table one by one */
</span><span class='line'>        EXECUTE 'truncate table ' || quote_ident(stmt.relname) || ';';
</span><span class='line'>    END LOOP;
</span><span class='line'>END;
</span><span class='line'>$$ LANGUAGE plpgsql STRICT;
</span><span class='line'> 
</span><span class='line'>begin;
</span><span class='line'>/* execute the function */
</span><span class='line'>SELECT  truncate_all_table();
</span><span class='line'>commit;</span></code></pre></td></tr></table></div></figure>


<p>如果遇到建立script時<code>language “plpgsql” does not exist</code>(通常在linux下才會),可透過createlang命令，安裝plpgsql到指定的db</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>createlang -d &lt;dbname&gt; plpgsql</span></code></pre></td></tr></table></div></figure>


<h1>建立全新的Database</h1>

<p>從完全沒有db開始建立的流程如下</p>

<ul>
<li>pgsql/bin/initdb.exe -D <em>path</em></li>
<li><em>path</em>pg_hba.conf
設定local可以不用密碼登入(暫時性的，等設定完成記得改回來)</li>
<li>用os的帳號登入新的db
(通常是administrator)，因為上面已設定不用密碼了，所以只要os的帳號即可登入</li>
<li>登入後再建立新的database跟user</li>
<li>把<em>path</em>pg_hba.conf改回需認證才能登入</li>
</ul>


<h1>管理</h1>

<h5>列出目前活動</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select * from pg_stat_activity ;
</span><span class='line'>
</span><span class='line'> datid | datname | procpid | usesysid | usename | current_query
</span><span class='line'>-------+---------+---------+----------+---------+---------------
</span><span class='line'> 16976 | simpydb |   31008 |      100 | otis    |
</span><span class='line'> 16976 | simpydb |   26126 |      100 | otis    |
</span><span class='line'>(2 rows)</span></code></pre></td></tr></table></div></figure>


<h1>Resource</h1>

<ul>
<li><a href="http://www.postgresql.org/docs/8.1/static/sql-createsequence.html" title="http://www.postgresql.org/docs/8.1/static/sql-createsequence.html">CREATE
SEQUENCE</a></li>
<li><a href="http://www.postgresql.org/docs/8.1/static/functions-sequence.html" title="http://www.postgresql.org/docs/8.1/static/functions-sequence.html">Sequence Manipulation
Functions</a></li>
<li><a href="http://www.postgresql.org/docs/8.0/interactive/datatype.html#DATATYPE-SERIAL" title="http://www.postgresql.org/docs/8.0/interactive/datatype.html#DATATYPE-SERIAL">PostgreSQL serial data
type</a></li>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=database:oracle_101" title="database:oracle_101">Oracle
101</a></li>
</ul>


<p>^<a href="#fnt__1">1)</a>^ 每次insert時會自動讓某一特定欄位+1</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/25/effective_java_item_list/">Effective Java Item List</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-25T00:00:00+08:00" pubdate data-updated="true">May 25<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/05/25/effective_java_item_list/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This item list come for <a href="http://java.sun.com/docs/books/effective/toc.html" title="http://java.sun.com/docs/books/effective/toc.html">Effective Java Second Edition</a></p>

<h1>Creating and Destroying Objects</h1>

<h4>Item 1: Consider static factory methods instead of constructors</h4>

<h4>Item 2: Consider a builder when faced with many constructor parameters</h4>

<h4>Item 3: Enforce the singleton property with a private constructor or an enum type</h4>

<h4>Item 4: Enforce noninstantiability with a private constructor</h4>

<h4>Item 5: Avoid creating unnecessary objects</h4>

<h4>Item 6: Eliminate obsolete object references</h4>

<h4>Item 7: Avoid finalizers</h4>

<h1>Methods Common to All Objects</h1>

<h4>Item 8: Obey the general contract when overriding equals</h4>

<h4>Item 9: Always override hashCode when you override equals</h4>

<h4>Item 10: Always override toString</h4>

<h4>Item 11: Override clone judiciously</h4>

<h4>Item 12: Consider implementing Comparable</h4>

<h1>Classes and Interfaces</h1>

<h4>Item 13: Minimize the accessibility of classes and members</h4>

<h4>Item 14: In public classes, use accessor methods, not public fields</h4>

<h4>Item 15: Minimize mutability</h4>

<h4>Item 16: Favor composition over inheritance</h4>

<h4>Item 17: Design and document for inheritance or else prohibit it</h4>

<h4>Item 18: Prefer interfaces to abstract classes</h4>

<h4>Item 19: Use interfaces only to define types</h4>

<h4>Item 20: Prefer class hierarchies to tagged classes</h4>

<h4>Item 21: Use function objects to represent strategies</h4>

<h4>Item 22: Favor static member classes over nonstatic</h4>

<p>除非member classes有存取到outter class的nonstatic
method，不然，應該把member classes宣告為statics</p>

<h1>Generics</h1>

<h4>Item 23: Don&#8217;t use raw types in new code</h4>

<h4>Item 24: Eliminate unchecked warnings</h4>

<h4>Item 25: Prefer lists to arrays</h4>

<h4>Item 26: Favor generic types</h4>

<h4>Item 27: Favor generic methods</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Generic method
</span><span class='line'>public static &lt;E&gt;Set&lt;E&gt;union(Set&lt;E&gt;s1, Set&lt;E&gt;s2) {
</span><span class='line'>    Set&lt;E&gt;result = new HashSet&lt;E&gt;(s1);
</span><span class='line'>    result.addAll(s2);
</span><span class='line'>    return result;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>Item 28: Use bounded wildcards to increase API flexibility</h4>

<h4>Item 29: Consider typesafe heterogeneous containers</h4>

<p>利用加上Class&lt;T>來確定T的型別</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Typesafe heterogeneous container pattern - API
</span><span class='line'>public class Favorites {
</span><span class='line'>public &lt;T&gt; void putFavorite(Class&lt;T&gt; type, T instance);
</span><span class='line'>public &lt;T&gt; T getFavorite(Class&lt;T&gt; type);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h1>Enums and Annotations</h1>

<h4>Item 30: Use enums instead of int constants</h4>

<h4>Item 31: Use instance fields instead of ordinals</h4>

<h4>Item 32: Use EnumSet instead of bit fields</h4>

<p>如果要用位元開關的效果，可以考慮用EnumSet</p>

<h4>Item 33: Use EnumMap instead of ordinal indexing</h4>

<p>如果需要對Enum進行排序，可以用EnumMap</p>

<h4>Item 34: Emulate extensible enums with interfaces</h4>

<p>Enum是無法繼承的，如果需要類似的功能，可以考慮用interfaces</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Emulated extensible enum using an interface
</span><span class='line'>public interface Operation {
</span><span class='line'>    double apply(double x, double y);
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>public enum BasicOperation implements Operation {
</span><span class='line'>    PLUS("+") {
</span><span class='line'>        public double apply(double x, double y) {
</span><span class='line'>            return x + y;
</span><span class='line'>        }
</span><span class='line'>    },
</span><span class='line'>    MINUS("-") {
</span><span class='line'>        public double apply(double x, double y) {
</span><span class='line'>            return x - y;
</span><span class='line'>        }
</span><span class='line'>    },
</span><span class='line'>    TIMES("*") {
</span><span class='line'>        public double apply(double x, double y) {
</span><span class='line'>            return x * y;
</span><span class='line'>        }
</span><span class='line'>    },
</span><span class='line'>    DIVIDE("/") {
</span><span class='line'>        public double apply(double x, double y) {
</span><span class='line'>            return x / y;
</span><span class='line'>        }
</span><span class='line'> 
</span><span class='line'>        private final String  symbol;
</span><span class='line'> 
</span><span class='line'>        BasicOperation(String symbol) {
</span><span class='line'>            this.symbol = symbol;
</span><span class='line'>        }
</span><span class='line'> 
</span><span class='line'>        @Override
</span><span class='line'>        public String toString() {
</span><span class='line'>            return symbol;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>};
</span><span class='line'> 
</span><span class='line'>// Emulated extension enum
</span><span class='line'>public enum ExtendedOperation implements Operation {
</span><span class='line'>    EXP("^") {
</span><span class='line'>        public double apply(double x, double y) {
</span><span class='line'>            return Math.pow(x, y);
</span><span class='line'>        }
</span><span class='line'>    },
</span><span class='line'>    REMAINDER("%") {
</span><span class='line'>        public double apply(double x, double y) {
</span><span class='line'>            return x % y;
</span><span class='line'>        }
</span><span class='line'>    };
</span><span class='line'>    private final String  symbol;
</span><span class='line'> 
</span><span class='line'>    ExtendedOperation(String symbol) {
</span><span class='line'>        this.symbol = symbol;
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    @Override
</span><span class='line'>    public String toString() {
</span><span class='line'>        return symbol;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>Item 35: Prefer annotations to naming patterns</h4>

<p>只要想到要用method
name的rule做判斷邏輯時，可以考慮用annotations或許會更彈性</p>

<h4>Item 36: Consistently use the Override annotation</h4>

<h4>Item 37: Use marker interfaces to define types</h4>

<h1>Methods</h1>

<h4>Item 38: Check parameters for validity</h4>

<h4>Item 39: Make defensive copies when needed</h4>

<h4>Item 40: Design method signatures carefully</h4>

<h4>Item 41: Use overloading judiciously</h4>

<h4>Item 42: Use varargs judiciously</h4>

<h4>Item 43: Return empty arrays or collections, not nulls</h4>

<h4>Item 44: Write doc comments for all exposed API elements</h4>

<h1>General Programming</h1>

<h4>Item 45: Minimize the scope of local variables</h4>

<h4>Item 46: Prefer for-each loops to traditional for loops</h4>

<h4>Item 47: Know and use the libraries</h4>

<h4>Item 48: Avoid float and double if exact answers are required</h4>

<h4>Item 49: Prefer primitive types to boxed primitives</h4>

<h4>Item 50: Avoid strings where other types are more appropriate</h4>

<h4>Item 51: Beware the performance of string concatenation</h4>

<h4>Item 52: Refer to objects by their interfaces</h4>

<h4>Item 53: Prefer interfaces to reflection</h4>

<h4>Item 54: Use native methods judiciously</h4>

<h4>Item 55: Optimize judiciously</h4>

<h4>Item 56: Adhere to generally accepted naming conventions</h4>

<h1>Exceptions</h1>

<h4>Item 57: Use exceptions only for exceptional conditions</h4>

<h4>Item 58: Use checked exceptions for recoverable conditions and runtime exceptions for programming errors</h4>

<p>checked exceptions應該是來被rescue的，只有能被復原的狀況，才用check
exception</p>

<h4>Item 59: Avoid unnecessary use of checked exceptions</h4>

<h4>Item 60: Favor the use of standard exceptions</h4>

<h4>Item 61: Throw exceptions appropriate to the abstraction</h4>

<h4>Item 62: Document all exceptions thrown by each method</h4>

<h4>Item 63: Include failure-capture information in detail messages</h4>

<h4>Item 64: Strive for failure atomicity</h4>

<h4>Item 65: Don&#8217;t ignore exceptions</h4>

<h1>Concurrency</h1>

<h4>Item 66: Synchronize access to shared mutable data</h4>

<h4>Item 67: Avoid excessive synchronization</h4>

<h4>Item 68: Prefer executors and tasks to threads</h4>

<h4>Item 69: Prefer concurrency utilities to wait and notify</h4>

<h4>Item 70: Document thread safety</h4>

<h4>Item 71: Use lazy initialization judiciously</h4>

<h4>Item 72: Don&#8217;t depend on the thread scheduler</h4>

<h4>Item 73: Avoid thread groups</h4>

<h1>Serialization</h1>

<h4>Item 74: Implement Serializable judiciously</h4>

<h4>Item 75: Consider using a custom serialized form</h4>

<h4>Item 76: Write readObject methods defensively</h4>

<h4>Item 77: For instance control, prefer enum types to readResolve</h4>

<h4>Item 78: Consider serialization proxies instead of serialized instances</h4>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/14/tips_and_tricks/">Android Tips & Tricks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-14T00:00:00+08:00" pubdate data-updated="true">May 14<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/05/14/tips_and_tricks/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>WebView</h3>

<h5>讓WebView的內容符合手機的畫面</h5>

<p>webview常常需要去存取現在的網頁，但大部份的網頁沒有針對moible特別做處理，所以用手機去瀏灠網頁時(透過webview)，通常需要左右的捲動才要辦法看到完整的內容。
解決的方式為</p>

<pre><code>WebView webview = new WebView(getContext());
webview.getSettings().setLoadWithOverviewMode(true);
webview.getSettings().setUseWideViewPort(true);
</code></pre>

<h5>防止webview開成新的瀏灠器</h5>

<p>通常採用webview時，會希望webview
embbeded在客制的APP裡面，但預設的webview開啟url時，會開啟成新的完整的瀏灠器(含url
bar)，可以透過以下的code來防止這個行為。</p>

<pre><code>WebView webview = new WebView(getContext());
webview.setWebViewClient(new WebViewClient());
</code></pre>

<h5>防止Rotate後webview reload</h5>

<p>手機在直放改成橫放(或橫放改直放)時，activity會呼叫onCreate()重新建立activity，如果activity裡面webview元件，會造成weview的內容消失。
，可以在AndroidManifest.xml加入如下的設定來避免這種情現</p>

<pre><code>    &lt;activity android:name=".MyActivity" 
              android:label="@string/app_name" 
              android:configChanges="orientation|keyboard|keyboardHidden"&gt; 
</code></pre>

<h3>Storage</h3>

<h5>Internal Memory</h5>

<pre><code>Context.getFilesDir: /data/data/package_name/files
Context.getDir: /data/data/package_name/app_
Context.getCacheDir(): /data/data/package_name/cache
Environment.getDataDirectory(): /data
Environment.getDownloadCacheDirectory(): /cache
</code></pre>

<h5>SDCard</h5>

<pre><code>Environment.getExternalStoragePublicDirectory(): /mnt/sdcard
</code></pre>

<h3>Activity</h3>

<h4>Launch Mode</h4>

<p>Activity Launch Mode是<a href="http://developer.android.com/guide/topics/fundamentals/tasks-and-back-stack.html" title="http://developer.android.com/guide/topics/fundamentals/tasks-and-back-stack.html">current
task</a>怎麼去啟動的Activity的方式。
可以透過manifest或programming的方式來設定，但有些設定值，只有manifest有提供，沒辦法在runtime設定。</p>

<ol>
<li>standard
預設模組，一個activity可以有多個實體，每個實體分屬不同的task，一個task內也可存在多個實體</li>
<li>singleTop
如果有四個activies啟動在task內是<code>A→B→C→D</code>，D在最上面，一般模式下再啟動一次D會變<code>A→B→C→D→D</code>，但如果D是singleTop，不論啟動多少次D，都只會是<code>A→B→C→D</code></li>
<li>singleTask
如果不存在任何task中時，會建新另一個新的task，如果存在task中時，會呼叫其他task中的activity，並讓它成為top</li>
<li>singleInstance
永遠會建立最新的，但如果目前該activity已經是top，那就不會再建立</li>
</ol>


<h4>Handling Runtime Changes</h4>

<p>手機翻轉時，會重建整個Activity以便loading最新的配置內容，但有時，我們會希望可以保持Activity的部份狀態，要達到這個目的，可以透以下幾種機制</p>

<ol>
<li>透過 onSaveInstanceState()</li>
<li>透過 onRetainNonConfigurationInstance()</li>
<li>透過修改配置檔disable掉config change的事件</li>
</ol>


<h5>透過 onSaveInstanceState</h5>

<p>這個方式適用到保持可以序列化的值，像原生型別(數值，字串…)
主要是在onSaveInstanceState()被觸發時，把狀態保持在Intent，然後再onCreate()取得原本的狀態</p>

<h5>透過 onRetainNonConfigurationInstance</h5>

<p>onSaveInstanceState會有一個明顯的限制，就是不能處理太複雜或太大的資料，因為會做序列化，不但耗時，而且會佔不少記憶體空間。
如果要保留比較複雜的資料，可以透過onRetainNonConfigurationInstance()把物件的reference
hold住，之後，可以下次activity
restart時，透過getLastNonConfigurationInstance()取出</p>

<pre><code>@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);
 
    final MyDataObject data = (MyDataObject) getLastNonConfigurationInstance();
    if (data == null) {
        data = loadMyData();
    }
    ...
}
</code></pre>

<p>要被hold住的物件不能跟context有任何關係，不然不旦會造成錯誤，還會造成memory
leaking</p>

<h5>透過修改配置檔disable掉config change的事件</h5>

<p>這種方式，是直接告訴activty要忽略某些configuration change</p>

<pre><code>&lt;activity
 android:configChanges="orientation|keyboardHidden"
</code></pre>

<p>一個簡單的翻轉動作，可能同時會觸發多次onConfigurationChanged()，所以，要把相關的設定都關掉，才不會有問題</p>

<h3>List View</h3>

<h5>下拉後更新 (Pull to refresh)</h5>

<p>在許多listview的應用裡可以見到這樣的應用</p>

<p><img src="https://raw.github.com/johannilsson/android-pulltorefresh/master/android-pull-to-refresh.png" alt="android-pull-to-refresh.png" /></p>

<p>這個效果的做法的基本原理，是在listview的header放一個layout，在偵測到listview的scroll事件後，讓layout進行動畫播放，再callback一個AsyncTask去取得資料再更新listview。</p>

<p>GitHub上有兩個這樣的library可用</p>

<ol>
<li><a href="https://github.com/johannilsson/android-pulltorefresh" title="https://github.com/johannilsson/android-pulltorefresh">https://github.com/johannilsson/android-pulltorefresh</a>

<ul>
<li>基本的list view pull to refresh</li>
</ul>
</li>
<li><a href="https://github.com/chrisbanes/Android-PullToRefresh" title="https://github.com/chrisbanes/Android-PullToRefresh">https://github.com/chrisbanes/Android-PullToRefresh</a>

<ul>
<li>這個專案目前比較活躍，另外也提供WebView, GridView,
PullToRefreshExpandableListView的下拉後更新，程式結構也比較清晰</li>
</ul>
</li>
</ol>


<h3>TextEdit</h3>

<h5>讓edit text不會一開始就彈出軟體鍵盤</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;activity android:name="MyActivity"
</span><span class='line'>          android:windowSoftInputMode="adjustUnspecified|stateHidden"
</span><span class='line'>          android:configChanges="orientation|keyboardHidden"/&gt;</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/05/jvm_profile/">JVM 記憶體調校</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-05T00:00:00+08:00" pubdate data-updated="true">May 5<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/05/05/jvm_profile/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>JVM記憶體相關參數</h4>

<ul>
<li>Xmx                        : 記憶體使用上限</li>
<li>Xms                        : 記憶體使用下限(啟始值)</li>
<li>Xss                        : stack</li>
<li>server                     :</li>
<li>client                     :</li>
<li>XX:PermSize                : Perm for Permanent:編譯後的class，或固定的資料結構會佔用這一個值</li>
<li>XX:MaxGCPauseMillis        : GC暫停的毫秒數，這個只是&#8221;建議&#8221;GC而已，GC會儘量滿足這個建議值</li>
<li>XX:+ScavengeBeforeFullGC   :</li>
<li>XX:-UseParallelOldGC       :</li>
<li>XX:NewRatio                : sets the size of the old generation to three times the size of the new generation</li>
</ul>


<p>![jvm_profile_01.jpg][jvm_profile_01.jpg]</p>

<p>圖片來源 :<a href="http://redstack.wordpress.com/">Red Stack&#8217;s Blog</a></p>

<p>GC就是在空間不足時，將不活躍的物件從記憶體中移除，如果在GC時存活下的物件，就可能很上晉昇(Young
→ Old → Permanent)</p>

<ol>
<li>Permanent Generation:Old Generation進行GC(major GC or full
GC)後，如空間不夠，就會將Old
Generation活躍的物件(未被GC的)移到這區。建立越多的物件，此區域就要越大</li>
<li>Old Generation: 當Young Generation進行gc (minor
GC)後，空間仍舊不夠放新建立的物件時，會將Young Generation移到Old
Generation</li>
<li>New(Young) Generation():

<ol>
<li>to: Survivor space1(S1)
gc時,會將eden區未被gc的物件COPY到S1或S2區</li>
<li>from: Survivor space2(S2)
gc時,會將eden區未被gc的物件COPY到S1或S2區</li>
<li>eden: (伊甸) 看名字就知道是新生命(New
Object)誕生的地方,每new一個Object時會佔用這個區域，eden滿了，會引發gc
(minor GC)</li>
</ol>
</li>
</ol>


<p>Heap= Old Generation + New Generation</p>

<p>可以透過JDK內附的virtualVm來觀察jvm memory的使用情形</p>

<p><img src="/images/wiki/java/jvm_profile_02.png" alt="jvm_profile_02.png" /></p>

<h3>常用工具</h3>

<ol>
<li>jinfo</li>
<li>jmap</li>
<li>jstack</li>
<li>jstat</li>
<li>java.lang.management (API level)</li>
</ol>


<h2>Resources</h2>

<ul>
<li><a href="http://redstack.wordpress.com/2011/01/06/visualising-garbage-collection-in-the-jvm/" title="http://redstack.wordpress.com/2011/01/06/visualising-garbage-collection-in-the-jvm/">簡單而清楚的JVM
Memory教學</a></li>
<li><a href="http://www.infoq.com/cn/articles/cf-java-garbage-references" title="http://www.infoq.com/cn/articles/cf-java-garbage-references">infoQ中國站關於gc的文章(簡體中文)</a></li>
<li><a href="http://java.sun.com/docs/hotspot/gc/" title="http://java.sun.com/docs/hotspot/gc/">http://java.sun.com/docs/hotspot/gc/</a></li>
<li><a href="http://javarevisited.blogspot.com/2011/11/hotspot-jvm-options-java-examples.html" title="http://javarevisited.blogspot.com/2011/11/hotspot-jvm-options-java-examples.html">10 jvm options java developers should
know</a></li>
<li><a href="http://eclipse.org/mat/" title="http://eclipse.org/mat/">Eclipse MAT</a> -
這個比virtualVM更好用</li>
<li><a href="http://kohlerm.blogspot.com/2009/07/eclipse-memory-analyzer-10-useful.html" title="http://kohlerm.blogspot.com/2009/07/eclipse-memory-analyzer-10-useful.html">Eclipse
MAT使用的文章</a></li>
<li><a href="http://www.cubrid.org/blog/dev-platform/understanding-java-garbage-collection/" title="http://www.cubrid.org/blog/dev-platform/understanding-java-garbage-collection/">GC</a>

<ul>
<li>說明GC的機制及時機，有5種gc策略的說明</li>
</ul>
</li>
<li><a href="http://www.cubrid.org/blog/dev-platform/how-to-monitor-java-garbage-collection/" title="http://www.cubrid.org/blog/dev-platform/how-to-monitor-java-garbage-collection/">如何監控GC的教學</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/30/google_guava_101/">Google Guava 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-30T00:00:00+08:00" pubdate data-updated="true">Apr 30<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/04/30/google_guava_101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Guava是google的一個開源項目，目的在提供常用工具類的API，字串處理，caching，primitives型別處理，I/O，併行(concurrnecy)處理，
還有超級好用的Collections處理。</p>

<p>本篇主要著重於<a href="http://wiki.kent-chiu.com/doku.php?id=java:google_guava_-_collection_101" title="java:google_guava_-_collection_101">Collection</a>以外相關的使用介紹，Collection的使用介紹在<a href="http://wiki.kent-chiu.com/doku.php?id=java:google_guava_-_collection_101" title="java:google_guava_-_collection_101">另一篇</a></p>

<ol>
<li><p><a href="#strings" title="java:google_guava_101 ↵">Strings</a></p>

<ol>
<li><a href="#joiner" title="java:google_guava_101 ↵">Joiner</a></li>
<li><a href="#splitter" title="java:google_guava_101 ↵">Splitter</a></li>
<li><a href="#charmatcher" title="java:google_guava_101 ↵">CharMatcher</a></li>
</ol>
</li>
<li><p><a href="#basic_utilities" title="java:google_guava_101 ↵">Basic Utilities</a></p></li>
<li><a href="#caches" title="java:google_guava_101 ↵">Caches</a></li>
<li><a href="#concurrency" title="java:google_guava_101 ↵">Concurrency</a></li>
<li><a href="#primitives" title="java:google_guava_101 ↵">Primitives</a></li>
<li><a href="#ranges" title="java:google_guava_101 ↵">Ranges</a></li>
<li><a href="#hashing" title="java:google_guava_101 ↵">Hashing</a></li>
<li><a href="#eventbus" title="java:google_guava_101 ↵">EventBus</a></li>
<li><a href="#math" title="java:google_guava_101 ↵">Math</a></li>
</ol>


<h1>Strings</h1>

<ul>
<li><a href="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/CaseFormat.html" title="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/CaseFormat.html">CaseFormat</a></li>
<li><a href="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/CharMatcher.html" title="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/CharMatcher.html">CharMatcher</a></li>
<li><a href="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Charsets.html" title="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Charsets.html">Charsets</a></li>
<li><a href="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Joiner.html" title="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Joiner.html">Joiner</a></li>
<li><a href="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Splitter.html" title="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Splitter.html">Splitter</a></li>
<li><a href="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Strings.html" title="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Strings.html">Strings</a></li>
</ul>


<h5>CharMatcher</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CharMatcher.is('.').replaceFrom(aStr, '_');                                       // 將字串中的'.'換成'_'
</span><span class='line'>CharMatcher.DIGIT.matchesAllOf("1231212");                                        // true
</span><span class='line'>CharMatcher.DIGIT.matchesAnyOf("1231 aa212");                                     // true
</span><span class='line'>CharMatcher.DIGIT.retainFrom("Hello 1234 567");                                   // "1234567";
</span><span class='line'>CharMatcher.DIGIT.or(CharMatcher.WHITESPACE).retainFrom("Hello 1234 567");        // " 1234 567"
</span><span class='line'>CharMatcher.inRange('3', '6').removeFrom("Hello 1234 567");                       // "Hello 12 7";
</span><span class='line'>CharMatcher.is('$').trimFrom("$$$ This is a $ sign $$$");                         // " This is a $ sign "
</span><span class='line'>CharMatcher.is('$').or(CharMatcher.is(' ')).trimFrom("$$$ This is a $ sign $$$"); // "This is a $ sign"</span></code></pre></td></tr></table></div></figure>


<h5>Joiner</h5>

<p>字串相加</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Joiner joiner = Joiner.on("; ").skipNulls();
</span><span class='line'>return joiner.join("Harry", null, "Ron", "Hermione"); // "Harry; Ron; Hermione"
</span><span class='line'> 
</span><span class='line'>numbersWords.put(1, "one");
</span><span class='line'>numbersWords.put(2, "two");
</span><span class='line'>numbersWords.put(3, null);
</span><span class='line'>numbersWords.put(4, "four");
</span><span class='line'>Joiner.on(" | ").withKeyValueSeparator(" -&gt; ")
</span><span class='line'>    .useForNull("Unknown").join(numbersWords)); // 1 -&gt; one | 2 -&gt; two | 3 -&gt; Unknown | 4 -&gt; four"</span></code></pre></td></tr></table></div></figure>


<h5>Splitter</h5>

<p>字串分割</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Splitter.on(',')
</span><span class='line'>       .trimResults()
</span><span class='line'>       .omitEmptyStrings()
</span><span class='line'>       .split("foo,bar,,   qux");</span></code></pre></td></tr></table></div></figure>


<h1>Basic Utilities</h1>

<h3>Optional (Null處理)</h3>

<p>java對null的處理不是很友善，所以常常需要去對null值特別處理，而Optional就是用來處理null問題的利器。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// 是否是常看到這樣的code
</span><span class='line'>if (foo == null) {
</span><span class='line'>  // do something
</span><span class='line'>} else {
</span><span class='line'>  // do something
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>// servlet總會遇到這個
</span><span class='line'>String username;
</span><span class='line'>if (request.getParameter("username") == null) {
</span><span class='line'>    username = "Stranger";
</span><span class='line'>} else {
</span><span class='line'>   username = request.getParameter("username");
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>// 或者
</span><span class='line'>String username = request.getParameter("username") == null ? "Stranger" : request.getParameter("username");</span></code></pre></td></tr></table></div></figure>


<p>如果改用Optional的話</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Optional.of(request.getParameter("username")).or("default");</span></code></pre></td></tr></table></div></figure>


<p>這個class我個人滿少用的，它的一些延伸用法不是很直覺</p>

<h3>Preconditions</h3>

<p>前置條件檢查，通常會在在method的最前面，用來保證參數或變數在一定的狀態，如果不在預期的狀況，就拋出異常。</p>

<ol>
<li>checkArgument(boolean) : 用來檢查method的參數，不為true則拋出
IllegalArgumentException</li>
<li>checkNotNull(T) : 如果是 null 拋出 NullPointerException</li>
<li>checkState(boolean) :
跟checkArgument(boolean)很像，但用來檢查非參數的變數，如果不為true，拋出
IllegalStateException</li>
<li>checkElementIndex(int index, int size) :
用來檢查List,Array或字串index的合法性，不合法就拋出
IndexOutOfBoundsException</li>
<li>checkPositionIndex(int index, int size) :
用來檢查List,Array或字串index的合法性，不合法就拋出
IndexOutOfBoundsException</li>
<li>checkPositionIndexes(int start, int end, int size) :
用來檢查List,Array或字串index的合法性，不合法就拋出
IndexOutOfBoundsException</li>
</ol>


<p>checkElementIndex,checkPositionIndex,checkPositionIndexes用法比較特別，它不需要傳入List,Array或字串本身，只需傳入List,Array或字串的index，size，或start，end</p>

<h3>Ordering</h3>

<p>排序用，如果要被排序的元素本身已有<a href="http://wiki.kent-chiu.com/doku.php?id=java:google_guava_101" title="java:google_guava_101">Comparator</a>的話，可以直做透過Ordering做排序,
如果沒有，也可以extends Ordering達到排序的效果。</p>

<h3>Object methods</h3>

<p>傳統的Comparable實作方式很煩人，而且容易出錯</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Person implements Comparable&lt;Person&gt; {
</span><span class='line'>  private String lastName;
</span><span class='line'>  private String firstName;
</span><span class='line'>  private int zipCode;
</span><span class='line'> 
</span><span class='line'>  public int compareTo(Person other) {
</span><span class='line'>    int cmp = lastName.compareTo(other.lastName);
</span><span class='line'>    if (cmp != 0) {
</span><span class='line'>      return cmp;
</span><span class='line'>    }
</span><span class='line'>    cmp = firstName.compareTo(other.firstName);
</span><span class='line'>    if (cmp != 0) {
</span><span class='line'>      return cmp;
</span><span class='line'>    }
</span><span class='line'>    return Integer.compare(zipCode, other.zipCode);
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Guava提供ComparisonChain簡化Comparable.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   public int compareTo(Foo that) {
</span><span class='line'>     return ComparisonChain.start()
</span><span class='line'>         .compare(this.aString, that.aString)
</span><span class='line'>         .compare(this.anInt, that.anInt)
</span><span class='line'>         .compare(this.anEnum, that.anEnum, Ordering.natural().nullsLast())
</span><span class='line'>         .result();
</span><span class='line'>   }</span></code></pre></td></tr></table></div></figure>


<h3>Throwables</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> try {
</span><span class='line'>     someMethodThatCouldThrowAnything();
</span><span class='line'>   } catch (IKnowWhatToDoWithThisException e) {
</span><span class='line'>     handle(e);
</span><span class='line'>   } catch (Throwable t) {
</span><span class='line'>     Throwables.propagateIfInstanceOf(t, IOException.class);
</span><span class='line'>     Throwables.propagateIfInstanceOf(t, SQLException.class);
</span><span class='line'>     throw Throwables.propagate(t);
</span><span class='line'>   }</span></code></pre></td></tr></table></div></figure>


<h1>Caches</h1>

<p>Guava Cache很像Map，但在使用上跟行為上還是跟Map有許多不同之類。Guava
Cache只會暫存在Memory(RAM)，不會儲存 在local file system.</p>

<p>建立cache有兩種方式，一種是一開始就load所需要的資料，另一種是如果資料不存在就建立，否則就直接取cache內的資料</p>

<h5>CacheLoader是在開始時就建立好cache的資料</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>LoadingCache&lt;Key, Graph&gt; graphs = CacheBuilder.newBuilder()
</span><span class='line'>        .maximumSize(10000)
</span><span class='line'>        .expireAfterWrite(10, TimeUnit.MINUTES)
</span><span class='line'>        .removalListener(MY_LISTENER)
</span><span class='line'>        .build(
</span><span class='line'>            new CacheLoader&lt;Key, Graph&gt;() {
</span><span class='line'>                public Graph load(Key key) throws AnyException {
</span><span class='line'>                return createExpensiveGraph(key);
</span><span class='line'>            }
</span><span class='line'>        });</span></code></pre></td></tr></table></div></figure>


<h5>Callable是取不到資料時就建立cache</h5>

<p>當執行cache.get，如果有cache就會從cache取，如果沒有cache就會建立一份到cache中</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Cache&lt;Key, Value&gt; cache = CacheBuilder.newBuilder()
</span><span class='line'>    .maximumSize(1000)
</span><span class='line'>    .build(); // look Ma, no CacheLoader
</span><span class='line'>...
</span><span class='line'>try {
</span><span class='line'>  // If the key wasn't in the "easy to compute" group, we need to
</span><span class='line'>  // do things the hard way.
</span><span class='line'>  cache.get(key, new Callable&lt;Value&gt;() {
</span><span class='line'>    @Override
</span><span class='line'>    public Value call() throws AnyException {
</span><span class='line'>      return doThingsTheHardWay(key);
</span><span class='line'>    }
</span><span class='line'>  };
</span><span class='line'>} catch (ExecutionException e) {
</span><span class='line'>  throw new OtherException(e.getCause());
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h1>Concurrency</h1>

<p>ListenableFuture Service Using Implementations Monitor</p>

<h1>Primitives</h1>

<p>Primitive arrays General utilities Byte conversion Unsigned support</p>

<h1>Ranges</h1>

<p>用來處理一個範圍內class，主要是透過<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Comparable.html" title="http://docs.oracle.com/javase/7/docs/api/java/lang/Comparable.html">Comparable</a>來做範圍的運算，
所以不一定是要數值型的class才能做Range，像有實作Comparable的日期也是可以做範圍處理。</p>

<p>可透過Ranges類別來建立Range</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Ranges.closed(1,10);</span></code></pre></td></tr></table></div></figure>


<h1>EventBus</h1>

<p>EventBus是guava的事件處理，但不像傳統的Event-Listener那樣需要implement
xxxListener那樣(結果就是產生了一堆inner class或anonymous inner class)
而是透過@Annotation的方式處理。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Class is typically registered by the container.
</span><span class='line'>class EventBusChangeRecorder {
</span><span class='line'>  @Subscribe void recordCustomerChange(ChangeEvent e) {
</span><span class='line'>    recordChange(e.getChange());
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>// somewhere during initialization
</span><span class='line'>eventBus.register(new EventBusChangeRecorder());
</span><span class='line'>// much later
</span><span class='line'>public void changeCustomer() {
</span><span class='line'>  ChangeEvent event = getChangeEvent();
</span><span class='line'>  eventBus.post(event);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>Reference</h4>

<ol>
<li><a href="http://codingjunkie.net/guava-eventbus/" title="http://codingjunkie.net/guava-eventbus/">http://codingjunkie.net/guava-eventbus/</a></li>
<li><a href="http://tomaszdziurko.pl/2012/01/google-guava-eventbus-easy-elegant-publisher-subscriber-cases/" title="http://tomaszdziurko.pl/2012/01/google-guava-eventbus-easy-elegant-publisher-subscriber-cases/">http://tomaszdziurko.pl/2012/01/google-guava-eventbus-easy-elegant-publisher-subscriber-cases/</a></li>
</ol>


<h1>Math</h1>

<p>TBD</p>

<h1>Resources</h1>

<ul>
<li><a href="http://code.google.com/p/guava-libraries/" title="http://code.google.com/p/guava-libraries/">Guava
Home</a></li>
<li><a href="http://code.google.com/p/guava-libraries/wiki/ExplainedContents" title="http://code.google.com/p/guava-libraries/wiki/ExplainedContents">各功能的使用介紹</a>
(推薦)</li>
<li><a href="http://jnb.ociweb.com/jnb/jnbApr2010.html" title="http://jnb.ociweb.com/jnb/jnbApr2010.html">Examples</a></li>
<li><a href="http://jnb.ociweb.com/jnb/jnbFeb2009.html" title="http://jnb.ociweb.com/jnb/jnbFeb2009.html">Google
Collections</a></li>
<li><a href="http://www.copperykeenclaws.com/googles-guava-java-the-easy-parts/" title="http://www.copperykeenclaws.com/googles-guava-java-the-easy-parts/">Google’s guava java: the easy
parts</a></li>
<li><a href="http://stackoverflow.com/questions/tagged/guava" title="http://stackoverflow.com/questions/tagged/guava">guava on
stackoverflow</a></li>
<li>Using the Google Collections Library for Java
<a href="http://www.youtube.com/watch?v=ZeO_J2OcHYM" title="http://www.youtube.com/watch?v=ZeO_J2OcHYM">part1</a>
<a href="http://www.youtube.com/watch?v=9ni_KEkHfto" title="http://www.youtube.com/watch?v=9ni_KEkHfto">part2</a></li>
<li>带你领略 Google Collections <a href="http://jubin2002.javaeye.com/blog/471661" title="http://jubin2002.javaeye.com/blog/471661">part
1</a>
<a href="http://jubin2002.javaeye.com/blog/471698" title="http://jubin2002.javaeye.com/blog/471698">part
2</a></li>
<li>MapMaker Usage
<a href="http://norther.javaeye.com/blog/670414" title="http://norther.javaeye.com/blog/670414">http://norther.javaeye.com/blog/670414</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/java/j-lo-googlecollection/index.html?ca=drs-" title="http://www.ibm.com/developerworks/cn/java/j-lo-googlecollection/index.html?ca=drs-">Google Guava Collections
使用介绍</a>

<ul>
<li>IBM 中國上介紹guava的文章</li>
</ul>
</li>
<li><a href="http://www.tfnico.com/presentations/google-guava" title="http://www.tfnico.com/presentations/google-guava">一些guava使用上的介紹</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/26/vim/">VIM</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-26T00:00:00+08:00" pubdate data-updated="true">Apr 26<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/04/26/vim/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=vim:vim_101" title="vim:vim_101">Vim 101</a></li>
<li><a href="http://wiki.kent-chiu.com/doku.php?id=vim:vim_for_phper" title="vim:vim_for_phper">VIM for  PHPer</a></li>
<li><a href="http://www.oualline.com/vim-cook.html" title="http://www.oualline.com/vim-cook.html">VIM cookbook</a></li>
<li>vim Recipes
<a href="http://wiki.kent-chiu.com/lib/exe/fetch.php?media=vim:vim-recipes.pdf" title="vim:vim-recipes.pdf">pdf</a>
<a href="http://vim.runpaint.org/" title="http://vim.runpaint.org/">網站(有search功能)</a></li>
<li><img src="/images/wiki/vim/vim-cheat-sheet-full.png" alt="vim-cheat-sheet-full.png" />
<a href="http://blog.vgod.tw/2009/12/08/vim-cheat-sheet-for-programmers/" title="http://blog.vgod.tw/2009/12/08/vim-cheat-sheet-for-programmers/">vim cheat sheet from
vgod</a></li>
<li><a href="http://coolshell.cn/articles/5426.html" title="http://coolshell.cn/articles/5426.html">简明 Vim
练级攻略</a>

<ul>
<li>一些基本到進階的常用技巧，有圖片及gif動畫說明</li>
</ul>
</li>
<li><a href="http://yannesposito.com/Scratch/en/blog/Learn-Vim-Progressively/" title="http://yannesposito.com/Scratch/en/blog/Learn-Vim-Progressively/">VIM常用指令</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/20/actionbar/">Action Bar</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-20T00:00:00+08:00" pubdate data-updated="true">Apr 20<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/04/20/actionbar/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>android 3.0+ (API level 11)</p>

<p><img src="http://developer.android.com/design/media/action_bar_basics.png" alt="img" /></p>

<ol>
<li>具有 tab 的效果，可以在多個 fragments 間切換</li>
<li>具有 options menu 的功能， options menu 在 3.0 之後會用改採 action
item 的實作呈現</li>
</ol>


<p>基本的 actionbar
應用，可以參數<a href="http://developer.android.com/design/patterns/actionbar.html" title="http://developer.android.com/design/patterns/actionbar.html">這裡</a></p>

<p><img src="/images/wiki/android/actionbar_001.png" alt="actionbar_001.png" /></p>

<h5>移除 ActionBar</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;activity android:theme="@android:style/Theme.Holo.NoActionBar"&gt;</span></code></pre></td></tr></table></div></figure>


<p>移除後，在程式裡面呼叫 <code>getActionBar()</code> 會得到 null</p>

<p><img src="/images/wiki/android/actionbar_002.png" alt="actionbar_002.png" /></p>

<h5>隱藏 ActionBar</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ActionBar actionBar = getActionBar();
</span><span class='line'>actionBar.hide();</span></code></pre></td></tr></table></div></figure>


<h3>建立 Action Item</h3>

<p>建立 Action Item 的方式跟之前建立 Option Menu 的方式一樣，只是有些 xml
屬性不一樣</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>public boolean onCreateOptionsMenu(Menu menu) {
</span><span class='line'>    getMenuInflater().inflate(R.menu.menu_foobar, menu);
</span><span class='line'>    return true;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;menu xmlns:android="http://schemas.android.com/apk/res/android"&gt;
</span><span class='line'>    &lt;item android:id="@+id/menu_save"
</span><span class='line'>          android:icon="@drawable/ic_menu_save"
</span><span class='line'>          android:title="@string/menu_save"
</span><span class='line'>          android:showAsAction="ifRoom|withText" /&gt;
</span><span class='line'>&lt;/menu&gt;</span></code></pre></td></tr></table></div></figure>


<p>主要的差別在 <code>android:showAsAction</code> 屬性 <strong>ifRoom</strong>
是指如果空間夠的話，放呈現該item ， <strong>withText</strong> 則是該 item 需不需要
title 。 不過，就算指定了 title ，如果空間不足時，還是 title
還是有可能不會出現，但基本上，把 id, icon, titile 視為必要屬性就好了。</p>

<h3>建立 Action View</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;item
</span><span class='line'>    android:id="@+id/menu_my_action_vew"
</span><span class='line'>    android:actionViewClass="com.kentchiu.MyActionView"
</span><span class='line'>    android:icon="@android:drawable/ic_dialog_alert"
</span><span class='line'>    android:showAsAction="always"
</span><span class='line'>    android:title="my test action view"/&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package com.kentchiu;
</span><span class='line'> 
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.view.LayoutInflater;
</span><span class='line'>import android.widget.LinearLayout;
</span><span class='line'> 
</span><span class='line'>public class MyActionView extends LinearLayout {
</span><span class='line'> 
</span><span class='line'>    public MyActionView(Context context) {
</span><span class='line'>        super(context);
</span><span class='line'>        LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
</span><span class='line'>        inflater.inflate(R.layout.action_test, this, true);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>如果需要支援 Collapsible 的動作，就要實作
<code>android.view.CollapsibleActionView</code>。</p>

<h1>TBC</h1>

<ol>
<li>Action Provider</li>
<li>Navigation Tabs</li>
<li>Drop-down Navigation</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/17/drawable_101/">Android Drawable 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-17T00:00:00+08:00" pubdate data-updated="true">Apr 17<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/04/17/drawable_101/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>這篇文章裡的原始碼我放在GITHUB上 :
<a href="https://github.com/DraculaCwg/android_exercise" title="https://github.com/DraculaCwg/android_exercise">https://github.com/DraculaCwg/android_exercise</a></p>

<p>在android中，要設計出美觀的ui，通常都跟<code>Drawable</code>相關的物件脫離不了關係，<code>Drawable</code>翻成中文為”可繪的”，</p>

<p><img src="/images/wiki/android/drawable_101_001.png" alt="drawable_101_001.png" /></p>

<p>由上面的類別結構圖可以得知，圖檔、顏色、動畫、圖形，漸層這些都是屬於<code>Drawable</code>的子類別。
回過頭來看所有gui元件的祖先<code>View</code>
class，裡面跟<code>Drawable</code>有關的是setBackground開頭的幾個method，
也就是說，對於所有的元件，我們都可以透過圖片、形狀、顏色、…等<code>Drawable</code>的子類別來改變元件的外觀。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class View implements Drawable.Callback, KeyEvent.Callback, AccessibilityEventSource {
</span><span class='line'>    public void setBackgroundColor(int color) {
</span><span class='line'>        setBackgroundDrawable(new ColorDrawable(color));
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void setBackgroundColor(int color) {
</span><span class='line'>       ...
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    @RemotableViewMethod
</span><span class='line'>    public void setBackgroundResource(int resid) {
</span><span class='line'>        if (resid != 0 && resid == mBackgroundResource) {
</span><span class='line'>            return;
</span><span class='line'>        }
</span><span class='line'> 
</span><span class='line'>        Drawable d= null;
</span><span class='line'>        if (resid != 0) {
</span><span class='line'>            d = mResources.getDrawable(resid);
</span><span class='line'>        }
</span><span class='line'>        setBackgroundDrawable(d);
</span><span class='line'> 
</span><span class='line'>        mBackgroundResource = resid;
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void setBackgroundDrawable(Drawable d) {
</span><span class='line'>        ...
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>實務上比較常用的做法，是透過xml來設定元件的background，而官網文件上的<a href="http://developer.android.com/guide/topics/resources/drawable-resource.html" title="http://developer.android.com/guide/topics/resources/drawable-resource.html">Drawable
Resources</a>
裡面的xml tag都可以找到跟上面的類別相對應的tag，需要特別注意的是 .png,
.9.png,.jpg, or
.gif這些圖檔只要放在res\drawable的目錄下，就會自動依檔名變成可以直接在XML裡引用的Drawable
Resource，不需額外的tag
而另外常用的還有<code>Shape Drawable</code>這種resource，他裡面包含了處理顏色、形狀，外框的子tags</p>

<p>基本上，只要透過圖片跟Shape
Drawable，就可以玩出很多效果了，先從簡單的來好了:</p>

<h3>圖片</h3>

<p>要改變元件的外觀，最快的方式就是把元件加上背景圖片，下圖效果都是單純的把元件的背景圖片換掉而已</p>

<p><img src="/images/wiki/android/drawable_101_002.png" alt="drawable_101_002.png" /></p>

<p>上圖三個view，分別是用這三個圖片當底圖 (圖片來源 :
<a href="http://www.dibbus.com/2011/03/9patch-images-in-android/" title="http://www.dibbus.com/2011/03/9patch-images-in-android/">http://www.dibbus.com/2011/03/9patch-images-in-android/</a>)</p>

<p>![drawable_101_003.png][]
![drawable_101_004.png][]
![drawable_101_005.png][]</p>

<p>透過把android:background設定成圖片的resource就可以達到上面的效果</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"
</span><span class='line'>    android:orientation="vertical" &gt;
</span><span class='line'> 
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:id="@+id/bule"
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="100dp"
</span><span class='line'>        android:background="@drawable/btn_blue_matte"
</span><span class='line'>        android:gravity="center"
</span><span class='line'>        android:text="bule"
</span><span class='line'>        android:textColor="@color/White" /&gt;
</span><span class='line'> 
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:id="@+id/bule_glossy"
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="100dp"
</span><span class='line'>        android:background="@drawable/btn_blue_glossy"
</span><span class='line'>        android:gravity="center"
</span><span class='line'>        android:text="bule glossy"
</span><span class='line'>        android:textColor="@color/White" /&gt;
</span><span class='line'> 
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:id="@+id/corner"
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="100dp"
</span><span class='line'>        android:background="@drawable/btn_blue_pink_glossy"
</span><span class='line'>        android:gravity="center"
</span><span class='line'>        android:text="blue glossy with pink"
</span><span class='line'>        android:textColor="@color/White" /&gt;
</span><span class='line'> 
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>Shape Drawable</h3>

<p>除了用圖片，也可以用<code>Shape Drawable</code>的方式來改變元件的外觀，Shape
Drawable可以運用的tag如下</p>

<ol>
<li>&lt;corners> 圖形的四個角的形狀</li>
<li>&lt;gradient> 漸層</li>
<li>&lt;padding> 內部圖文</li>
<li>&lt;size></li>
<li>&lt;solid> 填滿的顏色</li>
<li>&lt;stroke> 外框的線條效果</li>
</ol>


<p>下面就是透過設定<code>Shape Drawable</code>的tag達到的效果</p>

<ol>
<li>第一個view是使用了數個子tag達到的</li>
<li>第二個view是只使用<code>&lt;gradient&gt;</code>做漸層</li>
<li>第三個view是只使用<code>&lt;corners&gt;</code>來設定圖形為圓角(round)</li>
<li>第四個view是只使用<code>&lt;solid&gt;</code>設定背景為綠色</li>
<li>第五個view是只使用<code>&lt;stroke&gt;</code>來設定外框的效果</li>
</ol>


<p><img src="/images/wiki/android/drawable_101_006.png" alt="drawable_101_006.png" /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"
</span><span class='line'>    android:orientation="vertical" &gt;
</span><span class='line'> 
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:id="@+id/all"
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="75dp"
</span><span class='line'>        android:gravity="center"
</span><span class='line'>        android:background="@drawable/shape_all"
</span><span class='line'>        android:textColor="@color/Black"
</span><span class='line'>        android:text="shape mix" /&gt;
</span><span class='line'> 
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:id="@+id/gradient"
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="75dp"
</span><span class='line'>        android:gravity="center"
</span><span class='line'>        android:background="@drawable/shape_gradient"
</span><span class='line'>        android:textColor="@color/Black"
</span><span class='line'>        android:text="gradient" /&gt;
</span><span class='line'> 
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:id="@+id/corner"
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="75dp"
</span><span class='line'>        android:gravity="center"
</span><span class='line'>        android:background="@drawable/shape_corners"
</span><span class='line'>        android:textColor="@color/Black"
</span><span class='line'>        android:text="corner" /&gt;
</span><span class='line'> 
</span><span class='line'> 
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:id="@+id/corner"
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="75dp"
</span><span class='line'>        android:gravity="center"
</span><span class='line'>        android:background="@drawable/shape_solid"
</span><span class='line'>        android:textColor="@color/Black"
</span><span class='line'>        android:text="corner" /&gt;
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:id="@+id/stroke"
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="75dp"
</span><span class='line'>        android:gravity="center"
</span><span class='line'>        android:background="@drawable/shape_stroke"
</span><span class='line'>        android:textColor="@color/White"
</span><span class='line'>        android:text="stroke" /&gt;
</span><span class='line'> 
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;shape xmlns:android="http://schemas.android.com/apk/res/android" &gt;
</span><span class='line'>    &lt;gradient
</span><span class='line'>        android:centerColor="@color/WhiteSmoke"
</span><span class='line'>        android:endColor="@color/Yellow"
</span><span class='line'>        android:startColor="@color/Blue" /&gt;
</span><span class='line'>    &lt;corners android:radius="50dp" /&gt;
</span><span class='line'>    &lt;stroke
</span><span class='line'>        android:dashGap="5dp"
</span><span class='line'>        android:dashWidth="3dp"
</span><span class='line'>        android:width="5dp"
</span><span class='line'>        android:color="@color/DarkSalmon" /&gt;
</span><span class='line'>&lt;/shape&gt;</span></code></pre></td></tr></table></div></figure>


<h5>漸層</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;shape xmlns:android="http://schemas.android.com/apk/res/android" &gt;
</span><span class='line'> 
</span><span class='line'>    &lt;gradient
</span><span class='line'>        android:angle="90"
</span><span class='line'>        android:centerColor="@color/WhiteSmoke"
</span><span class='line'>        android:endColor="@color/Yellow"
</span><span class='line'>        android:startColor="@color/Blue" /&gt;
</span><span class='line'> 
</span><span class='line'>&lt;/shape&gt;</span></code></pre></td></tr></table></div></figure>


<h5>圓角</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;shape xmlns:android="http://schemas.android.com/apk/res/android" &gt;
</span><span class='line'>    &lt;corners android:radius="50dp"/&gt;
</span><span class='line'>    &lt;solid android:color="@color/White"/&gt;
</span><span class='line'>&lt;/shape&gt;</span></code></pre></td></tr></table></div></figure>


<h5>背景色</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;shape xmlns:android="http://schemas.android.com/apk/res/android" &gt;
</span><span class='line'> 
</span><span class='line'>    &lt;solid android:color="@color/Green" /&gt;
</span><span class='line'> 
</span><span class='line'>&lt;/shape&gt;</span></code></pre></td></tr></table></div></figure>


<h5>外框</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;shape xmlns:android="http://schemas.android.com/apk/res/android" &gt;
</span><span class='line'>    &lt;stroke android:width="5dp"
</span><span class='line'>        android:color="@color/Red"
</span><span class='line'>        android:dashWidth="3dp"
</span><span class='line'>        android:dashGap="5dp"
</span><span class='line'>        /&gt;
</span><span class='line'>&lt;/shape&gt;</span></code></pre></td></tr></table></div></figure>


<h3>半透明效果</h3>

<p>像下圖的半透明效果(Smoked
Glass)，可以直接透過設定backgroud的顏色的透明度來達到，</p>

<p><img src="/images/wiki/android/drawable_101_007.png" alt="drawable_101_007.png" /></p>

<p>上圖的效果，主要就是在下面的這張圖上，放了一個半透明的text
view，要讓view半透明就是設定View的backgroud屬性，<code>android:background=”#77000000”</code>
#77000000是傳統的RGB前面加上一個透明度(alpha)，以傳統的RGB值#000000是全黑，#FFFFFF是全白，而前面的alpha的值也是00\~FF，這邊設成77剛好是一半。</p>

<p>[[android:drawable_101_008.png][]</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'> 
</span><span class='line'>&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:id="@+id/frameLayout1"
</span><span class='line'>    android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="200dp"
</span><span class='line'>    android:background="@drawable/google_doodle" &gt;
</span><span class='line'> 
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:id="@android:id/text2"
</span><span class='line'>        android:layout_width="fill_parent"
</span><span class='line'>        android:layout_height="100dp"
</span><span class='line'>        android:background="#77000000"
</span><span class='line'>        android:gravity="center_vertical"
</span><span class='line'>        android:text="smoked glass"
</span><span class='line'>        android:textColor="#ffffffff"
</span><span class='line'>        android:textSize="30dip" /&gt;
</span><span class='line'> 
</span><span class='line'>&lt;/FrameLayout&gt;</span></code></pre></td></tr></table></div></figure>


<p>透明度的效果好不好，會跟後面的背景有關，有時，同一個透明度的值，在不同的背景下，效果就會差很多</p>

<h1>Resource</h1>

<ul>
<li><a href="http://www.dibbus.com/2011/03/9patch-images-in-android/" title="http://www.dibbus.com/2011/03/9patch-images-in-android/">http://www.dibbus.com/2011/03/9patch-images-in-android/</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/13/unit_testing_in_android/">Android Unit Test 101</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-13T00:00:00+08:00" pubdate data-updated="true">Apr 13<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/04/13/unit_testing_in_android/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>這邊並不算真正的unit
test，因為整個測試還是需要模擬器或實機執行，而且很依賴測試環境的context，如果有需要
也是會去連網路或資料庫。</p>

<h1>準備工作</h1>

<p>要進行Android Testing通常是把test cases建立在另一個Test
Project而不是像一般的java(maven base)目錄結構一樣
在同一個project建立test folder.</p>

<p>Testing project可透過eclipse的android project
wizard建立，建立後記得先把production project裡用到的lib export出來給test
project使用</p>

<p><img src="/images/wiki/android/unit_testing_in_android_003.png" alt="unit_testing_in_android_003.png" /></p>

<p>而測試專案只需要放只有測試時會用到的lib，因為Tesing
Project有reference到Production Project，所以會一併引用Production Project
export 出來的lib。</p>

<p>一般習慣把被測的程式的專案叫Production
project(或<a href="http://xunitpatterns.com/SUT.html" title="http://xunitpatterns.com/SUT.html">SUT</a>)，
而測試程式專案叫Testing Project</p>

<h1>Android測試架構</h1>

<ul>
<li>測試方式是透過建立測試專案來測試待測專案(<a href="http://xunitpatterns.com/SUT.html" title="http://xunitpatterns.com/SUT.html">SUT</a>)</li>
<li>需啟動Android
OS，所以是屬於整合測試，而不是單元測試(像是eclipse的plugin測試方式)</li>
<li>需繼承特定的TestCase以便可以取得一些測試的基本功能</li>
</ul>


<p><img src="http://developer.android.com/images/testing/android_test_framework.png" alt="" /></p>

<p>Android應用程式跟測試程式透過Instrumentation Test
Runner執行在同一個Process, 所以，在執行測試時，需透過Instrumentation
Test Runner。</p>

<p><img src="/images/wiki/android/unit_testing_in_android_001.png" alt="unit_testing_in_android_001.png" /></p>

<p>測試分為兩大類</p>

<ol>
<li>Instrumentation Testing</li>
<li>Android Testing</li>
</ol>


<h3>Instrumentation Testing</h3>

<p>這類型的testing會啟動instrumentation Test Runner。
Instrumentation可以使用instrumentation framework，有了Instrumentation
framework，可以透過Android的事件處理系統傳送訊息給Android應用程式，以便於模擬像”收到mail”，”收到簡訊”，”有電話calling進來”等等的動作，或者是對UI進行自動化測試。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>TestCase
</span><span class='line'> |
</span><span class='line'> `- InstrumentationTestCase
</span><span class='line'>    |
</span><span class='line'>    `- ActivityTestCase
</span><span class='line'>    |  |
</span><span class='line'>    |  `- ActivityInstrumentationTestCase&lt;T&gt;
</span><span class='line'>    |  |
</span><span class='line'>    |  `- ActivityInstrumentationTestCase2&lt;T&gt;
</span><span class='line'>    |  |
</span><span class='line'>    |  `- ActivityUnitTestCase&lt;T&gt;
</span><span class='line'>    |
</span><span class='line'>    `- ProviderTestCase&lt;T&gt;
</span><span class='line'>    |
</span><span class='line'>    `- SingleLaunchActivityTestCase&lt;T&gt;
</span><span class='line'>    |
</span><span class='line'>    `- SyncBaseInstrumentation</span></code></pre></td></tr></table></div></figure>


<h3>Android Testing</h3>

<p>提供Context給測試程式</p>

<p>以下的TestCase提供跟Android應用程式相關的Context，透過Context，可以取到Android的檔案系統，資料庫，資源檔…。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>TestCase
</span><span class='line'> |
</span><span class='line'> `- AndroidTestCase
</span><span class='line'>    |
</span><span class='line'>    `- ProviderTestCase2&lt;T&gt;
</span><span class='line'>    |
</span><span class='line'>    `- ServiceTestCase&lt;T&gt;
</span><span class='line'>    |
</span><span class='line'>    `- ApplicationTestCase&lt;T&gt;</span></code></pre></td></tr></table></div></figure>


<p>XxxTestCase2&lt;T>中的<code>tempalte &lt;T&gt;</code>在使用時要宣告成要被測試的class，就像泛型容器的用法一樣
ex: <code>List&lt;MyClass&gt;</code></p>

<h3>AndroidTestCase Or InstrumentationTestCase</h3>

<h5>AndroidTestCase V.S InstrumentationTestCase</h5>

<p>如果測試的對象是ui元件的話，那就必需要用InstrumentationTestCase體系的test
cases，如果要測試non-UI的功能，像permissions之類的功能，那使用AndroidTestCase體系的的test
case即可。
@UiThreadTest(android.test.UiThreadTest)是使用在InstrumentationTestCase的test
method上，用來標明該method會存取UI元件，需要在main thread執行。
或者是，測試時需要使用到test project裡才有的resource(assets, res, …
目錄下的東西)，那就得使用InstrumentationTestCase，因為InstrumentationTestCase才會去處理test
project下的AndroidManifest.xml。</p>

<p>元件測試或應用程式測試，元件測試主要是以下三種</p>

<ol>
<li><a href="http://developer.android.com/guide/topics/testing/activity_testing.html" title="http://developer.android.com/guide/topics/testing/activity_testing.html">Activity
Testing</a></li>
<li><a href="http://developer.android.com/guide/topics/testing/contentprovider_testing.html" title="http://developer.android.com/guide/topics/testing/contentprovider_testing.html">Content Provider
Testing</a></li>
<li><a href="http://developer.android.com/guide/topics/testing/service_testing.html" title="http://developer.android.com/guide/topics/testing/service_testing.html">Service
Testing</a></li>
</ol>


<p>而應該程式測試測是測試<a href="http://developer.android.com/reference/android/app/Application.html" title="http://developer.android.com/reference/android/app/Application.html">Application</a></p>

<ol>
<li><a href="http://developer.android.com/guide/topics/testing/service_testing.html" title="http://developer.android.com/guide/topics/testing/service_testing.html">ApplicationTestCase</a></li>
</ol>


<p><a href="http://developer.android.com/reference/android/test/TouchUtils.html" title="http://developer.android.com/reference/android/test/TouchUtils.html">TouchUtils</a>
(android.test.TouchUtils)可用來產生touch
events，通常在InstrumentationTestCase or
ActivityInstrumentationTestCase2中使用。</p>

<h1>TestCases</h1>

<ul>
<li><p><a href="#androidtestcase" title="android:unit_testing_in_android ↵">AndroidTestCase</a></p>

<ol>
<li><a href="#providertestcase2" title="android:unit_testing_in_android ↵">ProviderTestCase2</a></li>
<li><a href="#servicetestcase" title="android:unit_testing_in_android ↵">ServiceTestCase</a></li>
<li><a href="#applicationtestcase" title="android:unit_testing_in_android ↵">ApplicationTestCase</a></li>
</ol>
</li>
<li><p><a href="#instrumentationtestcase" title="android:unit_testing_in_android ↵">InstrumentationTestCase</a></p>

<ol>
<li><p><a href="#activitytestcase" title="android:unit_testing_in_android ↵">ActivityTestCase</a></p>

<ol>
<li><a href="#activityinstrumentationtestcase" title="android:unit_testing_in_android ↵">ActivityInstrumentationTestCase</a></li>
<li><a href="#activityinstrumentationtestcase2" title="android:unit_testing_in_android ↵">ActivityInstrumentationTestCase2</a></li>
<li><a href="#activityunittestcase" title="android:unit_testing_in_android ↵">ActivityUnitTestCase</a></li>
</ol>
</li>
<li><p><a href="#providertestcase" title="android:unit_testing_in_android ↵">ProviderTestCase</a></p></li>
<li><a href="#singlelaunchactivitytestcase" title="android:unit_testing_in_android ↵">SingleLaunchActivityTestCase</a></li>
<li><a href="#syncbaseinstrumentation" title="android:unit_testing_in_android ↵">SyncBaseInstrumentation</a></li>
</ol>
</li>
</ul>


<h3>AndroidTestCase</h3>

<p>提供context是在Android
Framework中最重要的一個物件，在許多地方都會用到它，<code>這邊的context是test project的context</code>。
AndroidTestCase啟動時，會先做自我檢測，先驗証測試環境是否ready to
use.有提供幾個預先定義好的assert.</p>

<h3>ProviderTestCase2</h3>

<p>測試Provider的test
case,如果要測試資料而非UI的話，那測試的對象應該是<a href="http://developer.android.com/guide/topics/providers/content-providers.html" title="http://developer.android.com/guide/topics/providers/content-providers.html">Content
Provider</a>及Content
Provider用到的相關物件。</p>

<p>Android Test Framework有提供ProviderTestCase2可以Content
Provider進行獨立的測試。使用方式如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class MyContentProviderTest extends ProviderTestCase2&lt;MyContentProvider&gt; {
</span><span class='line'> 
</span><span class='line'>    public MyContentProviderTest() {
</span><span class='line'>        super(MyContentProvider.class, MyContentProvider.class.getName());
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    @Override
</span><span class='line'>    protected void setUp() throws Exception {
</span><span class='line'>        super.setUp();
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void testInsert() throws Exception {
</span><span class='line'>        ContentValues values = new ContentValues();
</span><span class='line'>        values.put("name", "foo");
</span><span class='line'>        getProvider().insert("context://xxx/xx", values);
</span><span class='line'>        // do assert here
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void testQuery() throws Exception {
</span><span class='line'>        getProvider().query("context://xxx/xx", null, null, null, null);
</span><span class='line'>        // do assert here
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>此例中，測是對象為MyContentProvider,使用上要注意的有：</p>

<ol>
<li><p>Testcase要繼承自<a href="http://developer.android.com/reference/android/test/ProviderTestCase2.html" title="http://developer.android.com/reference/android/test/ProviderTestCase2.html">ProviderTestCase2</a></p>

<ul>
<li>可以將<code>ProviderTestCase2&lt;T&gt;</code>的template
&lt;T>指定成對象為MyContentProvider，這樣可以testcase內就會引用MyContentProvider而非ContentProvider</li>
</ul>
</li>
<li><p>必須要建立一個無參數的建構子(Constructor)</p></li>
<li><p>Constructor裡必須呼叫<code>super(MyContentProvider.class, MyContentProvider.class.getName());</code></p>

<ul>
<li>因為MyContentProvider的Authority為<code>MyContentProvider.class.getName()</code></li>
</ul>
</li>
<li><p>Testcase中透過getProvider()來取得MyContentProvider的instance，而不是自已創建MyContentProvider的instance</p></li>
</ol>


<h3>ServiceTestCase</h3>

<p>ServiceTestCase可以用來測試Android Service,ServiceTestCase</p>

<p><img src="/images/wiki/android/unit_testing_in_android_002.png" alt="unit_testing_in_android_002.png" /></p>

<p>基本的使用方式如下：</p>

<ol>
<li>宣告class時，把<code>template &lt;T&gt;</code>換成要被測試的Service(Service Under
Test)</li>
<li>建立default的constructor，並呼叫parent的constructor，代入class name</li>
<li>setUp()時，ServiceTestCase會將real context儲存到systemContext</li>
<li>透過startService()或bindService()啟動service
(呼叫service.onCreate())</li>
<li>test case的tearDown()會stop 跟 destroy service</li>
<li>如果有需要的話，可以透過setCotext()或setApplication()換掉test
case裡的context跟application.</li>
</ol>


<p>ServiceTestCase預設是使用MockApplication + Test Proejct的Context</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public abstract class ServiceTestCase&lt;T extends Service&gt; extends AndroidTestCase {
</span><span class='line'>    protected void setupService() {
</span><span class='line'>        mService = null;
</span><span class='line'>        try {
</span><span class='line'>            mService = mServiceClass.newInstance();
</span><span class='line'>        } catch (Exception e) {
</span><span class='line'>            assertNotNull(mService);
</span><span class='line'>        }
</span><span class='line'>        if (getApplication() == null) {
</span><span class='line'>            setApplication(new MockApplication());  // 使用mock版的Application()，而不是真正的
</span><span class='line'>        }
</span><span class='line'>        mService.attach(getContext(), null,  mServiceClass.getName(), null, getApplication(), null);
</span><span class='line'>        assertNotNull(mService);
</span><span class='line'>        mServiceId = new Random().nextInt();
</span><span class='line'>        mServiceAttached = true;
</span><span class='line'>    }
</span><span class='line'>} </span></code></pre></td></tr></table></div></figure>


<p>Android有提供<a href="#renamingdelegatingcontext" title="android:unit_testing_in_android ↵">RenamingDelegatingContext</a>,
<a href="#contextwrapper" title="android:unit_testing_in_android ↵">ContextWrapper</a>,
<a href="#isolatedcontext" title="android:unit_testing_in_android ↵">IsolatedContext</a>跟<a href="#mockcontext" title="android:unit_testing_in_android ↵">MockContext</a>來換原MockContext，也可以自已Mock一個</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class MyServiceTest extends ServiceTestCase&lt;MyService&gt; {
</span><span class='line'>    public MyServiceTest() {
</span><span class='line'>        super(MyService.class);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/wiki/android/unit_testing_in_android_002.png" alt="unit_testing_in_android_002.png" /></p>

<p>ServiceTestCase提供<code>getService()</code>可以取得要被測試的service，<code>getSystemContext()</code>可以取得test
project context</p>

<h5>getContext() vs getSystemContext()</h5>

<p>在預設的情況下，如果沒有特別去設定context，getContext(),getSystemContext()是同一個instance，但是
如果有設定mock版的context，ex:
<code>setConext(new MockContext());</code>，那麼getContext()會取到mock版的，
而getSystemContext()會取到原來的(測試專案的)。</p>

<h3>ApplicationTestCase</h3>

<p>測試Application的test case</p>

<h3>InstrumentationTestCase</h3>

<h3>ActivityTestCase</h3>

<h3>ActivityInstrumentationTestCase</h3>

<h3>ActivityInstrumentationTestCase2</h3>

<h3>ActivityUnitTestCase</h3>

<h3>ProviderTestCase</h3>

<h3>SingleLaunchActivityTestCase</h3>

<h3>SyncBaseInstrumentation</h3>

<h1>要測那些東西</h1>

<h5>Activity lifecycle events</h5>

<p>如果有在Activity lifecycle events像是onCreate(), onResume(), onPause(),
…中保存activity的狀態，那麼應該要對這些methods進行測式，而當
Configuration-changed事件發生時，也需要確定這些event的動作都正確。</p>

<p><img src="http://developer.android.com/images/activity_lifecycle.png" alt="" /></p>

<p>TestCase :
<a href="#activityinstrumentationtestcase2" title="android:unit_testing_in_android ↵">ActivityInstrumentationTestCase2</a>
(大多數情況用這個),
<a href="#activitytestcase" title="android:unit_testing_in_android ↵">ActivityTestCase</a>,
<a href="#singlelaunchactivitytestcase" title="android:unit_testing_in_android ↵">SingleLaunchActivityTestCase</a></p>

<h5>Content Provder</h5>

<p>Content
Provder在大部份的情況下，不需要自行建立，也不建議直接建立，所以，Content
Provder在測試時， Insert, Update, Query,
Delete等method，還有getType()這些基本的methods都要被測到，如果沒有必要的話，
儘量不要自已publish額外的method，因為在程式裡，只能取到ContentProvder型別，無法直接取得子型別(除非透過型別轉換，但不建議)，
所以，ContentProvider的子類別，應儘量避免publish額外的API.</p>

<p>TestCase :
<a href="#providertestcase2" title="android:unit_testing_in_android ↵">ProviderTestCase2</a></p>

<h5>ListView Adapter</h5>

<p>ListView用的Adapter，ListView是UI裡很重要的一個元件，幾乎每個應該程式都會用到，而ListView
Adapter又是ListView中 主要的元件，對Adapter測試的重要性，不言可喻。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class ScriptListAdapterTest extends AndroidTestCase {
</span><span class='line'> 
</span><span class='line'>    public void testExtractWords_none_words() throws Exception {
</span><span class='line'>        ScriptListAdapter adapter = new ScriptListAdapter(getContext(), R.layout.script_list_item, R.id.scriptLine, ImmutableList.&lt;String&gt; of());
</span><span class='line'>        adapter.setRichScript("foo bar");
</span><span class='line'>        assertThat(adapter.extractWord(), Matchers.&lt;String&gt; emptyIterable());
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void testExtractWords_one_word() throws Exception {
</span><span class='line'>        ScriptListAdapter adapter = new ScriptListAdapter(getContext(), R.layout.script_list_item, R.id.scriptLine, ImmutableList.&lt;String&gt; of());
</span><span class='line'>        adapter.setRichScript("foo &lt;b&gt;bar&lt;/b&gt; baz");
</span><span class='line'>        Iterable&lt;String&gt; words = adapter.extractWord();
</span><span class='line'>        assertThat(words, hasItem("bar"));
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void testExtractWords_two_words() throws Exception {
</span><span class='line'>        ScriptListAdapter adapter = new ScriptListAdapter(getContext(), R.layout.script_list_item, R.id.scriptLine, ImmutableList.&lt;String&gt; of());
</span><span class='line'>        adapter.setRichScript("&lt;b&gt;foo&lt;/b&gt; bar &lt;b&gt;baz&lt;/b&gt;");
</span><span class='line'>        Iterable&lt;String&gt; words = adapter.extractWord();
</span><span class='line'>        assertThat(words, hasItems("foo", "baz"));
</span><span class='line'>        assertThat(words, not(hasItem("bar")));
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void testRichText() throws Exception {
</span><span class='line'>        ScriptListAdapter adapter = new ScriptListAdapter(getContext(), R.layout.script_list_item, R.id.scriptLine, ImmutableList.&lt;String&gt; of());
</span><span class='line'>        CharSequence text = adapter.richText("this is a foo bar string", ImmutableList.of("foo", "string"));
</span><span class='line'>        System.out.println(text);
</span><span class='line'> 
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>TestCase :
<a href="#androidtestcase" title="android:unit_testing_in_android ↵">AndroidTestCase</a></p>

<h5>Database &amp; File</h5>

<p>我通常會對DatabaseHelper進行測試，以確定table可以正確的被建立或版更</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class DatabaseHelperTest extends TestCase {
</span><span class='line'>    private DatabaseHelper    helper;
</span><span class='line'>    private SQLiteDatabase    db;
</span><span class='line'> 
</span><span class='line'>    @Override
</span><span class='line'>    public void tearDown() {
</span><span class='line'>        helper.close();
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void testDictionaryBankTable() throws Exception {
</span><span class='line'>        Cursor c = db.query(DatabaseHelper.DICTIONARY_TABLE_NAME, null, null, null, null, null, null);
</span><span class='line'>        assertEquals(4, c.getColumnCount());
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void testPodcastTable() throws Exception {
</span><span class='line'>        Cursor c = db.query(DatabaseHelper.PODCAST_TABLE_NAME, null, null, null, null, null, null);
</span><span class='line'>        assertEquals(13, c.getColumnCount());
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    public void testWordBankTable() throws Exception {
</span><span class='line'>        Cursor c = db.query(DatabaseHelper.WORD_BANK_TABLE_NAME, null, null, null, null, null, null);
</span><span class='line'>        assertEquals(2, c.getColumnCount());
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    @Override
</span><span class='line'>    protected void setUp() throws Exception {
</span><span class='line'>        super.setUp();
</span><span class='line'>        db = SQLiteDatabase.create(null);
</span><span class='line'>        helper = new DatabaseHelper(null, "podcast.db", null);
</span><span class='line'>        helper.onOpen(db);
</span><span class='line'>        helper.onCreate(db);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>TestCase: 沒有用到android 的context，只需用Junit內建的TestCase即可</p>

<h5>Helper &amp; Utils</h5>

<p>Helper跟Utils指的是跟Android比較無關類別，有可能用到網路或檔案系統等的class，可視情況選擇用TestCase,
AndroidTestCase, InstrumentationTestCase
通常我都是先用最簡單的，如果不適合，再找次簡單的。</p>

<h1>Test Helper</h1>

<h3>Mock Objects</h3>

<p>Android Test Framework也有提供一列系的mock
objects，如果在測試時採用Depedency Injection的方式把這些mock
object注入，會讓測試更簡單，更獨立。 這些mock
oject被放在<a href="http://developer.android.com/reference/android/test/mock/package-summary.html" title="http://developer.android.com/reference/android/test/mock/package-summary.html">android.test.mock
package</a>內，主要有下列這些mock
objects</p>

<ol>
<li>MockApplication A mock Application class.</li>
<li>MockContentProvider Mock implementation of ContentProvider.</li>
<li>MockContentResolver An extension of ContentResolver that is designed
for testing.</li>
<li>MockContext A mock Context class.</li>
<li>MockCursor A mock Cursor class that isolates the test code from real
Cursor implementation.</li>
<li>MockDialogInterface A mock DialogInterface class.</li>
<li>MockPackageManager A mock PackageManager class.</li>
<li>MockResources A mock Resources class.</li>
</ol>


<p>這些class採的mock
strategy是stubbing而不是mocking，也就是說，使用時必須overwrite掉要提供資訊的methods</p>

<p>曾經試著將在Android test framework上使用幾個mock
framework，都失敗了，目前都是直接使用Android test
framework內建的mocks，雖不好用但可以接受。</p>

<ol>
<li>mockito 1.8.5 - 無法通過編譯，殘念</li>
<li>easymock 3 - extension的部份無法通過編譯，也就是只能mock
interface，殘念</li>
<li>powermock - 還是需要mocktio或easymock的jar，殘念</li>
<li>jmock - 沒試</li>
</ol>


<p><a href="https://sites.google.com/site/androiddevtesting/" title="https://sites.google.com/site/androiddevtesting/">這裡</a>有篇文章說明為何大多數的Mock
framework在Android上的無法正常動作， 只要是Mock
Framework有用到CGLib就無法在Dalvik
VM上執行，ex:EasyMock,Mockito都有用到這個lib</p>

<p>2012/3/16 己經有android team的member在將mockito
porting到android上了，或許不久的將來就有android
compatible的mockito可以用了 :) ，詳情 :
<a href="http://code.google.com/p/mockito/issues/detail?id=308" title="http://code.google.com/p/mockito/issues/detail?id=308">http://code.google.com/p/mockito/issues/detail?id=308</a></p>

<h3>Context For Testing</h3>

<p>Context的type hierarchy</p>

<p><img src="/images/wiki/android/unit_testing_in_android_002.png" alt="unit_testing_in_android_002.png" /></p>

<p>跟測試比較相關的有</p>

<ol>
<li><a href="#contextwrapper" title="android:unit_testing_in_android ↵">ContextWrapper</a></li>
<li><a href="#isolatedcontext" title="android:unit_testing_in_android ↵">IsolatedContext</a></li>
<li><a href="#renamingdelegatingcontext" title="android:unit_testing_in_android ↵">RenamingDelegatingContext</a></li>
<li><a href="#mockcontext" title="android:unit_testing_in_android ↵">MockContext</a></li>
</ol>


<h5>ContextWrapper</h5>

<p>嚴格來說，這個並不算是testing專用的，其他不少context也是從這個開始繼承的，他的實作很簡單
，就是把被wrapped的context的delegate給ContextWrapper，所以，每個method大多長這樣</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * Proxying implementation of Context that simply delegates all of its calls to
</span><span class='line'> * another Context.  Can be subclassed to modify behavior without changing
</span><span class='line'> * the original Context.
</span><span class='line'> */
</span><span class='line'>public class ContextWrapper extends Context {
</span><span class='line'>    Context mBase;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public AssetManager getAssets() {
</span><span class='line'>        return mBase.getAssets();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public Resources getResources()
</span><span class='line'>    {
</span><span class='line'>        return mBase.getResources();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public PackageManager getPackageManager() {
</span><span class='line'>        return mBase.getPackageManager();
</span><span class='line'>    }
</span><span class='line'>    ...
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h5>IsolatedContext</h5>

<p>這個Context把跟設備相關的method改掉掉，讓context不與設備直接溝通，但又提供足夠的功能以測試可以進行。
被IsolatedContext改寫掉的methods如下</p>

<p>(圖丟了 XD)</p>

<h5>RenamingDelegatingContext</h5>

<p>正常來說，如果production code裡用到的db 叫
foo.db跟一個檔案叫bar.txt，但測試時，希望不要去動到原來的foo.db,bar.txt
，而是提供一組測試用的foo.db跟bar.txt那就可以用RenamingDelegatingContext處理，可以把測試的命名成
test_foo.db跟test_bar.txt，然後跟RenamingDelegatingContext測試用的contxt是以”test_”當prefix即可，這樣所有測試用的
的檔案名稱跟DB名稱就是原來的名稱加上”test_”，用以避免prodcution
code跟testing code互相感染。</p>

<p>RenamingDelegatingContext是用來處理檔案都是放在application
project中的情況，但實際使用上，在測試專案上的相同的位置放上一個同檔名的檔案，會比用RenamingDelegatingContext適合，
不過，如果取得測試案專案的resource，就得繼承自InstrumentationTestCase而非AndroidTestCase體系</p>

<h5>MockContext</h5>

<p>Mock版的Context，裡面的implement就是丟出UnsupportedOperationException，所以如果要用這個context，那
測試中有用到的method，就要自行改寫，不然就等著接UnsupportedOperationException。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * A mock {@link android.content.Context} class.  All methods are non-functional and throw 
</span><span class='line'> * {@link java.lang.UnsupportedOperationException}.  You can use this to inject other dependencies,
</span><span class='line'> * mocks, or monitors into the classes you are testing.
</span><span class='line'> */
</span><span class='line'>public class MockContext extends Context {
</span><span class='line'> 
</span><span class='line'>    @Override
</span><span class='line'>    public AssetManager getAssets() {
</span><span class='line'>        throw new UnsupportedOperationException();
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    @Override
</span><span class='line'>    public Resources getResources() {
</span><span class='line'>        throw new UnsupportedOperationException();
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    @Override
</span><span class='line'>    public PackageManager getPackageManager() {
</span><span class='line'>        throw new UnsupportedOperationException();
</span><span class='line'>    }
</span><span class='line'>    ...
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Assertion classes</h3>

<p>除了基本的Junit Assertions外，Android Test Framework還提供了</p>

<ol>
<li><a href="http://developer.android.com/reference/android/test/MoreAsserts.html" title="http://developer.android.com/reference/android/test/MoreAsserts.html">More
Asserts</a>

<ul>
<li>一些android testing
assertions的延伸，不過我覺得<a href="http://wiki.kent-chiu.com/doku.php?id=java:hamcrest_101" title="java:hamcrest_101">hamcrest</a>更好用</li>
</ul>
</li>
<li><a href="http://developer.android.com/reference/android/test/ViewAsserts.html" title="http://developer.android.com/reference/android/test/ViewAsserts.html">View
Asserts</a>

<ul>
<li>一些跟view有關的assertions，像是view跟view之間的關係、對齊方式、…</li>
</ul>
</li>
</ol>


<p>目前Android Test Framework(Android
2.3)還都是基於Junit3,Junit3的assertions在使用上沒有Junit4的來方便(powered
by Hamcrest)，Junit3沒有內建<code>assertThat()</code>，
Hamcrest的assertions是一個獨立的lib，所以，還是可以拿來跟Junit3搭著用，但是，Hamrcest的jar檔(1.3-R.C2)丟到Eclipse
ADT時，無法順利通過編譯，<a href="http://wiki.kent-chiu.com/doku.php?id=java:hamcrest_101#hamcrest_android" title="java:hamcrest_101">這裡有提供解決的方式</a>
，至於Hamcrest的assertion，可以參閱<a href="http://code.google.com/p/hamcrest/wiki/Tutorial" title="http://code.google.com/p/hamcrest/wiki/Tutorial">Hamcrest網站的教學</a>或<a href="http://wiki.kent-chiu.com/doku.php?id=java:hamcrest_101" title="java:hamcrest_101">這裡</a>也有一個簡單的說明。</p>

<h4>MISC</h4>

<ol>
<li>RenamingDelegating - Product
code用的是一個名字，測試時用的是另一個名字(檔案或資料庫)，用來避開testing
code改到product code的內容</li>
<li>ActivityMonitor -
android.app.Instrumentation.ActivityMonitor是Instrumentation的內部類別，可以用來monitor系統的行為。</li>
</ol>


<p>如果test proejct跟production project有用到相同的jars，只需由production
project export出jars讓testing project使用即可，如果testing
project有跟production project相同的lib，可能compile time會出錯</p>

<h1>Resources</h1>

<ul>
<li><a href="http://developer.android.com/resources/tutorials/testing/helloandroid_test.html" title="http://developer.android.com/resources/tutorials/testing/helloandroid_test.html">Hello World
Test</a></li>
<li><a href="http://developer.android.com/guide/topics/testing/testing_android.html" title="http://developer.android.com/guide/topics/testing/testing_android.html">Testing and
Instrumentation</a></li>
<li><a href="http://developer.android.com/guide/developing/testing/testing_eclipse.html" title="http://developer.android.com/guide/developing/testing/testing_eclipse.html">Testing In Eclipse, with
ADT</a></li>
<li><a href="http://codinghard.wordpress.com/2009/06/04/a-first-look-at-the-android-testing-framework/" title="http://codinghard.wordpress.com/2009/06/04/a-first-look-at-the-android-testing-framework/">http://codinghard.wordpress.com/2009/06/04/a-first-look-at-the-android-testing-framework/</a></li>
<li><a href="http://code.google.com/p/nativedriver/" title="http://code.google.com/p/nativedriver/">Native
Driver</a>

<ul>
<li>google官方的ui test
api，webdriver(<a href="http://code.google.com/p/selenium/" title="http://code.google.com/p/selenium/">selenium</a>)
like的測試工具</li>
</ul>
</li>
<li><p>RenamingDelegatingContext的使用方式可以參考下面的資料</p>

<ol>
<li><a href="http://blog.jayway.com/2011/10/10/using-renamingdelegatingcontext-to-mock-contentresolver-in-android/" title="http://blog.jayway.com/2011/10/10/using-renamingdelegatingcontext-to-mock-contentresolver-in-android/">http://blog.jayway.com/2011/10/10/using-renamingdelegatingcontext-to-mock-contentresolver-in-android/</a></li>
<li><a href="https://docs.google.com/View?id=ddwc44gs_21737cgtvfj" title="https://docs.google.com/View?id=ddwc44gs_21737cgtvfj">https://docs.google.com/View?id=ddwc44gs_21737cgtvfj</a></li>
</ol>
</li>
<li><p><a href="http://www.slideshare.net/dtmilano/introduction-to-android-testing" title="http://www.slideshare.net/dtmilano/introduction-to-android-testing">http://www.slideshare.net/dtmilano/introduction-to-android-testing</a></p>

<ul>
<li>android testing的簡介投影片，有每個test case使用上的差異</li>
</ul>
</li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/05/17/my-intellij-idea-shortcut/">My IntelliJ IDEA Shortcut</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/12/jesper-report-font-issue/">Jesper Report, IReport 匯出成中文PDF</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/12/jasperreport-101/">JasperReport 101</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/06/mac-tips/">Mac Tips</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/22/clean-code/">Clean Code閱讀筆記</a>
      </li>
    
  </ul>
</section>

Included file &#8216;asides/twitter.html&#8217; not found in _includes directory



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Kent -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kentchiu';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
